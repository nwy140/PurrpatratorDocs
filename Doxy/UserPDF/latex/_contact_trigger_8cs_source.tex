\doxysection{Contact\+Trigger.\+cs}
\label{_contact_trigger_8cs_source}\index{C:/\_SSDSPEEDUP/2021/GPS/gps2\_purrpatrator/GPS2\_Purrpatrator/Assets/Photon/Simple/Components/ContactSystems/ContactTrigger.cs@{C:/\_SSDSPEEDUP/2021/GPS/gps2\_purrpatrator/GPS2\_Purrpatrator/Assets/Photon/Simple/Components/ContactSystems/ContactTrigger.cs}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002 \textcolor{comment}{// <copyright>PhotonNetwork Framework for Unity -\/ Copyright (C) 2020 Exit Games GmbH</copyright>}}
\DoxyCodeLine{00003 \textcolor{comment}{// <author>developer@exitgames.com</author>}}
\DoxyCodeLine{00004 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00005 }
\DoxyCodeLine{00006 \textcolor{keyword}{using} UnityEngine;}
\DoxyCodeLine{00007 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00008 \textcolor{keyword}{using} Photon.Pun.Simple.ContactGroups;}
\DoxyCodeLine{00009 \textcolor{keyword}{using} System.Reflection;}
\DoxyCodeLine{00010 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00011 }
\DoxyCodeLine{00012 \textcolor{preprocessor}{\#if UNITY\_EDITOR}}
\DoxyCodeLine{00013 \textcolor{keyword}{using} UnityEditor;}
\DoxyCodeLine{00014 \textcolor{keyword}{using} Photon.Pun.Simple.Assists;}
\DoxyCodeLine{00015 \textcolor{keyword}{using} Photon.Pun.Simple.Internal;}
\DoxyCodeLine{00016 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00017 }
\DoxyCodeLine{00018 \textcolor{keyword}{namespace }Photon.Pun.Simple}
\DoxyCodeLine{00019 \{}
\DoxyCodeLine{00020 }
\DoxyCodeLine{00021     \textcolor{keyword}{public} \textcolor{keyword}{class }ContactTrigger : MonoBehaviour}
\DoxyCodeLine{00022         , IContactTrigger}
\DoxyCodeLine{00023         , IContactable}
\DoxyCodeLine{00024         , IOnPreSimulate}
\DoxyCodeLine{00025         , IOnStateChange}
\DoxyCodeLine{00026 }
\DoxyCodeLine{00027     \{}
\DoxyCodeLine{00028         \textcolor{comment}{// Static Constructor}}
\DoxyCodeLine{00029         \textcolor{keyword}{static} ContactTrigger()}
\DoxyCodeLine{00030         \{}
\DoxyCodeLine{00031             FindDerivedTypesFromAssembly();}
\DoxyCodeLine{00032         \}}
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034 \textcolor{preprocessor}{        \#region Presets}}
\DoxyCodeLine{00035 \textcolor{preprocessor}{\#if UNITY\_EDITOR}}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037         \textcolor{keyword}{public} ContactTrigger UsePreset(Preset preset)}
\DoxyCodeLine{00038         \{}
\DoxyCodeLine{00039             \textcolor{keywordflow}{switch} (preset)}
\DoxyCodeLine{00040             \{}
\DoxyCodeLine{00041                 \textcolor{keywordflow}{case} Preset.ContactScan:}
\DoxyCodeLine{00042                     \{}
\DoxyCodeLine{00043                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00044                     \}}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046                 \textcolor{keywordflow}{case} Preset.VitalsScan:}
\DoxyCodeLine{00047                     \{}
\DoxyCodeLine{00048                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00049                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00050                     \}}
\DoxyCodeLine{00051                 \textcolor{keywordflow}{case} Preset.InventorysScan:}
\DoxyCodeLine{00052                     \{}
\DoxyCodeLine{00053                         SetAllowedType(typeof(IInventorySystem));}
\DoxyCodeLine{00054                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00055                     \}}
\DoxyCodeLine{00056 }
\DoxyCodeLine{00057                 \textcolor{keywordflow}{case} Preset.HealthPickup:}
\DoxyCodeLine{00058                     \{}
\DoxyCodeLine{00059                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00060                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00061                     \}}
\DoxyCodeLine{00062 }
\DoxyCodeLine{00063                 \textcolor{keywordflow}{case} Preset.RechargeZone:}
\DoxyCodeLine{00064                     \{}
\DoxyCodeLine{00065                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00066                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00067                     \}}
\DoxyCodeLine{00068                 \textcolor{keywordflow}{case} Preset.DamageZone:}
\DoxyCodeLine{00069                     \{}
\DoxyCodeLine{00070                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00071                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00072                     \}}
\DoxyCodeLine{00073 }
\DoxyCodeLine{00074                 \textcolor{keywordflow}{case} Preset.WeaponMelee:}
\DoxyCodeLine{00075                     \{}
\DoxyCodeLine{00076                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00077                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00078                     \}}
\DoxyCodeLine{00079 }
\DoxyCodeLine{00080                 \textcolor{keywordflow}{case} Preset.WeaponCannon:}
\DoxyCodeLine{00081                     \{}
\DoxyCodeLine{00082                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00083                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00084                     \}}
\DoxyCodeLine{00085 }
\DoxyCodeLine{00086                 \textcolor{keywordflow}{case} Preset.WeaponScan:}
\DoxyCodeLine{00087                     \{}
\DoxyCodeLine{00088                         SetAllowedType(typeof(IVitalsSystem));}
\DoxyCodeLine{00089                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00090                     \}}
\DoxyCodeLine{00091             \}}
\DoxyCodeLine{00092             \textcolor{keywordflow}{return} \textcolor{keyword}{this};}
\DoxyCodeLine{00093         \}}
\DoxyCodeLine{00094 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00095 \textcolor{preprocessor}{        \#endregion}}
\DoxyCodeLine{00096 }
\DoxyCodeLine{00097 \textcolor{preprocessor}{        \#region Inspector}}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099         [Tooltip(\textcolor{stringliteral}{"{}If ITriggeringComponent has multiple colliders, they will all be capable of triggering Enter/Stay/Exit events. Enabling this prevents that, and will suppress multiple calls on the same object."{}})]}
\DoxyCodeLine{00100         [SerializeField] \textcolor{keyword}{public} \textcolor{keywordtype}{bool} preventRepeats = \textcolor{keyword}{true};}
\DoxyCodeLine{00101         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} PreventRepeats \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} preventRepeats; \} \textcolor{keyword}{set} \{ preventRepeats = value; \} \}}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103         [SerializeField]}
\DoxyCodeLine{00104         [HideInInspector]}
\DoxyCodeLine{00105         \textcolor{keyword}{public} \textcolor{keywordtype}{int}[] \_ignoredSystems;}
\DoxyCodeLine{00106         \textcolor{keyword}{protected} List<Type> ignoredSystems = \textcolor{keyword}{new} List<Type>();}
\DoxyCodeLine{00107 }
\DoxyCodeLine{00108 \textcolor{preprocessor}{        \#endregion}}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110         \textcolor{keyword}{public} List<IOnContactEvent> OnContactEventCallbacks = \textcolor{keyword}{new} List<IOnContactEvent>(1);}
\DoxyCodeLine{00111 }
\DoxyCodeLine{00112         \textcolor{keyword}{private} List<IContactSystem> \_contactSystems = \textcolor{keyword}{new} List<IContactSystem>(0);}
\DoxyCodeLine{00113         \textcolor{keyword}{public} List<IContactSystem> ContactSystems \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_contactSystems; \} \}}
\DoxyCodeLine{00114 }
\DoxyCodeLine{00115 }
\DoxyCodeLine{00116         [Tooltip(\textcolor{stringliteral}{"{}This ContactTrigger can act as a proxy of another. "{}} +}
\DoxyCodeLine{00117             \textcolor{stringliteral}{"{}For example projectiles set the proxy as the shooters ContactTrigger, so projectile hits can be treated as hits by the players weapon. "{}} +}
\DoxyCodeLine{00118             \textcolor{stringliteral}{"{}Default setting is 'this', indicating this isn't a proxy."{}})]}
\DoxyCodeLine{00119         \textcolor{keyword}{public} IContactTrigger \_proxy;}
\DoxyCodeLine{00120         \textcolor{keyword}{public} IContactTrigger Proxy}
\DoxyCodeLine{00121         \{}
\DoxyCodeLine{00122             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} this.\_proxy; \}}
\DoxyCodeLine{00123             \textcolor{keyword}{set} \{ this.\_proxy = value; \}}
\DoxyCodeLine{00124         \}}
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126         \textcolor{keyword}{public} \textcolor{keywordtype}{byte} Index \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00127         }
\DoxyCodeLine{00128         \textcolor{comment}{// cache}}
\DoxyCodeLine{00129         \textcolor{keyword}{protected} NetObject netObj;}
\DoxyCodeLine{00130         \textcolor{keyword}{public} NetObject NetObj \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} netObj; \} \}}
\DoxyCodeLine{00131 }
\DoxyCodeLine{00132         \textcolor{keyword}{protected} ISyncContact syncContact;}
\DoxyCodeLine{00133         \textcolor{keyword}{public} ISyncContact SyncContact \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} syncContact; \} \}}
\DoxyCodeLine{00134 }
\DoxyCodeLine{00135         \textcolor{keyword}{protected} IContactGroupsAssign contactGroupsAssign;}
\DoxyCodeLine{00136         \textcolor{keyword}{public} IContactGroupsAssign ContactGroupsAssign \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} contactGroupsAssign; \} \}}
\DoxyCodeLine{00137 }
\DoxyCodeLine{00138         \textcolor{keyword}{internal} ContactType usedContactTypes;}
\DoxyCodeLine{00139 }
\DoxyCodeLine{00142         \textcolor{keyword}{protected} HashSet<IContactSystem> triggeringHitscans = \textcolor{keyword}{new} HashSet<IContactSystem>();}
\DoxyCodeLine{00143         \textcolor{keyword}{protected} HashSet<IContactSystem> triggeringEnters = \textcolor{keyword}{new} HashSet<IContactSystem>();}
\DoxyCodeLine{00144         \textcolor{keyword}{protected} HashSet<IContactSystem> triggeringStays = \textcolor{keyword}{new} HashSet<IContactSystem>();}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00146 \textcolor{preprocessor}{\#if UNITY\_EDITOR}}
\DoxyCodeLine{00147 }
\DoxyCodeLine{00148         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Reset()}
\DoxyCodeLine{00149         \{}
\DoxyCodeLine{00150             this.\_proxy = \textcolor{keyword}{this};}
\DoxyCodeLine{00151             PollInterfaces();}
\DoxyCodeLine{00152 }
\DoxyCodeLine{00153             FindDerivedTypesFromAssembly();}
\DoxyCodeLine{00154             GetAllowedTypesFromHashes();}
\DoxyCodeLine{00155         \}}
\DoxyCodeLine{00156 }
\DoxyCodeLine{00157 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00158         \textcolor{keyword}{public} \textcolor{keyword}{static} List<IContactSystem> tempFindSystems = \textcolor{keyword}{new} List<IContactSystem>(2);}
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} PollInterfaces()}
\DoxyCodeLine{00161         \{}
\DoxyCodeLine{00162             \_contactSystems.Clear();}
\DoxyCodeLine{00163             transform.GetNestedComponentsInParents<IContactSystem, NetObject>(tempFindSystems);}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165             \textcolor{comment}{// Selectively add ContactSystems selected as valid interactions}}
\DoxyCodeLine{00166             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0, cnt = tempFindSystems.Count; i < cnt;  ++i)}
\DoxyCodeLine{00167             \{}
\DoxyCodeLine{00168                 var found = tempFindSystems[i];}
\DoxyCodeLine{00169                 var foundType = found.GetType();}
\DoxyCodeLine{00170 }
\DoxyCodeLine{00171                 \textcolor{keywordtype}{bool} ignoreSystem = \textcolor{keyword}{false};}
\DoxyCodeLine{00172                 \textcolor{keywordflow}{foreach}(var ignored \textcolor{keywordflow}{in} ignoredSystems)}
\DoxyCodeLine{00173                 \{}
\DoxyCodeLine{00174                     \textcolor{keywordflow}{if} (foundType.CheckIsAssignableFrom(ignored))}
\DoxyCodeLine{00175                     \{}
\DoxyCodeLine{00176                         ignoreSystem = \textcolor{keyword}{true};}
\DoxyCodeLine{00177                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00178                     \}}
\DoxyCodeLine{00179                 \}}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181                 \textcolor{keywordflow}{if} (!ignoreSystem)}
\DoxyCodeLine{00182                     \_contactSystems.Add(tempFindSystems[i]);}
\DoxyCodeLine{00183 }
\DoxyCodeLine{00184             \}}
\DoxyCodeLine{00185             \textcolor{comment}{// Find callback interfaces, but don't recurse past the end of this NetObject, or past any children ContactTriggers}}
\DoxyCodeLine{00186             transform.GetNestedComponentsInChildren(this.OnContactEventCallbacks, \textcolor{keyword}{true}, typeof(NetObject), typeof(IContactTrigger));}
\DoxyCodeLine{00187 }
\DoxyCodeLine{00188         \}}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Awake()}
\DoxyCodeLine{00191         \{}
\DoxyCodeLine{00192             \textcolor{keywordflow}{if} (\_proxy == \textcolor{keyword}{null})}
\DoxyCodeLine{00193                 \_proxy = \textcolor{keyword}{this};}
\DoxyCodeLine{00194 }
\DoxyCodeLine{00195             GetAllowedTypesFromHashes();}
\DoxyCodeLine{00196 }
\DoxyCodeLine{00197             PollInterfaces();}
\DoxyCodeLine{00198 }
\DoxyCodeLine{00199             netObj = transform.GetParentComponent<NetObject>();}
\DoxyCodeLine{00200             syncContact = GetComponent<ISyncContact>();}
\DoxyCodeLine{00201 }
\DoxyCodeLine{00203             contactGroupsAssign = GetComponent<ContactGroupAssign>();}
\DoxyCodeLine{00204             \textcolor{comment}{// If no group assign on this node, find parent and use that if set to apply to children}}
\DoxyCodeLine{00205             \textcolor{keywordflow}{if} (ReferenceEquals(contactGroupsAssign, \textcolor{keyword}{null}))}
\DoxyCodeLine{00206             \{}
\DoxyCodeLine{00207                 var found = transform.GetNestedComponentInParent<IContactGroupsAssign, NetObject>();}
\DoxyCodeLine{00208                 \textcolor{keywordflow}{if} (found != \textcolor{keyword}{null} \&\& found.ApplyToChildren)}
\DoxyCodeLine{00209                     contactGroupsAssign = found;}
\DoxyCodeLine{00210             \}}
\DoxyCodeLine{00211 }
\DoxyCodeLine{00212             \textcolor{comment}{// cache the mask of ContactTypes that will be responded to}}
\DoxyCodeLine{00213             \textcolor{keywordflow}{foreach} (IOnContactEvent cb \textcolor{keywordflow}{in} OnContactEventCallbacks)}
\DoxyCodeLine{00214                 usedContactTypes |= cb.TriggerOn;}
\DoxyCodeLine{00215         \}}
\DoxyCodeLine{00216 }
\DoxyCodeLine{00217         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnEnable()}
\DoxyCodeLine{00218         \{}
\DoxyCodeLine{00219             \textcolor{keywordflow}{if} (preventRepeats)}
\DoxyCodeLine{00220             \{}
\DoxyCodeLine{00221                 NetMasterCallbacks.RegisterCallbackInterfaces(\textcolor{keyword}{this});}
\DoxyCodeLine{00222 }
\DoxyCodeLine{00223                 triggeringHitscans.Clear();}
\DoxyCodeLine{00224                 triggeringEnters.Clear();}
\DoxyCodeLine{00225                 triggeringStays.Clear();}
\DoxyCodeLine{00226             \}}
\DoxyCodeLine{00227         \}}
\DoxyCodeLine{00228 }
\DoxyCodeLine{00229         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnDisable()}
\DoxyCodeLine{00230         \{}
\DoxyCodeLine{00231             \textcolor{keywordflow}{if} (preventRepeats)}
\DoxyCodeLine{00232                 NetMasterCallbacks.RegisterCallbackInterfaces(\textcolor{keyword}{this}, \textcolor{keyword}{false}, \textcolor{keyword}{true});}
\DoxyCodeLine{00233         \}}
\DoxyCodeLine{00234 }
\DoxyCodeLine{00235         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnStateChange(ObjState newState, ObjState previousState, Transform attachmentTransform, Mount attachTo = \textcolor{keyword}{null}, \textcolor{keywordtype}{bool} isReady = \textcolor{keyword}{true})}
\DoxyCodeLine{00236         \{}
\DoxyCodeLine{00237             \textcolor{comment}{// TODO: this is test code. Might need to be more selective about clearing this on state changes.}}
\DoxyCodeLine{00238             \textcolor{keywordflow}{if} (preventRepeats)}
\DoxyCodeLine{00239                 this.triggeringEnters.Clear();}
\DoxyCodeLine{00240         \}}
\DoxyCodeLine{00241 }
\DoxyCodeLine{00242 \textcolor{preprocessor}{        \#region Triggers}}
\DoxyCodeLine{00243 }
\DoxyCodeLine{00244 \textcolor{preprocessor}{        \#region Enter}}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00246         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnTriggerEnter2D(Collider2D other)}
\DoxyCodeLine{00247         \{}
\DoxyCodeLine{00248             Contact(other, ContactType.Enter);}
\DoxyCodeLine{00249         \}}
\DoxyCodeLine{00250         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnTriggerEnter(Collider other)}
\DoxyCodeLine{00251         \{}
\DoxyCodeLine{00252             Contact(other, ContactType.Enter);}
\DoxyCodeLine{00253         \}}
\DoxyCodeLine{00254         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnCollisionEnter2D(Collision2D collision)}
\DoxyCodeLine{00255         \{}
\DoxyCodeLine{00256             Contact(collision.collider, ContactType.Enter);}
\DoxyCodeLine{00257         \}}
\DoxyCodeLine{00258         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnCollisionEnter(Collision collision)}
\DoxyCodeLine{00259         \{}
\DoxyCodeLine{00260             Contact(collision.collider, ContactType.Enter);}
\DoxyCodeLine{00261         \}}
\DoxyCodeLine{00262 }
\DoxyCodeLine{00263 \textcolor{preprocessor}{        \#endregion Enter}}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265 \textcolor{preprocessor}{        \#region Stay}}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnTriggerStay2D(Collider2D other)}
\DoxyCodeLine{00268         \{}
\DoxyCodeLine{00269             Contact(other, ContactType.Stay);}
\DoxyCodeLine{00270         \}}
\DoxyCodeLine{00271         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnTriggerStay(Collider other)}
\DoxyCodeLine{00272         \{}
\DoxyCodeLine{00273             Contact(other, ContactType.Stay);}
\DoxyCodeLine{00274         \}}
\DoxyCodeLine{00275         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnCollisionStay2D(Collision2D collision)}
\DoxyCodeLine{00276         \{}
\DoxyCodeLine{00277             Contact(collision.collider, ContactType.Stay);}
\DoxyCodeLine{00278         \}}
\DoxyCodeLine{00279         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnCollisionStay(Collision collision)}
\DoxyCodeLine{00280         \{}
\DoxyCodeLine{00281             Contact(collision.collider, ContactType.Stay);}
\DoxyCodeLine{00282         \}}
\DoxyCodeLine{00283 }
\DoxyCodeLine{00284 \textcolor{preprocessor}{        \#endregion Stay}}
\DoxyCodeLine{00285 }
\DoxyCodeLine{00286 \textcolor{preprocessor}{        \#region Exit}}
\DoxyCodeLine{00287 }
\DoxyCodeLine{00288         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnTriggerExit2D(Collider2D other)}
\DoxyCodeLine{00289         \{}
\DoxyCodeLine{00290             Contact(other, ContactType.Exit);}
\DoxyCodeLine{00291         \}}
\DoxyCodeLine{00292         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnTriggerExit(Collider other)}
\DoxyCodeLine{00293         \{}
\DoxyCodeLine{00294             Contact(other, ContactType.Exit);}
\DoxyCodeLine{00295         \}}
\DoxyCodeLine{00296         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnCollisionExit2D(Collision2D collision)}
\DoxyCodeLine{00297         \{}
\DoxyCodeLine{00298             Contact(collision.collider, ContactType.Exit);}
\DoxyCodeLine{00299         \}}
\DoxyCodeLine{00300         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnCollisionExit(Collision collision)}
\DoxyCodeLine{00301         \{}
\DoxyCodeLine{00302             Contact(collision.collider, ContactType.Exit);}
\DoxyCodeLine{00303         \}}
\DoxyCodeLine{00304 }
\DoxyCodeLine{00305 \textcolor{preprocessor}{        \#endregion Exit}}
\DoxyCodeLine{00306 }
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308 \textcolor{preprocessor}{        \#endregion Triggers}}
\DoxyCodeLine{00309 }
\DoxyCodeLine{00310 }
\DoxyCodeLine{00314         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Contact(Component otherCollider, ContactType contactType)}
\DoxyCodeLine{00315         \{}
\DoxyCodeLine{00316             \textcolor{comment}{//if (GetComponent<ContactProjectile>() \&\& contactType == ContactType.Enter)}}
\DoxyCodeLine{00317             \textcolor{comment}{//    Debug.Log(name + "{} <b>Prj Contact</b> "{} + otherCollider.name);}}
\DoxyCodeLine{00318 }
\DoxyCodeLine{00319             var otherCT = otherCollider.transform.GetNestedComponentInParents<IContactTrigger, NetObject>();}
\DoxyCodeLine{00320 }
\DoxyCodeLine{00321             \textcolor{keywordflow}{if} (ReferenceEquals(otherCT, \textcolor{keyword}{null}))}
\DoxyCodeLine{00322                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00323 }
\DoxyCodeLine{00324             \textcolor{keywordflow}{if} (CheckIsNested(\textcolor{keyword}{this}, otherCT.Proxy))}
\DoxyCodeLine{00325                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00326 }
\DoxyCodeLine{00327             \textcolor{comment}{//Debug.Log(this.\_proxy.NetObj.name + "{} : "{} + (otherCT as Component).name);}}
\DoxyCodeLine{00329 \textcolor{comment}{}            \textcolor{keywordflow}{if} (ReferenceEquals(this.\_proxy.NetObj, otherCT.Proxy.NetObj))}
\DoxyCodeLine{00330             \{}
\DoxyCodeLine{00331                 \textcolor{comment}{//Debug.Log("{}Early self-\/collide detect "{} + this.\_proxy.NetObj.name + "{} "{} + otherCT.Proxy.NetObj.name);}}
\DoxyCodeLine{00332                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00333             \}}
\DoxyCodeLine{00334 }
\DoxyCodeLine{00335             otherCT.Proxy.OnContact(\textcolor{keyword}{this}, contactType);}
\DoxyCodeLine{00336             this.\_proxy.OnContact(otherCT, contactType);}
\DoxyCodeLine{00337 }
\DoxyCodeLine{00338         \}}
\DoxyCodeLine{00339 }
\DoxyCodeLine{00340         \textcolor{keyword}{protected} \textcolor{keywordtype}{bool} CheckIsNested(IContactTrigger first, IContactTrigger second)}
\DoxyCodeLine{00341         \{}
\DoxyCodeLine{00342             var firstNO = first.NetObj;}
\DoxyCodeLine{00343             var secondNO = second.NetObj;}
\DoxyCodeLine{00344 }
\DoxyCodeLine{00345             var testNO = firstNO;}
\DoxyCodeLine{00346 }
\DoxyCodeLine{00347             \textcolor{keywordflow}{while} (!ReferenceEquals(testNO, \textcolor{keyword}{null}))}
\DoxyCodeLine{00348             \{}
\DoxyCodeLine{00349                 \textcolor{keywordflow}{if} (ReferenceEquals(testNO, secondNO))}
\DoxyCodeLine{00350                 \{}
\DoxyCodeLine{00351                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00352                 \}}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354                 var par = testNO.transform.parent;}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356                 \textcolor{keywordflow}{if} (ReferenceEquals(par, \textcolor{keyword}{null}))}
\DoxyCodeLine{00357                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00358 }
\DoxyCodeLine{00359                 testNO = par.GetParentComponent<NetObject>();}
\DoxyCodeLine{00360             \}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362             testNO = secondNO;}
\DoxyCodeLine{00363 }
\DoxyCodeLine{00364             \textcolor{keywordflow}{while} (!ReferenceEquals(testNO, \textcolor{keyword}{null}))}
\DoxyCodeLine{00365             \{}
\DoxyCodeLine{00366                 \textcolor{keywordflow}{if} (ReferenceEquals(testNO, firstNO))}
\DoxyCodeLine{00367                 \{}
\DoxyCodeLine{00368                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00369                 \}}
\DoxyCodeLine{00370 }
\DoxyCodeLine{00371                 var par = testNO.transform.parent;}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373                 \textcolor{keywordflow}{if} (ReferenceEquals(par, \textcolor{keyword}{null}))}
\DoxyCodeLine{00374                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00375 }
\DoxyCodeLine{00376                 testNO = par.GetParentComponent<NetObject>();}
\DoxyCodeLine{00377             \}}
\DoxyCodeLine{00378 }
\DoxyCodeLine{00379             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00380         \}}
\DoxyCodeLine{00381 }
\DoxyCodeLine{00382         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnContact(IContactTrigger otherCT, ContactType contactType)}
\DoxyCodeLine{00383         \{}
\DoxyCodeLine{00384 }
\DoxyCodeLine{00385             \textcolor{keywordflow}{if} (GetComponent<ContactProjectile>() \&\& contactType == ContactType.Enter)}
\DoxyCodeLine{00386                 Debug.Log(\textcolor{stringliteral}{"{}Prj Contact"{}});}
\DoxyCodeLine{00387 }
\DoxyCodeLine{00388 }
\DoxyCodeLine{00389 }
\DoxyCodeLine{00391             List<IContactSystem> systems = otherCT.Proxy.ContactSystems;}
\DoxyCodeLine{00392 }
\DoxyCodeLine{00393             \textcolor{keywordtype}{int} systemsCount = systems.Count;}
\DoxyCodeLine{00394 }
\DoxyCodeLine{00395             \textcolor{keywordflow}{if} (systemsCount == 0)}
\DoxyCodeLine{00396                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00397 }
\DoxyCodeLine{00399             \textcolor{keywordflow}{if} (netObj != \textcolor{keyword}{null} \&\& !this.\_proxy.NetObj.AllObjsAreReady)}
\DoxyCodeLine{00400             \{}
\DoxyCodeLine{00401                 \textcolor{comment}{//Debug.LogError(Time.time + name + "{} "{} + \_proxy.NetObj.photonView.OwnerActorNr + "{} Not ready so ignoring contact"{});}}
\DoxyCodeLine{00402                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00403             \}}
\DoxyCodeLine{00404 }
\DoxyCodeLine{00405             var otherNetObj = otherCT.Proxy.NetObj;}
\DoxyCodeLine{00406 }
\DoxyCodeLine{00407             \textcolor{keywordflow}{if} (otherNetObj != \textcolor{keyword}{null} \&\& !otherNetObj.AllObjsAreReady)}
\DoxyCodeLine{00408             \{}
\DoxyCodeLine{00409                 Debug.Log(Time.time + name + \textcolor{stringliteral}{"{} "{}} + otherNetObj.photonView.OwnerActorNr + \textcolor{stringliteral}{"{} Other object not ready so ignoring contact"{}});}
\DoxyCodeLine{00410                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00411             \}}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < systemsCount; i++)}
\DoxyCodeLine{00414             \{}
\DoxyCodeLine{00415                 var system = systems[i];}
\DoxyCodeLine{00416 }
\DoxyCodeLine{00417                 \textcolor{keywordflow}{if} (!IsCompatibleSystem(system, otherCT))}
\DoxyCodeLine{00418                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00419 }
\DoxyCodeLine{00420                 \textcolor{comment}{//Debug.Log(name + "{} "{} + GetType().Name + "{} <> "{} + ics.GetType().Name + "{} <b>PASSED</b>"{});}}
\DoxyCodeLine{00422 \textcolor{comment}{}                \textcolor{keywordflow}{if} (preventRepeats)}
\DoxyCodeLine{00423                 \{}
\DoxyCodeLine{00424                     \textcolor{keywordflow}{switch} (contactType)}
\DoxyCodeLine{00425                     \{}
\DoxyCodeLine{00426                         \textcolor{keywordflow}{case} ContactType.Enter:}
\DoxyCodeLine{00427                             \{}
\DoxyCodeLine{00428                                 \textcolor{keywordflow}{if} (triggeringEnters.Contains(system))}
\DoxyCodeLine{00429                                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00430 }
\DoxyCodeLine{00431                                 triggeringEnters.Add(system);}
\DoxyCodeLine{00432                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{00433                             \}}
\DoxyCodeLine{00434                         \textcolor{keywordflow}{case} ContactType.Stay:}
\DoxyCodeLine{00435                             \{}
\DoxyCodeLine{00436                                 \textcolor{keywordflow}{if} (triggeringStays.Contains(system))}
\DoxyCodeLine{00437                                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00438 }
\DoxyCodeLine{00439                                 triggeringStays.Add(system);}
\DoxyCodeLine{00440                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{00441                             \}}
\DoxyCodeLine{00442                         \textcolor{keywordflow}{case} ContactType.Exit:}
\DoxyCodeLine{00443                             \{}
\DoxyCodeLine{00444                                 \textcolor{keywordflow}{if} (!triggeringEnters.Contains(system))}
\DoxyCodeLine{00445                                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00446 }
\DoxyCodeLine{00447                                 triggeringEnters.Remove(system);}
\DoxyCodeLine{00448                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{00449                             \}}
\DoxyCodeLine{00450                         \textcolor{keywordflow}{case} ContactType.Hitscan:}
\DoxyCodeLine{00451                             \{}
\DoxyCodeLine{00452                                 \textcolor{keywordflow}{if} (triggeringHitscans.Contains(system))}
\DoxyCodeLine{00453                                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455                                 triggeringHitscans.Add(system);}
\DoxyCodeLine{00456                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{00457                             \}}
\DoxyCodeLine{00458                     \}}
\DoxyCodeLine{00459                 \}}
\DoxyCodeLine{00460 }
\DoxyCodeLine{00461                 \textcolor{comment}{//Debug.Log("{}Other "{} + (otherCT as Component).name + "{} : "{} + (otherCT as Component).GetType().Name);}}
\DoxyCodeLine{00462 }
\DoxyCodeLine{00464                 \textcolor{keywordflow}{if} ((usedContactTypes \& contactType) == 0)}
\DoxyCodeLine{00465                 \{}
\DoxyCodeLine{00466                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00467                 \}}
\DoxyCodeLine{00468 }
\DoxyCodeLine{00470                 var contactEvent = \textcolor{keyword}{new} ContactEvent(system, otherCT, contactType);}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472                 \textcolor{keywordflow}{if} (ReferenceEquals(Proxy.SyncContact, \textcolor{keyword}{null}))}
\DoxyCodeLine{00473                 \{}
\DoxyCodeLine{00474                     ContactCallbacks(contactEvent);}
\DoxyCodeLine{00475                 \}}
\DoxyCodeLine{00476                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{00477                 \{}
\DoxyCodeLine{00478                     syncContact.SyncContactEvent(contactEvent);}
\DoxyCodeLine{00479                 \}}
\DoxyCodeLine{00480             \}}
\DoxyCodeLine{00481         \}}
\DoxyCodeLine{00482 }
\DoxyCodeLine{00483         \textcolor{keyword}{public} \textcolor{keyword}{virtual} Consumption ContactCallbacks(ContactEvent contactEvent)}
\DoxyCodeLine{00484         \{}
\DoxyCodeLine{00485             \textcolor{comment}{//if (contactEvent.contactType == ContactType.Enter)}}
\DoxyCodeLine{00486             \textcolor{comment}{//    Debug.Log("{}ContactCallbacks "{} + contactEvent);}}
\DoxyCodeLine{00487 }
\DoxyCodeLine{00488             Consumption consumption = Consumption.None;}
\DoxyCodeLine{00489 }
\DoxyCodeLine{00490             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0, cnt = this.OnContactEventCallbacks.Count; i < cnt; ++i)}
\DoxyCodeLine{00491             \{}
\DoxyCodeLine{00492                 consumption |= this.OnContactEventCallbacks[i].OnContactEvent(contactEvent);}
\DoxyCodeLine{00493                 \textcolor{keywordflow}{if} (consumption == Consumption.All)}
\DoxyCodeLine{00494                     \textcolor{keywordflow}{return} Consumption.All;}
\DoxyCodeLine{00495             \}}
\DoxyCodeLine{00496 }
\DoxyCodeLine{00497             \textcolor{keywordflow}{return} consumption;}
\DoxyCodeLine{00498         \}}
\DoxyCodeLine{00499 }
\DoxyCodeLine{00503         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnPreSimulate(\textcolor{keywordtype}{int} frameId, \textcolor{keywordtype}{int} subFrameId)}
\DoxyCodeLine{00504         \{}
\DoxyCodeLine{00505             \textcolor{keywordflow}{if} (preventRepeats)}
\DoxyCodeLine{00506             \{}
\DoxyCodeLine{00507                 triggeringHitscans.Clear();}
\DoxyCodeLine{00508                 triggeringStays.Clear();}
\DoxyCodeLine{00509             \}}
\DoxyCodeLine{00510         \}}
\DoxyCodeLine{00511 }
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513         \textcolor{comment}{// Convert our serialized allowed hashes into a usable HashSet.}}
\DoxyCodeLine{00514         \textcolor{keyword}{internal} \textcolor{keywordtype}{void} GetAllowedTypesFromHashes()}
\DoxyCodeLine{00515         \{}
\DoxyCodeLine{00516             ignoredSystems.Clear();}
\DoxyCodeLine{00517 }
\DoxyCodeLine{00518             \textcolor{comment}{// No serialized system hashes to ignore. Do nothing.}}
\DoxyCodeLine{00519             \textcolor{keywordflow}{if} (\_ignoredSystems == \textcolor{keyword}{null})}
\DoxyCodeLine{00520                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00521 }
\DoxyCodeLine{00522             \textcolor{keywordflow}{foreach} (var type \textcolor{keywordflow}{in} contactSystemTypes)}
\DoxyCodeLine{00523             \{}
\DoxyCodeLine{00524                 \textcolor{keywordtype}{int} hash = type.Name.GetHashCode();}
\DoxyCodeLine{00525                 }
\DoxyCodeLine{00526                 \textcolor{keywordtype}{bool} ignore = \textcolor{keyword}{false};}
\DoxyCodeLine{00527                 \textcolor{keywordflow}{foreach} (var allowed \textcolor{keywordflow}{in} \_ignoredSystems)}
\DoxyCodeLine{00528                 \{}
\DoxyCodeLine{00529                     \textcolor{keywordflow}{if} (allowed == hash)}
\DoxyCodeLine{00530                         ignore = \textcolor{keyword}{true};}
\DoxyCodeLine{00531                 \}}
\DoxyCodeLine{00532 }
\DoxyCodeLine{00533                 \textcolor{keywordflow}{if} (ignore)}
\DoxyCodeLine{00534                     ignoredSystems.Add(type);}
\DoxyCodeLine{00535             \}}
\DoxyCodeLine{00536         \}}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538 \textcolor{preprocessor}{\#if UNITY\_EDITOR}}
\DoxyCodeLine{00539 }
\DoxyCodeLine{00540         \textcolor{keyword}{protected} \textcolor{keywordtype}{void} SetAllowedType(params Type[] allowed)}
\DoxyCodeLine{00541         \{}
\DoxyCodeLine{00542             List<int> disallowed = \textcolor{keyword}{new} List<int>();}
\DoxyCodeLine{00543 }
\DoxyCodeLine{00544             \textcolor{keywordflow}{foreach} (var type \textcolor{keywordflow}{in} contactSystemTypes)}
\DoxyCodeLine{00545             \{}
\DoxyCodeLine{00546                 \textcolor{keywordtype}{bool} allow = \textcolor{keyword}{false};}
\DoxyCodeLine{00547 }
\DoxyCodeLine{00548                 \textcolor{keywordflow}{foreach} (var a \textcolor{keywordflow}{in} allowed)}
\DoxyCodeLine{00549                 \{}
\DoxyCodeLine{00550                     \textcolor{keywordflow}{if} (a.CheckIsAssignableFrom(type))}
\DoxyCodeLine{00551                     \{}
\DoxyCodeLine{00552                         allow = \textcolor{keyword}{true};}
\DoxyCodeLine{00553                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00554                     \}}
\DoxyCodeLine{00555                 \}}
\DoxyCodeLine{00556 }
\DoxyCodeLine{00557                 \textcolor{keywordflow}{if} (!allow)}
\DoxyCodeLine{00558                 \{}
\DoxyCodeLine{00559                     \textcolor{keywordtype}{int} hash = type.Name.GetHashCode();}
\DoxyCodeLine{00560                     disallowed.Add(hash);}
\DoxyCodeLine{00561                 \}}
\DoxyCodeLine{00562                 }
\DoxyCodeLine{00563             \}}
\DoxyCodeLine{00564             \_ignoredSystems = disallowed.ToArray();}
\DoxyCodeLine{00565         \}}
\DoxyCodeLine{00566 }
\DoxyCodeLine{00567 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00568 }
\DoxyCodeLine{00569 }
\DoxyCodeLine{00570         \textcolor{keyword}{internal} \textcolor{keyword}{static} List<Type> contactSystemTypes = \textcolor{keyword}{new} List<Type>();}
\DoxyCodeLine{00571 }
\DoxyCodeLine{00575         \textcolor{keyword}{internal} \textcolor{keyword}{static} \textcolor{keywordtype}{void} FindDerivedTypesFromAssembly()}
\DoxyCodeLine{00576         \{}
\DoxyCodeLine{00577             contactSystemTypes.Clear();}
\DoxyCodeLine{00578 }
\DoxyCodeLine{00579             \textcolor{keywordflow}{foreach} (var assembly \textcolor{keywordflow}{in} AppDomain.CurrentDomain.GetAssemblies())}
\DoxyCodeLine{00580             \{}
\DoxyCodeLine{00581                 var types = assembly.GetTypes();}
\DoxyCodeLine{00582 }
\DoxyCodeLine{00583                 \textcolor{keywordflow}{foreach} (var type \textcolor{keywordflow}{in} types)}
\DoxyCodeLine{00584                 \{}
\DoxyCodeLine{00585                     \textcolor{keywordflow}{if} (type.IsAbstract)}
\DoxyCodeLine{00586                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00587 }
\DoxyCodeLine{00588                     \textcolor{comment}{//bool assignable = type.CheckIsAssignableFrom(typeof(IContactSystem)); //.GetInterface(typeof(IContactSystem));}}
\DoxyCodeLine{00589                     \textcolor{keywordtype}{bool} assignable = typeof(IContactSystem).CheckIsAssignableFrom(type); \textcolor{comment}{//.GetInterface(typeof(IContactSystem));}}
\DoxyCodeLine{00590 }
\DoxyCodeLine{00591                     \textcolor{keywordflow}{if} (assignable)}
\DoxyCodeLine{00592                     \{}
\DoxyCodeLine{00593                         contactSystemTypes.Add(type);}
\DoxyCodeLine{00594                     \}}
\DoxyCodeLine{00595                 \}}
\DoxyCodeLine{00596             \}}
\DoxyCodeLine{00597         \}}
\DoxyCodeLine{00598 }
\DoxyCodeLine{00599         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} IsCompatibleSystem(IContactSystem system, IContactTrigger ct)}
\DoxyCodeLine{00600         \{}
\DoxyCodeLine{00601             var sysType = system.GetType();}
\DoxyCodeLine{00602 }
\DoxyCodeLine{00603             \textcolor{keywordflow}{foreach} (var ignored \textcolor{keywordflow}{in} ignoredSystems)}
\DoxyCodeLine{00604             \{}
\DoxyCodeLine{00605                 \textcolor{comment}{//Debug.Log(sysType + "{} <b> compare </b> "{} + ignored + "{} "{} + sysType.CheckIsAssignableFrom(ignored) + "{}:"{} + ignored.CheckIsAssignableFrom(sysType));}}
\DoxyCodeLine{00606 }
\DoxyCodeLine{00607                 \textcolor{comment}{//if (sysType.CheckIsAssignableFrom(ignored))}}
\DoxyCodeLine{00608                 \textcolor{keywordflow}{if} (ignored.CheckIsAssignableFrom(sysType))}
\DoxyCodeLine{00609                         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00610             \}}
\DoxyCodeLine{00611 }
\DoxyCodeLine{00612             \textcolor{comment}{//Debug.Log(name + "{} <> "{} + (ct as Component).name  + "{} <b>match</b> "{} + sysType.Name);}}
\DoxyCodeLine{00613             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00614         \}}
\DoxyCodeLine{00615 }
\DoxyCodeLine{00616     \}}
\DoxyCodeLine{00617 }
\DoxyCodeLine{00618 }
\DoxyCodeLine{00619 \textcolor{preprocessor}{\#if UNITY\_EDITOR}}
\DoxyCodeLine{00620 }
\DoxyCodeLine{00621     [CustomEditor(typeof(ContactTrigger))]}
\DoxyCodeLine{00622     [CanEditMultipleObjects]}
\DoxyCodeLine{00623     \textcolor{keyword}{public} \textcolor{keyword}{class }ContactTriggerEditor : TriggerHeaderEditor}
\DoxyCodeLine{00624     \{}
\DoxyCodeLine{00625         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{string} HelpURL}
\DoxyCodeLine{00626         \{}
\DoxyCodeLine{00627             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} SimpleDocsURLS.SYNCCOMPS\_PATH + \textcolor{stringliteral}{"{}\#contacttrigger\_component"{}}; \}}
\DoxyCodeLine{00628         \}}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{string} Instructions}
\DoxyCodeLine{00631         \{}
\DoxyCodeLine{00632             \textcolor{keyword}{get}}
\DoxyCodeLine{00633             \{}
\DoxyCodeLine{00634                 \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Responds to Trigger/Collision/Scan events between this and other "{}} + typeof(IContactTrigger).Name + \textcolor{stringliteral}{"{} components. "{}} +}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636                     typeof(IOnContactEvent).Name + \textcolor{stringliteral}{"{} callbacks are generated for each applicable "{}} + typeof(IContactSystem).Name + \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{00637             \}}
\DoxyCodeLine{00638         \}}
\DoxyCodeLine{00639 }
\DoxyCodeLine{00640         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{string} TextTexturePath \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Header/ContactTriggerText"{}}; \} \}}
\DoxyCodeLine{00641 }
\DoxyCodeLine{00642         \textcolor{keyword}{protected} \textcolor{keyword}{static} GUIStyle ifaceBox;}
\DoxyCodeLine{00643         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnEnable()}
\DoxyCodeLine{00644         \{}
\DoxyCodeLine{00645             base.OnEnable();}
\DoxyCodeLine{00646             var \_target = (target as ContactTrigger);}
\DoxyCodeLine{00647             \_target.GetAllowedTypesFromHashes();}
\DoxyCodeLine{00648             \_target.PollInterfaces();}
\DoxyCodeLine{00649         \}}
\DoxyCodeLine{00650 }
\DoxyCodeLine{00651         \textcolor{keyword}{private} \textcolor{keyword}{static} HashSet<int> tempOldHashes = \textcolor{keyword}{new} HashSet<int>();}
\DoxyCodeLine{00652         \textcolor{keyword}{private} \textcolor{keyword}{static} List<int> tempNewHashes = \textcolor{keyword}{new} List<int>();}
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnInspectorGUIInjectMiddle()}
\DoxyCodeLine{00655         \{}
\DoxyCodeLine{00656             \textcolor{keywordflow}{if} (ifaceBox == \textcolor{keyword}{null})}
\DoxyCodeLine{00657                 ifaceBox = \textcolor{keyword}{new} GUIStyle(\textcolor{stringliteral}{"{}HelpBox"{}}) \{ padding = \textcolor{keyword}{new} RectOffset(10, 6, 6, 6) \};}
\DoxyCodeLine{00658 }
\DoxyCodeLine{00659             base.OnInspectorGUIInjectMiddle();}
\DoxyCodeLine{00660             var \_target = (target as ContactTrigger);}
\DoxyCodeLine{00661 }
\DoxyCodeLine{00662             \textcolor{comment}{// If this generates a "{}hash already exists"{} error, then this is a freak occurrence of two interfaces producing the same hash.}}
\DoxyCodeLine{00663             tempOldHashes.Clear();}
\DoxyCodeLine{00664             tempNewHashes.Clear();}
\DoxyCodeLine{00665 }
\DoxyCodeLine{00666             \textcolor{keywordflow}{if} (\_target.\_ignoredSystems != \textcolor{keyword}{null})}
\DoxyCodeLine{00667                 \textcolor{keywordflow}{foreach} (var h \textcolor{keywordflow}{in} \_target.\_ignoredSystems)}
\DoxyCodeLine{00668                     tempOldHashes.Add(h);}
\DoxyCodeLine{00669 }
\DoxyCodeLine{00670 }
\DoxyCodeLine{00671             EditorGUILayout.BeginVertical(\textcolor{stringliteral}{"{}HelpBox"{}}); \textcolor{comment}{// ifaceBox);}}
\DoxyCodeLine{00672             \{}
\DoxyCodeLine{00673                 \textcolor{keywordtype}{bool} systemChanged = \textcolor{keyword}{false};}
\DoxyCodeLine{00674                 \textcolor{keywordflow}{foreach} (var type \textcolor{keywordflow}{in} ContactTrigger.contactSystemTypes)}
\DoxyCodeLine{00675                 \{}
\DoxyCodeLine{00676                     \textcolor{keywordtype}{int} hash = type.Name.GetHashCode();}
\DoxyCodeLine{00677                     \textcolor{keywordtype}{bool} prev = !tempOldHashes.Contains(hash);}
\DoxyCodeLine{00678                     \textcolor{keywordtype}{bool} allowed = EditorGUILayout.ToggleLeft(type.Name, prev);}
\DoxyCodeLine{00679 }
\DoxyCodeLine{00680                     \textcolor{keywordflow}{if} (allowed != prev)}
\DoxyCodeLine{00681                         systemChanged = \textcolor{keyword}{true};}
\DoxyCodeLine{00682 }
\DoxyCodeLine{00683                     \textcolor{keywordflow}{if} (!allowed)}
\DoxyCodeLine{00684                         tempNewHashes.Add(hash);}
\DoxyCodeLine{00685                 \}}
\DoxyCodeLine{00686                 \textcolor{keywordflow}{if} (systemChanged)}
\DoxyCodeLine{00687                 \{}
\DoxyCodeLine{00688                     Undo.RecordObject(target, \textcolor{stringliteral}{"{}Selected ContactSystems changed"{}});}
\DoxyCodeLine{00689                     \_target.\_ignoredSystems = tempNewHashes.ToArray();}
\DoxyCodeLine{00690                     \_target.GetAllowedTypesFromHashes();}
\DoxyCodeLine{00691                     \_target.PollInterfaces();}
\DoxyCodeLine{00692                 \}}
\DoxyCodeLine{00693 }
\DoxyCodeLine{00694             \}}
\DoxyCodeLine{00695             EditorGUILayout.EndVertical();}
\DoxyCodeLine{00696 }
\DoxyCodeLine{00697 }
\DoxyCodeLine{00698             EditorGUILayout.BeginVertical(ifaceBox);}
\DoxyCodeLine{00699             \{}
\DoxyCodeLine{00700                 FoundInterfaces(\textcolor{stringliteral}{"{}Found "{}} + typeof(IContactSystem).Name + \textcolor{stringliteral}{"{}s:"{}}, \_target.ContactSystems);}
\DoxyCodeLine{00701             \}}
\DoxyCodeLine{00702             EditorGUILayout.EndVertical();}
\DoxyCodeLine{00703 }
\DoxyCodeLine{00704             EditorGUILayout.BeginVertical(ifaceBox);}
\DoxyCodeLine{00705             \{}
\DoxyCodeLine{00706                 FoundInterfaces(\textcolor{stringliteral}{"{}Found "{}} + typeof(IOnContactEvent).Name + \textcolor{stringliteral}{"{}s:"{}}, \_target.OnContactEventCallbacks);}
\DoxyCodeLine{00707             \}}
\DoxyCodeLine{00708             EditorGUILayout.EndVertical();}
\DoxyCodeLine{00709         \}}
\DoxyCodeLine{00710 }
\DoxyCodeLine{00711         \textcolor{keyword}{private} \textcolor{keywordtype}{void} FoundInterfaces<T>(\textcolor{keywordtype}{string} label, List<T> list)}
\DoxyCodeLine{00712         \{}
\DoxyCodeLine{00713 }
\DoxyCodeLine{00714             EditorGUILayout.LabelField(label);}
\DoxyCodeLine{00715 }
\DoxyCodeLine{00716             EditorGUI.BeginDisabledGroup(\textcolor{keyword}{true});}
\DoxyCodeLine{00717 }
\DoxyCodeLine{00718             \textcolor{keywordflow}{if} (list.Count > 0)}
\DoxyCodeLine{00719                 \textcolor{keywordflow}{foreach} (var c \textcolor{keywordflow}{in} list)}
\DoxyCodeLine{00720                 \{}
\DoxyCodeLine{00721                     var comp = c as Component;}
\DoxyCodeLine{00722                     EditorGUILayout.ObjectField(comp, typeof(Component), \textcolor{keyword}{false});}
\DoxyCodeLine{00723                 \}}
\DoxyCodeLine{00724             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00725                 EditorGUILayout.LabelField(\textcolor{stringliteral}{"{}none"{}}, \textcolor{keyword}{new} GUIStyle(\textcolor{stringliteral}{"{}Label"{}}) \{ padding  =\textcolor{keyword}{new} RectOffset(6, 0, 0 , 0), fontSize = 11, fontStyle = FontStyle.Italic \});}
\DoxyCodeLine{00726 }
\DoxyCodeLine{00727             EditorGUI.EndDisabledGroup();}
\DoxyCodeLine{00728 }
\DoxyCodeLine{00729         \}}
\DoxyCodeLine{00730 }
\DoxyCodeLine{00731         \textcolor{keyword}{private} Texture2D MakeTex(\textcolor{keywordtype}{int} width, \textcolor{keywordtype}{int} height, Color col)}
\DoxyCodeLine{00732         \{}
\DoxyCodeLine{00733             Color[] pix = \textcolor{keyword}{new} Color[width * height];}
\DoxyCodeLine{00734 }
\DoxyCodeLine{00735             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < pix.Length; i++)}
\DoxyCodeLine{00736                 pix[i] = col;}
\DoxyCodeLine{00737 }
\DoxyCodeLine{00738             Texture2D result = \textcolor{keyword}{new} Texture2D(width, height);}
\DoxyCodeLine{00739             result.SetPixels(pix);}
\DoxyCodeLine{00740             result.Apply();}
\DoxyCodeLine{00741 }
\DoxyCodeLine{00742             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00743         \}}
\DoxyCodeLine{00744     \}}
\DoxyCodeLine{00745 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00746 \}}
\DoxyCodeLine{00747 }

\end{DoxyCode}
