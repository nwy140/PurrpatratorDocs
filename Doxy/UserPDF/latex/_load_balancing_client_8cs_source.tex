\doxysection{Load\+Balancing\+Client.\+cs}
\label{_load_balancing_client_8cs_source}\index{C:/\_SSDSPEEDUP/2021/GPS/gps2\_purrpatrator/GPS2\_Purrpatrator/Assets/Photon/PhotonRealtime/Code/LoadBalancingClient.cs@{C:/\_SSDSPEEDUP/2021/GPS/gps2\_purrpatrator/GPS2\_Purrpatrator/Assets/Photon/PhotonRealtime/Code/LoadBalancingClient.cs}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002 \textcolor{comment}{// <copyright file="{}LoadBalancingClient.cs"{} company="{}Exit Games GmbH"{}>}}
\DoxyCodeLine{00003 \textcolor{comment}{//   Loadbalancing Framework for Photon -\/ Copyright (C) 2018 Exit Games GmbH}}
\DoxyCodeLine{00004 \textcolor{comment}{// </copyright>}}
\DoxyCodeLine{00005 \textcolor{comment}{// <summary>}}
\DoxyCodeLine{00006 \textcolor{comment}{//   Provides the operations and a state for games using the}}
\DoxyCodeLine{00007 \textcolor{comment}{//   Photon LoadBalancing server.}}
\DoxyCodeLine{00008 \textcolor{comment}{// </summary>}}
\DoxyCodeLine{00009 \textcolor{comment}{// <author>developer@photonengine.com</author>}}
\DoxyCodeLine{00010 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00011 }
\DoxyCodeLine{00012 \textcolor{preprocessor}{\#if UNITY\_4\_7 || UNITY\_5 || UNITY\_5\_3\_OR\_NEWER}}
\DoxyCodeLine{00013 \textcolor{preprocessor}{\#define SUPPORTED\_UNITY}}
\DoxyCodeLine{00014 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00015 }
\DoxyCodeLine{00016 }
\DoxyCodeLine{00017 \textcolor{keyword}{namespace }Photon.Realtime}
\DoxyCodeLine{00018 \{}
\DoxyCodeLine{00019     \textcolor{keyword}{using} System;}
\DoxyCodeLine{00020     \textcolor{keyword}{using} System.Collections;}
\DoxyCodeLine{00021     \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00022     \textcolor{keyword}{using} System.Diagnostics;}
\DoxyCodeLine{00023     \textcolor{keyword}{using} ExitGames.Client.Photon;}
\DoxyCodeLine{00024 }
\DoxyCodeLine{00025 \textcolor{preprocessor}{    \#if SUPPORTED\_UNITY}}
\DoxyCodeLine{00026     \textcolor{keyword}{using} UnityEngine;}
\DoxyCodeLine{00027     \textcolor{keyword}{using} Debug = UnityEngine.Debug;}
\DoxyCodeLine{00028 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{00029 \textcolor{preprocessor}{    \#if SUPPORTED\_UNITY || NETFX\_CORE}}
\DoxyCodeLine{00030     \textcolor{keyword}{using} Hashtable = ExitGames.Client.Photon.Hashtable;}
\DoxyCodeLine{00031     \textcolor{keyword}{using} SupportClass = ExitGames.Client.Photon.SupportClass;}
\DoxyCodeLine{00032 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035 \textcolor{preprocessor}{    \#region Enums}}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00041     \textcolor{keyword}{public} \textcolor{keyword}{enum} ClientState}
\DoxyCodeLine{00042     \{}
\DoxyCodeLine{00044         PeerCreated,}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00047         Authenticating,}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00050         Authenticated,}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00053         JoiningLobby,}
\DoxyCodeLine{00054 }
\DoxyCodeLine{00056         JoinedLobby,}
\DoxyCodeLine{00057 }
\DoxyCodeLine{00059         DisconnectingFromMasterServer,}
\DoxyCodeLine{00060         [Obsolete(\textcolor{stringliteral}{"{}Renamed to DisconnectingFromMasterServer"{}})]}
\DoxyCodeLine{00061         DisconnectingFromMasterserver = DisconnectingFromMasterServer,}
\DoxyCodeLine{00062 }
\DoxyCodeLine{00064         ConnectingToGameServer,}
\DoxyCodeLine{00065         [Obsolete(\textcolor{stringliteral}{"{}Renamed to ConnectingToGameServer"{}})]}
\DoxyCodeLine{00066         ConnectingToGameserver = ConnectingToGameServer,}
\DoxyCodeLine{00067 }
\DoxyCodeLine{00069         ConnectedToGameServer,}
\DoxyCodeLine{00070         [Obsolete(\textcolor{stringliteral}{"{}Renamed to ConnectedToGameServer"{}})]}
\DoxyCodeLine{00071         ConnectedToGameserver = ConnectedToGameServer,}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00074         Joining,}
\DoxyCodeLine{00075 }
\DoxyCodeLine{00077         Joined,}
\DoxyCodeLine{00078 }
\DoxyCodeLine{00080         Leaving,}
\DoxyCodeLine{00081 }
\DoxyCodeLine{00083         DisconnectingFromGameServer,}
\DoxyCodeLine{00084         [Obsolete(\textcolor{stringliteral}{"{}Renamed to DisconnectingFromGameServer"{}})]}
\DoxyCodeLine{00085         DisconnectingFromGameserver = DisconnectingFromGameServer,}
\DoxyCodeLine{00086 }
\DoxyCodeLine{00088         ConnectingToMasterServer,}
\DoxyCodeLine{00089         [Obsolete(\textcolor{stringliteral}{"{}Renamed to ConnectingToMasterServer."{}})]}
\DoxyCodeLine{00090         ConnectingToMasterserver = ConnectingToMasterServer,}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00093         Disconnecting,}
\DoxyCodeLine{00094 }
\DoxyCodeLine{00096         Disconnected,}
\DoxyCodeLine{00097 }
\DoxyCodeLine{00099         ConnectedToMasterServer,}
\DoxyCodeLine{00100         [Obsolete(\textcolor{stringliteral}{"{}Renamed to ConnectedToMasterServer."{}})]}
\DoxyCodeLine{00101         ConnectedToMasterserver = ConnectedToMasterServer,}
\DoxyCodeLine{00102         [Obsolete(\textcolor{stringliteral}{"{}Renamed to ConnectedToMasterServer."{}})]}
\DoxyCodeLine{00103         ConnectedToMaster = ConnectedToMasterServer,}
\DoxyCodeLine{00104 }
\DoxyCodeLine{00106         ConnectingToNameServer,}
\DoxyCodeLine{00107 }
\DoxyCodeLine{00109         ConnectedToNameServer,}
\DoxyCodeLine{00110 }
\DoxyCodeLine{00112         DisconnectingFromNameServer,}
\DoxyCodeLine{00113 }
\DoxyCodeLine{00115         ConnectWithFallbackProtocol}
\DoxyCodeLine{00116     \}}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118 }
\DoxyCodeLine{00122     \textcolor{keyword}{internal} \textcolor{keyword}{enum} JoinType}
\DoxyCodeLine{00123     \{}
\DoxyCodeLine{00125         CreateRoom,}
\DoxyCodeLine{00127         JoinRoom,}
\DoxyCodeLine{00129         JoinRandomRoom,}
\DoxyCodeLine{00131         JoinRandomOrCreateRoom,}
\DoxyCodeLine{00133         JoinOrCreateRoom}
\DoxyCodeLine{00134     \}}
\DoxyCodeLine{00135 }
\DoxyCodeLine{00138     \textcolor{keyword}{public} \textcolor{keyword}{enum} DisconnectCause}
\DoxyCodeLine{00139     \{}
\DoxyCodeLine{00141         None,}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00144         ExceptionOnConnect,}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00147         DnsExceptionOnConnect,}
\DoxyCodeLine{00148 }
\DoxyCodeLine{00150         ServerAddressInvalid,}
\DoxyCodeLine{00151 }
\DoxyCodeLine{00153         Exception,}
\DoxyCodeLine{00154 }
\DoxyCodeLine{00156         ServerTimeout,}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00159         ClientTimeout,}
\DoxyCodeLine{00160 }
\DoxyCodeLine{00162         DisconnectByServerLogic,}
\DoxyCodeLine{00163 }
\DoxyCodeLine{00165         DisconnectByServerReasonUnknown,}
\DoxyCodeLine{00166 }
\DoxyCodeLine{00168         InvalidAuthentication,}
\DoxyCodeLine{00169 }
\DoxyCodeLine{00171         CustomAuthenticationFailed,}
\DoxyCodeLine{00172 }
\DoxyCodeLine{00174         AuthenticationTicketExpired,}
\DoxyCodeLine{00175 }
\DoxyCodeLine{00177         MaxCcuReached,}
\DoxyCodeLine{00178 }
\DoxyCodeLine{00180         InvalidRegion,}
\DoxyCodeLine{00181 }
\DoxyCodeLine{00183         OperationNotAllowedInCurrentState,}
\DoxyCodeLine{00184 }
\DoxyCodeLine{00186         DisconnectByClientLogic,}
\DoxyCodeLine{00187 }
\DoxyCodeLine{00190         DisconnectByOperationLimit,}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00193         DisconnectByDisconnectMessage}
\DoxyCodeLine{00194     \}}
\DoxyCodeLine{00195 }
\DoxyCodeLine{00198     \textcolor{keyword}{public} \textcolor{keyword}{enum} ServerConnection}
\DoxyCodeLine{00199     \{}
\DoxyCodeLine{00201         MasterServer,}
\DoxyCodeLine{00203         GameServer,}
\DoxyCodeLine{00205         NameServer}
\DoxyCodeLine{00206     \}}
\DoxyCodeLine{00207 }
\DoxyCodeLine{00209     \textcolor{keyword}{public} \textcolor{keyword}{enum} ClientAppType}
\DoxyCodeLine{00210     \{}
\DoxyCodeLine{00212         Realtime,}
\DoxyCodeLine{00214         Voice,}
\DoxyCodeLine{00216         Fusion}
\DoxyCodeLine{00217     \}}
\DoxyCodeLine{00218 }
\DoxyCodeLine{00222     \textcolor{keyword}{public} \textcolor{keyword}{enum} EncryptionMode}
\DoxyCodeLine{00223     \{}
\DoxyCodeLine{00227         PayloadEncryption,}
\DoxyCodeLine{00231         DatagramEncryption = 10,}
\DoxyCodeLine{00235         DatagramEncryptionRandomSequence = 11,}
\DoxyCodeLine{00239         \textcolor{comment}{//DatagramEncryptionGCMRandomSequence = 12,}}
\DoxyCodeLine{00243 \textcolor{comment}{}        DatagramEncryptionGCM = 13,}
\DoxyCodeLine{00244     \}}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00247     \textcolor{keyword}{public} \textcolor{keyword}{struct }PhotonPortDefinition}
\DoxyCodeLine{00248     \{}
\DoxyCodeLine{00249         \textcolor{keyword}{public} \textcolor{keyword}{static} readonly PhotonPortDefinition AlternativeUdpPorts = \textcolor{keyword}{new} PhotonPortDefinition() \{ NameServerPort = 27000, MasterServerPort = 27001, GameServerPort = 27002\};}
\DoxyCodeLine{00250 }
\DoxyCodeLine{00252         \textcolor{keyword}{public} ushort NameServerPort;}
\DoxyCodeLine{00254         \textcolor{keyword}{public} ushort MasterServerPort;}
\DoxyCodeLine{00256         \textcolor{keyword}{public} ushort GameServerPort;}
\DoxyCodeLine{00257     \}}
\DoxyCodeLine{00258 }
\DoxyCodeLine{00259 }
\DoxyCodeLine{00260 \textcolor{preprocessor}{    \#endregion}}
\DoxyCodeLine{00261 }
\DoxyCodeLine{00262 }
\DoxyCodeLine{00278     \textcolor{keyword}{public} \textcolor{keyword}{class }LoadBalancingClient : IPhotonPeerListener}
\DoxyCodeLine{00279     \{}
\DoxyCodeLine{00284         \textcolor{keyword}{public} LoadBalancingPeer LoadBalancingPeer \{ \textcolor{keyword}{get}; \textcolor{keyword}{private} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00285 }
\DoxyCodeLine{00293         \textcolor{keyword}{public} SerializationProtocol SerializationProtocol}
\DoxyCodeLine{00294         \{}
\DoxyCodeLine{00295             \textcolor{keyword}{get}}
\DoxyCodeLine{00296             \{}
\DoxyCodeLine{00297                 \textcolor{keywordflow}{return} this.LoadBalancingPeer.SerializationProtocolType;}
\DoxyCodeLine{00298             \}}
\DoxyCodeLine{00299             \textcolor{keyword}{set}}
\DoxyCodeLine{00300             \{}
\DoxyCodeLine{00301                 this.LoadBalancingPeer.SerializationProtocolType = value;}
\DoxyCodeLine{00302             \}}
\DoxyCodeLine{00303         \}}
\DoxyCodeLine{00304 }
\DoxyCodeLine{00306         \textcolor{keyword}{public} \textcolor{keywordtype}{string} AppVersion \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00307 }
\DoxyCodeLine{00309         \textcolor{keyword}{public} \textcolor{keywordtype}{string} AppId \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00310 }
\DoxyCodeLine{00312         \textcolor{keyword}{public} ClientAppType ClientType \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00313 }
\DoxyCodeLine{00316         \textcolor{keyword}{public} AuthenticationValues AuthValues \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00317 }
\DoxyCodeLine{00319         \textcolor{keyword}{public} AuthModeOption AuthMode = AuthModeOption.Auth;}
\DoxyCodeLine{00320 }
\DoxyCodeLine{00322         \textcolor{keyword}{public} EncryptionMode EncryptionMode = EncryptionMode.PayloadEncryption;}
\DoxyCodeLine{00323 }
\DoxyCodeLine{00332         \textcolor{keyword}{public} ConnectionProtocol? ExpectedProtocol \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00333 }
\DoxyCodeLine{00334 }
\DoxyCodeLine{00336         \textcolor{keyword}{private} \textcolor{keywordtype}{object} TokenForInit}
\DoxyCodeLine{00337         \{}
\DoxyCodeLine{00338             \textcolor{keyword}{get}}
\DoxyCodeLine{00339             \{}
\DoxyCodeLine{00340                 \textcolor{keywordflow}{if} (this.AuthMode == AuthModeOption.Auth)}
\DoxyCodeLine{00341                 \{}
\DoxyCodeLine{00342                     \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00343                 \}}
\DoxyCodeLine{00344                 \textcolor{keywordflow}{return} (this.AuthValues != \textcolor{keyword}{null}) ? this.AuthValues.Token : \textcolor{keyword}{null};}
\DoxyCodeLine{00345             \}}
\DoxyCodeLine{00346         \}}
\DoxyCodeLine{00347 }
\DoxyCodeLine{00349         \textcolor{keyword}{private} \textcolor{keywordtype}{object} tokenCache;}
\DoxyCodeLine{00350 }
\DoxyCodeLine{00351 }
\DoxyCodeLine{00354         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} IsUsingNameServer \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00357         \textcolor{keyword}{public} \textcolor{keywordtype}{string} NameServerHost = \textcolor{stringliteral}{"{}ns.photonengine.io"{}};}
\DoxyCodeLine{00358 }
\DoxyCodeLine{00360         \textcolor{keyword}{public} \textcolor{keywordtype}{string} NameServerAddress \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} this.GetNameServerAddress(); \} \}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00363         \textcolor{keyword}{private} \textcolor{keyword}{static} readonly Dictionary<ConnectionProtocol, int> ProtocolToNameServerPort = \textcolor{keyword}{new} Dictionary<ConnectionProtocol, int>() \{ \{ ConnectionProtocol.Udp, 5058 \}, \{ ConnectionProtocol.Tcp, 4533 \}, \{ ConnectionProtocol.WebSocket, 9093 \}, \{ ConnectionProtocol.WebSocketSecure, 19093 \} \}; \textcolor{comment}{//, \{ ConnectionProtocol.RHttp, 6063 \} \};}}
\DoxyCodeLine{00364 }
\DoxyCodeLine{00365 }
\DoxyCodeLine{00367         [Obsolete(\textcolor{stringliteral}{"{}Set port overrides in ServerPortOverrides. Not used anymore!"{}})]}
\DoxyCodeLine{00368         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} UseAlternativeUdpPorts \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370 }
\DoxyCodeLine{00384         \textcolor{keyword}{public} PhotonPortDefinition ServerPortOverrides;}
\DoxyCodeLine{00385 }
\DoxyCodeLine{00386 }
\DoxyCodeLine{00396         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} EnableProtocolFallback \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00397 }
\DoxyCodeLine{00399         \textcolor{keyword}{public} \textcolor{keywordtype}{string} CurrentServerAddress \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} this.LoadBalancingPeer.ServerAddress; \} \}}
\DoxyCodeLine{00400 }
\DoxyCodeLine{00406         \textcolor{keyword}{public} \textcolor{keywordtype}{string} MasterServerAddress \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00407 }
\DoxyCodeLine{00409         \textcolor{keyword}{public} \textcolor{keywordtype}{string} GameServerAddress \{ \textcolor{keyword}{get}; \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00410 }
\DoxyCodeLine{00415         \textcolor{keyword}{public} ServerConnection Server \{ \textcolor{keyword}{get}; \textcolor{keyword}{private} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00416 }
\DoxyCodeLine{00431         \textcolor{keyword}{public} \textcolor{keywordtype}{string} ProxyServerAddress;}
\DoxyCodeLine{00432 }
\DoxyCodeLine{00434         \textcolor{keyword}{private} ClientState state = ClientState.PeerCreated;}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00437         \textcolor{keyword}{public} ClientState State}
\DoxyCodeLine{00438         \{}
\DoxyCodeLine{00439             \textcolor{keyword}{get}}
\DoxyCodeLine{00440             \{}
\DoxyCodeLine{00441                 \textcolor{keywordflow}{return} this.state;}
\DoxyCodeLine{00442             \}}
\DoxyCodeLine{00443 }
\DoxyCodeLine{00444             \textcolor{keyword}{set}}
\DoxyCodeLine{00445             \{}
\DoxyCodeLine{00446                 \textcolor{keywordflow}{if} (this.state == value)}
\DoxyCodeLine{00447                 \{}
\DoxyCodeLine{00448                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00449                 \}}
\DoxyCodeLine{00450                 ClientState previousState = this.state;}
\DoxyCodeLine{00451                 this.state = value;}
\DoxyCodeLine{00452                 \textcolor{keywordflow}{if} (StateChanged != \textcolor{keyword}{null}) StateChanged(previousState, this.state);}
\DoxyCodeLine{00453             \}}
\DoxyCodeLine{00454         \}}
\DoxyCodeLine{00455 }
\DoxyCodeLine{00458         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} IsConnected \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} this.LoadBalancingPeer != \textcolor{keyword}{null} \&\& this.State != ClientState.PeerCreated \&\& this.State != ClientState.Disconnected; \} \}}
\DoxyCodeLine{00459 }
\DoxyCodeLine{00460 }
\DoxyCodeLine{00473         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} IsConnectedAndReady}
\DoxyCodeLine{00474         \{}
\DoxyCodeLine{00475             \textcolor{keyword}{get}}
\DoxyCodeLine{00476             \{}
\DoxyCodeLine{00477                 \textcolor{keywordflow}{if} (this.LoadBalancingPeer == \textcolor{keyword}{null})}
\DoxyCodeLine{00478                 \{}
\DoxyCodeLine{00479                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00480                 \}}
\DoxyCodeLine{00481 }
\DoxyCodeLine{00482                 \textcolor{keywordflow}{switch} (this.State)}
\DoxyCodeLine{00483                 \{}
\DoxyCodeLine{00484                     \textcolor{keywordflow}{case} ClientState.PeerCreated:}
\DoxyCodeLine{00485                     \textcolor{keywordflow}{case} ClientState.Disconnected:}
\DoxyCodeLine{00486                     \textcolor{keywordflow}{case} ClientState.Disconnecting:}
\DoxyCodeLine{00487                     \textcolor{keywordflow}{case} ClientState.DisconnectingFromGameServer:}
\DoxyCodeLine{00488                     \textcolor{keywordflow}{case} ClientState.DisconnectingFromMasterServer:}
\DoxyCodeLine{00489                     \textcolor{keywordflow}{case} ClientState.DisconnectingFromNameServer:}
\DoxyCodeLine{00490                     \textcolor{keywordflow}{case} ClientState.Authenticating:}
\DoxyCodeLine{00491                     \textcolor{keywordflow}{case} ClientState.ConnectingToGameServer:}
\DoxyCodeLine{00492                     \textcolor{keywordflow}{case} ClientState.ConnectingToMasterServer:}
\DoxyCodeLine{00493                     \textcolor{keywordflow}{case} ClientState.ConnectingToNameServer:}
\DoxyCodeLine{00494                     \textcolor{keywordflow}{case} ClientState.Joining:}
\DoxyCodeLine{00495                     \textcolor{keywordflow}{case} ClientState.Leaving:}
\DoxyCodeLine{00496                         \textcolor{keywordflow}{return} \textcolor{keyword}{false};   \textcolor{comment}{// we are not ready to execute any operations}}
\DoxyCodeLine{00497                 \}}
\DoxyCodeLine{00498 }
\DoxyCodeLine{00499                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00500             \}}
\DoxyCodeLine{00501         \}}
\DoxyCodeLine{00502 }
\DoxyCodeLine{00503 }
\DoxyCodeLine{00506         \textcolor{keyword}{public} \textcolor{keyword}{event} Action<ClientState, ClientState> StateChanged;}
\DoxyCodeLine{00507 }
\DoxyCodeLine{00516         \textcolor{keyword}{public} \textcolor{keyword}{event} Action<EventData> EventReceived;}
\DoxyCodeLine{00517 }
\DoxyCodeLine{00526         \textcolor{keyword}{public} \textcolor{keyword}{event} Action<OperationResponse> OpResponseReceived;}
\DoxyCodeLine{00527 }
\DoxyCodeLine{00528 }
\DoxyCodeLine{00531         \textcolor{keyword}{public} ConnectionCallbacksContainer ConnectionCallbackTargets;}
\DoxyCodeLine{00532 }
\DoxyCodeLine{00535         \textcolor{keyword}{public} MatchMakingCallbacksContainer MatchMakingCallbackTargets;}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00539         \textcolor{keyword}{internal} InRoomCallbacksContainer InRoomCallbackTargets;}
\DoxyCodeLine{00540 }
\DoxyCodeLine{00543         \textcolor{keyword}{internal} LobbyCallbacksContainer LobbyCallbackTargets;}
\DoxyCodeLine{00544 }
\DoxyCodeLine{00547         \textcolor{keyword}{internal} WebRpcCallbacksContainer WebRpcCallbackTargets;}
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549 }
\DoxyCodeLine{00552         \textcolor{keyword}{internal} ErrorInfoCallbacksContainer ErrorInfoCallbackTargets;}
\DoxyCodeLine{00553 }
\DoxyCodeLine{00562         \textcolor{keyword}{public} DisconnectCause DisconnectedCause \{ \textcolor{keyword}{get}; \textcolor{keyword}{protected} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564 }
\DoxyCodeLine{00567         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} InLobby}
\DoxyCodeLine{00568         \{}
\DoxyCodeLine{00569             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} this.State == ClientState.JoinedLobby; \}}
\DoxyCodeLine{00570         \}}
\DoxyCodeLine{00571 }
\DoxyCodeLine{00573         \textcolor{keyword}{public} TypedLobby CurrentLobby \{ \textcolor{keyword}{get}; \textcolor{keyword}{internal} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00574 }
\DoxyCodeLine{00591         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} EnableLobbyStatistics;}
\DoxyCodeLine{00592 }
\DoxyCodeLine{00594         \textcolor{keyword}{private} readonly List<TypedLobbyInfo> lobbyStatistics = \textcolor{keyword}{new} List<TypedLobbyInfo>();}
\DoxyCodeLine{00595 }
\DoxyCodeLine{00596 }
\DoxyCodeLine{00598         \textcolor{keyword}{public} Player LocalPlayer \{ \textcolor{keyword}{get}; \textcolor{keyword}{internal} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00599 }
\DoxyCodeLine{00603         \textcolor{keyword}{public} \textcolor{keywordtype}{string} NickName}
\DoxyCodeLine{00604         \{}
\DoxyCodeLine{00605             \textcolor{keyword}{get}}
\DoxyCodeLine{00606             \{}
\DoxyCodeLine{00607                 \textcolor{keywordflow}{return} this.LocalPlayer.NickName;}
\DoxyCodeLine{00608             \}}
\DoxyCodeLine{00609 }
\DoxyCodeLine{00610             \textcolor{keyword}{set}}
\DoxyCodeLine{00611             \{}
\DoxyCodeLine{00612                 \textcolor{keywordflow}{if} (this.LocalPlayer == \textcolor{keyword}{null})}
\DoxyCodeLine{00613                 \{}
\DoxyCodeLine{00614                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00615                 \}}
\DoxyCodeLine{00616 }
\DoxyCodeLine{00617                 this.LocalPlayer.NickName = value;}
\DoxyCodeLine{00618             \}}
\DoxyCodeLine{00619         \}}
\DoxyCodeLine{00620 }
\DoxyCodeLine{00621 }
\DoxyCodeLine{00632         \textcolor{keyword}{public} \textcolor{keywordtype}{string} UserId}
\DoxyCodeLine{00633         \{}
\DoxyCodeLine{00634             \textcolor{keyword}{get}}
\DoxyCodeLine{00635             \{}
\DoxyCodeLine{00636                 \textcolor{keywordflow}{if} (this.AuthValues != \textcolor{keyword}{null})}
\DoxyCodeLine{00637                 \{}
\DoxyCodeLine{00638                     \textcolor{keywordflow}{return} this.AuthValues.UserId;}
\DoxyCodeLine{00639                 \}}
\DoxyCodeLine{00640                 \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00641             \}}
\DoxyCodeLine{00642             \textcolor{keyword}{set}}
\DoxyCodeLine{00643             \{}
\DoxyCodeLine{00644                 \textcolor{keywordflow}{if} (this.AuthValues == \textcolor{keyword}{null})}
\DoxyCodeLine{00645                 \{}
\DoxyCodeLine{00646                     this.AuthValues = \textcolor{keyword}{new} AuthenticationValues();}
\DoxyCodeLine{00647                 \}}
\DoxyCodeLine{00648                 this.AuthValues.UserId = value;}
\DoxyCodeLine{00649             \}}
\DoxyCodeLine{00650         \}}
\DoxyCodeLine{00651 }
\DoxyCodeLine{00653         \textcolor{keyword}{public} Room CurrentRoom \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00654 }
\DoxyCodeLine{00655 }
\DoxyCodeLine{00662         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} InRoom}
\DoxyCodeLine{00663         \{}
\DoxyCodeLine{00664             \textcolor{keyword}{get}}
\DoxyCodeLine{00665             \{}
\DoxyCodeLine{00666                 \textcolor{keywordflow}{return} this.state == ClientState.Joined \&\& this.CurrentRoom != \textcolor{keyword}{null};}
\DoxyCodeLine{00667             \}}
\DoxyCodeLine{00668         \}}
\DoxyCodeLine{00669 }
\DoxyCodeLine{00671         \textcolor{keyword}{public} \textcolor{keywordtype}{int} PlayersOnMasterCount \{ \textcolor{keyword}{get}; \textcolor{keyword}{internal} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00672 }
\DoxyCodeLine{00674         \textcolor{keyword}{public} \textcolor{keywordtype}{int} PlayersInRoomsCount \{ \textcolor{keyword}{get}; \textcolor{keyword}{internal} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00677         \textcolor{keyword}{public} \textcolor{keywordtype}{int} RoomsCount \{ \textcolor{keyword}{get}; \textcolor{keyword}{internal} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00678 }
\DoxyCodeLine{00679 }
\DoxyCodeLine{00681         \textcolor{keyword}{private} JoinType lastJoinType;}
\DoxyCodeLine{00682 }
\DoxyCodeLine{00684         \textcolor{keyword}{private} EnterRoomParams enterRoomParamsCache;}
\DoxyCodeLine{00685 }
\DoxyCodeLine{00687         \textcolor{keyword}{private} OperationResponse failedRoomEntryOperation;}
\DoxyCodeLine{00688 }
\DoxyCodeLine{00689 }
\DoxyCodeLine{00691         \textcolor{keyword}{private} \textcolor{keyword}{const} \textcolor{keywordtype}{int} FriendRequestListMax = 512;}
\DoxyCodeLine{00692 }
\DoxyCodeLine{00694         \textcolor{keyword}{private} \textcolor{keywordtype}{string}[] friendListRequested;}
\DoxyCodeLine{00695 }
\DoxyCodeLine{00697         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} IsFetchingFriendList \{ \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} this.friendListRequested != \textcolor{keyword}{null}; \} \}}
\DoxyCodeLine{00698 }
\DoxyCodeLine{00699 }
\DoxyCodeLine{00701         \textcolor{keyword}{public} \textcolor{keywordtype}{string} CloudRegion \{ \textcolor{keyword}{get}; \textcolor{keyword}{private} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00702 }
\DoxyCodeLine{00708         \textcolor{keyword}{public} \textcolor{keywordtype}{string} CurrentCluster \{ \textcolor{keyword}{get}; \textcolor{keyword}{private} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00709 }
\DoxyCodeLine{00711         \textcolor{keyword}{public} RegionHandler RegionHandler;}
\DoxyCodeLine{00712 }
\DoxyCodeLine{00714         \textcolor{keyword}{private} \textcolor{keywordtype}{string} bestRegionSummaryFromStorage;}
\DoxyCodeLine{00715 }
\DoxyCodeLine{00717         \textcolor{keyword}{public} \textcolor{keywordtype}{string} SummaryToCache;}
\DoxyCodeLine{00718 }
\DoxyCodeLine{00725         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} connectToBestRegion = \textcolor{keyword}{true};}
\DoxyCodeLine{00726 }
\DoxyCodeLine{00727 }
\DoxyCodeLine{00729         \textcolor{keyword}{private} \textcolor{keyword}{class }EncryptionDataParameters}
\DoxyCodeLine{00730         \{}
\DoxyCodeLine{00734             \textcolor{keyword}{public} \textcolor{keyword}{const} \textcolor{keywordtype}{byte} Mode = 0;}
\DoxyCodeLine{00738             \textcolor{keyword}{public} \textcolor{keyword}{const} \textcolor{keywordtype}{byte} Secret1 = 1;}
\DoxyCodeLine{00742             \textcolor{keyword}{public} \textcolor{keyword}{const} \textcolor{keywordtype}{byte} Secret2 = 2;}
\DoxyCodeLine{00743         \}}
\DoxyCodeLine{00744 }
\DoxyCodeLine{00745 }
\DoxyCodeLine{00746         \textcolor{keyword}{private} \textcolor{keyword}{class }CallbackTargetChange}
\DoxyCodeLine{00747         \{}
\DoxyCodeLine{00748             \textcolor{keyword}{public} readonly \textcolor{keywordtype}{object} Target;}
\DoxyCodeLine{00750             \textcolor{keyword}{public} readonly \textcolor{keywordtype}{bool} AddTarget;}
\DoxyCodeLine{00751 }
\DoxyCodeLine{00752             \textcolor{keyword}{public} CallbackTargetChange(\textcolor{keywordtype}{object} target, \textcolor{keywordtype}{bool} addTarget)}
\DoxyCodeLine{00753             \{}
\DoxyCodeLine{00754                 this.Target = target;}
\DoxyCodeLine{00755                 this.AddTarget = addTarget;}
\DoxyCodeLine{00756             \}}
\DoxyCodeLine{00757         \}}
\DoxyCodeLine{00758 }
\DoxyCodeLine{00759         \textcolor{keyword}{private} readonly Queue<CallbackTargetChange> callbackTargetChanges = \textcolor{keyword}{new} Queue<CallbackTargetChange>();}
\DoxyCodeLine{00760         \textcolor{keyword}{private} readonly HashSet<object> callbackTargets = \textcolor{keyword}{new} HashSet<object>();}
\DoxyCodeLine{00761 }
\DoxyCodeLine{00762 }
\DoxyCodeLine{00765         \textcolor{keyword}{public} LoadBalancingClient(ConnectionProtocol protocol = ConnectionProtocol.Udp)}
\DoxyCodeLine{00766         \{}
\DoxyCodeLine{00767             this.ConnectionCallbackTargets = \textcolor{keyword}{new} ConnectionCallbacksContainer(\textcolor{keyword}{this});}
\DoxyCodeLine{00768             this.MatchMakingCallbackTargets = \textcolor{keyword}{new} MatchMakingCallbacksContainer(\textcolor{keyword}{this});}
\DoxyCodeLine{00769             this.InRoomCallbackTargets = \textcolor{keyword}{new} InRoomCallbacksContainer(\textcolor{keyword}{this});}
\DoxyCodeLine{00770             this.LobbyCallbackTargets = \textcolor{keyword}{new} LobbyCallbacksContainer(\textcolor{keyword}{this});}
\DoxyCodeLine{00771             this.WebRpcCallbackTargets = \textcolor{keyword}{new} WebRpcCallbacksContainer(\textcolor{keyword}{this});}
\DoxyCodeLine{00772             this.ErrorInfoCallbackTargets = \textcolor{keyword}{new} ErrorInfoCallbacksContainer(\textcolor{keyword}{this});}
\DoxyCodeLine{00773 }
\DoxyCodeLine{00774             this.LoadBalancingPeer = \textcolor{keyword}{new} LoadBalancingPeer(\textcolor{keyword}{this}, protocol);}
\DoxyCodeLine{00775             this.LoadBalancingPeer.OnDisconnectMessage += this.OnDisconnectMessageReceived;}
\DoxyCodeLine{00776             this.SerializationProtocol = SerializationProtocol.GpBinaryV18;}
\DoxyCodeLine{00777             this.LocalPlayer = this.CreatePlayer(\textcolor{keywordtype}{string}.Empty, -\/1, \textcolor{keyword}{true}, \textcolor{keyword}{null}); \textcolor{comment}{//TODO: Check if we can do this later}}
\DoxyCodeLine{00778 }
\DoxyCodeLine{00779 }
\DoxyCodeLine{00780 \textcolor{preprocessor}{            \#if SUPPORTED\_UNITY}}
\DoxyCodeLine{00781             CustomTypesUnity.Register();}
\DoxyCodeLine{00782 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00783 }
\DoxyCodeLine{00784 \textcolor{preprocessor}{            \#if UNITY\_WEBGL}}
\DoxyCodeLine{00785             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.TransportProtocol == ConnectionProtocol.Tcp || \textcolor{keyword}{this}.LoadBalancingPeer.TransportProtocol == ConnectionProtocol.Udp)}
\DoxyCodeLine{00786             \{}
\DoxyCodeLine{00787                 this.LoadBalancingPeer.Listener.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}WebGL requires WebSockets. Switching TransportProtocol to WebSocketSecure."{}});}
\DoxyCodeLine{00788                 this.LoadBalancingPeer.TransportProtocol = ConnectionProtocol.WebSocketSecure;}
\DoxyCodeLine{00789             \}}
\DoxyCodeLine{00790 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00791 }
\DoxyCodeLine{00792             this.State = ClientState.PeerCreated;}
\DoxyCodeLine{00793         \}}
\DoxyCodeLine{00794 }
\DoxyCodeLine{00795 }
\DoxyCodeLine{00801         \textcolor{keyword}{public} LoadBalancingClient(\textcolor{keywordtype}{string} masterAddress, \textcolor{keywordtype}{string} appId, \textcolor{keywordtype}{string} gameVersion, ConnectionProtocol protocol = ConnectionProtocol.Udp) : this(protocol)}
\DoxyCodeLine{00802         \{}
\DoxyCodeLine{00803             this.MasterServerAddress = masterAddress;}
\DoxyCodeLine{00804             this.AppId = appId;}
\DoxyCodeLine{00805             this.AppVersion = gameVersion;}
\DoxyCodeLine{00806         \}}
\DoxyCodeLine{00807 }
\DoxyCodeLine{00808         \textcolor{keyword}{public} \textcolor{keywordtype}{int} NameServerPortInAppSettings;}
\DoxyCodeLine{00809 }
\DoxyCodeLine{00814         \textcolor{keyword}{private} \textcolor{keywordtype}{string} GetNameServerAddress()}
\DoxyCodeLine{00815         \{}
\DoxyCodeLine{00816             var protocolPort = 0;}
\DoxyCodeLine{00817             ProtocolToNameServerPort.TryGetValue(this.LoadBalancingPeer.TransportProtocol, out protocolPort);}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819             \textcolor{keywordflow}{if} (this.NameServerPortInAppSettings != 0)}
\DoxyCodeLine{00820             \{}
\DoxyCodeLine{00821                 this.DebugReturn(DebugLevel.INFO, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Using NameServerPortInAppSettings: \{0\}"{}}, \textcolor{keyword}{this}.NameServerPortInAppSettings));}
\DoxyCodeLine{00822                 protocolPort = this.NameServerPortInAppSettings;}
\DoxyCodeLine{00823             \}}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825             \textcolor{keywordflow}{if} (this.ServerPortOverrides.NameServerPort > 0)}
\DoxyCodeLine{00826             \{}
\DoxyCodeLine{00827                 protocolPort = this.ServerPortOverrides.NameServerPort;}
\DoxyCodeLine{00828             \}}
\DoxyCodeLine{00829 }
\DoxyCodeLine{00830             \textcolor{keywordflow}{switch} (this.LoadBalancingPeer.TransportProtocol)}
\DoxyCodeLine{00831             \{}
\DoxyCodeLine{00832                 \textcolor{keywordflow}{case} ConnectionProtocol.Udp:}
\DoxyCodeLine{00833                 \textcolor{keywordflow}{case} ConnectionProtocol.Tcp:}
\DoxyCodeLine{00834                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}\{0\}:\{1\}"{}}, NameServerHost, protocolPort);}
\DoxyCodeLine{00835                 \textcolor{keywordflow}{case} ConnectionProtocol.WebSocket:}
\DoxyCodeLine{00836                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}ws://\{0\}:\{1\}"{}}, NameServerHost, protocolPort);}
\DoxyCodeLine{00837                 \textcolor{keywordflow}{case} ConnectionProtocol.WebSocketSecure:}
\DoxyCodeLine{00838                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}wss://\{0\}:\{1\}"{}}, NameServerHost, protocolPort);}
\DoxyCodeLine{00839                 \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00840                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException();}
\DoxyCodeLine{00841             \}}
\DoxyCodeLine{00842         \}}
\DoxyCodeLine{00843 }
\DoxyCodeLine{00844 }
\DoxyCodeLine{00845 \textcolor{preprocessor}{        \#region Operations and Commands}}
\DoxyCodeLine{00846 }
\DoxyCodeLine{00847 }
\DoxyCodeLine{00848         \textcolor{comment}{// needed connect variants:}}
\DoxyCodeLine{00849         \textcolor{comment}{// connect to Name Server only (could include getregions) -\/> end after getregions}}
\DoxyCodeLine{00850         \textcolor{comment}{// connect to Region Master via Name Server (specific region/cluster) -\/> no getregions! authenticates and ends after on connected to master}}
\DoxyCodeLine{00851         \textcolor{comment}{// connect to Best Region via Name Server}}
\DoxyCodeLine{00852         \textcolor{comment}{// connect to Master Server (no Name Server, no appid)}}
\DoxyCodeLine{00853 }
\DoxyCodeLine{00854         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} ConnectUsingSettings(AppSettings appSettings)}
\DoxyCodeLine{00855         \{}
\DoxyCodeLine{00856             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.PeerState != PeerStateValue.Disconnected)}
\DoxyCodeLine{00857             \{}
\DoxyCodeLine{00858                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ConnectUsingSettings() failed. Can only connect while in state 'Disconnected'. Current state: "{}} + \textcolor{keyword}{this}.LoadBalancingPeer.PeerState);}
\DoxyCodeLine{00859                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00860             \}}
\DoxyCodeLine{00861 }
\DoxyCodeLine{00862             \textcolor{keywordflow}{if} (appSettings == \textcolor{keyword}{null})}
\DoxyCodeLine{00863             \{}
\DoxyCodeLine{00864                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}ConnectUsingSettings failed. The appSettings can't be null.'"{}});}
\DoxyCodeLine{00865                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00866             \}}
\DoxyCodeLine{00867 }
\DoxyCodeLine{00868             \textcolor{keywordflow}{switch} (this.ClientType)}
\DoxyCodeLine{00869             \{}
\DoxyCodeLine{00870                 \textcolor{keywordflow}{case} ClientAppType.Realtime:}
\DoxyCodeLine{00871                     this.AppId = appSettings.AppIdRealtime;}
\DoxyCodeLine{00872                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00873                 \textcolor{keywordflow}{case} ClientAppType.Voice:}
\DoxyCodeLine{00874                     this.AppId = appSettings.AppIdVoice;}
\DoxyCodeLine{00875                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00876                 \textcolor{keywordflow}{case} ClientAppType.Fusion:}
\DoxyCodeLine{00877                     this.AppId = appSettings.AppIdFusion;}
\DoxyCodeLine{00878                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00879             \}}
\DoxyCodeLine{00880 }
\DoxyCodeLine{00881             this.AppVersion = appSettings.AppVersion;}
\DoxyCodeLine{00882 }
\DoxyCodeLine{00883             this.IsUsingNameServer = appSettings.UseNameServer;}
\DoxyCodeLine{00884             this.CloudRegion = appSettings.FixedRegion;}
\DoxyCodeLine{00885             this.connectToBestRegion = \textcolor{keywordtype}{string}.IsNullOrEmpty(this.CloudRegion);}
\DoxyCodeLine{00886 }
\DoxyCodeLine{00887             this.EnableLobbyStatistics = appSettings.EnableLobbyStatistics;}
\DoxyCodeLine{00888             this.LoadBalancingPeer.DebugOut = appSettings.NetworkLogging;}
\DoxyCodeLine{00889 }
\DoxyCodeLine{00890             this.AuthMode = appSettings.AuthMode;}
\DoxyCodeLine{00891             \textcolor{keywordflow}{if} (appSettings.AuthMode == AuthModeOption.AuthOnceWss)}
\DoxyCodeLine{00892             \{}
\DoxyCodeLine{00893                 this.LoadBalancingPeer.TransportProtocol = ConnectionProtocol.WebSocketSecure;}
\DoxyCodeLine{00894                 this.ExpectedProtocol = appSettings.Protocol;}
\DoxyCodeLine{00895             \}}
\DoxyCodeLine{00896             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00897             \{}
\DoxyCodeLine{00898                 this.LoadBalancingPeer.TransportProtocol = appSettings.Protocol;}
\DoxyCodeLine{00899                 this.ExpectedProtocol = \textcolor{keyword}{null};}
\DoxyCodeLine{00900             \}}
\DoxyCodeLine{00901             }
\DoxyCodeLine{00902             this.EnableProtocolFallback = appSettings.EnableProtocolFallback;}
\DoxyCodeLine{00903 }
\DoxyCodeLine{00904             this.bestRegionSummaryFromStorage = appSettings.BestRegionSummaryFromStorage;}
\DoxyCodeLine{00905             this.DisconnectedCause = DisconnectCause.None;}
\DoxyCodeLine{00906 }
\DoxyCodeLine{00907 }
\DoxyCodeLine{00908             this.CheckConnectSetupWebGl();}
\DoxyCodeLine{00909 }
\DoxyCodeLine{00910 }
\DoxyCodeLine{00911             \textcolor{keywordflow}{if} (this.IsUsingNameServer)}
\DoxyCodeLine{00912             \{}
\DoxyCodeLine{00913                 this.Server = ServerConnection.NameServer;}
\DoxyCodeLine{00914                 \textcolor{keywordflow}{if} (!appSettings.IsDefaultNameServer)}
\DoxyCodeLine{00915                 \{}
\DoxyCodeLine{00916                     this.NameServerHost = appSettings.Server;}
\DoxyCodeLine{00917                 \}}
\DoxyCodeLine{00918 }
\DoxyCodeLine{00919                 this.ProxyServerAddress = appSettings.ProxyServer;}
\DoxyCodeLine{00920                 this.NameServerPortInAppSettings = appSettings.Port;}
\DoxyCodeLine{00921                 \textcolor{keywordflow}{if} (!this.LoadBalancingPeer.Connect(\textcolor{keyword}{this}.NameServerAddress, \textcolor{keyword}{this}.ProxyServerAddress, \textcolor{keyword}{this}.AppId, \textcolor{keyword}{this}.TokenForInit))}
\DoxyCodeLine{00922                 \{}
\DoxyCodeLine{00923                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00924                 \}}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926                 this.State = ClientState.ConnectingToNameServer;}
\DoxyCodeLine{00927             \}}
\DoxyCodeLine{00928             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00929             \{}
\DoxyCodeLine{00930                 this.Server = ServerConnection.MasterServer;}
\DoxyCodeLine{00931                 \textcolor{keywordtype}{int} portToUse = appSettings.IsDefaultPort ? 5055 : appSettings.Port;    \textcolor{comment}{// TODO: setup new (default) port config}}
\DoxyCodeLine{00932                 this.MasterServerAddress = \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}\{0\}:\{1\}"{}}, appSettings.Server, portToUse);}
\DoxyCodeLine{00933 }
\DoxyCodeLine{00934                 \textcolor{keywordflow}{if} (!this.LoadBalancingPeer.Connect(\textcolor{keyword}{this}.MasterServerAddress, \textcolor{keyword}{this}.ProxyServerAddress, \textcolor{keyword}{this}.AppId, \textcolor{keyword}{this}.TokenForInit))}
\DoxyCodeLine{00935                 \{}
\DoxyCodeLine{00936                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00937                 \}}
\DoxyCodeLine{00938 }
\DoxyCodeLine{00939                 this.State = ClientState.ConnectingToMasterServer;}
\DoxyCodeLine{00940             \}}
\DoxyCodeLine{00941 }
\DoxyCodeLine{00942             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00943         \}}
\DoxyCodeLine{00944 }
\DoxyCodeLine{00945 }
\DoxyCodeLine{00946         [Obsolete(\textcolor{stringliteral}{"{}Use ConnectToMasterServer() instead."{}})]}
\DoxyCodeLine{00947         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} Connect()}
\DoxyCodeLine{00948         \{}
\DoxyCodeLine{00949             \textcolor{keywordflow}{return} this.ConnectToMasterServer();}
\DoxyCodeLine{00950         \}}
\DoxyCodeLine{00951 }
\DoxyCodeLine{00971         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} ConnectToMasterServer()}
\DoxyCodeLine{00972         \{}
\DoxyCodeLine{00973             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.PeerState != PeerStateValue.Disconnected)}
\DoxyCodeLine{00974             \{}
\DoxyCodeLine{00975                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ConnectToMasterServer() failed. Can only connect while in state 'Disconnected'. Current state: "{}} + \textcolor{keyword}{this}.LoadBalancingPeer.PeerState);}
\DoxyCodeLine{00976                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00977             \}}
\DoxyCodeLine{00978 }
\DoxyCodeLine{00979             \textcolor{comment}{// when using authMode AuthOnce or AuthOnceWSS, the token must be available for the init request. if it's null in that case, don't connect}}
\DoxyCodeLine{00980             \textcolor{keywordflow}{if} (this.AuthMode != AuthModeOption.Auth \&\& \textcolor{keyword}{this}.TokenForInit == \textcolor{keyword}{null})}
\DoxyCodeLine{00981             \{}
\DoxyCodeLine{00982                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}Connect() failed. Can't connect to MasterServer with Token == null in AuthMode: "{}} + \textcolor{keyword}{this}.AuthMode);}
\DoxyCodeLine{00983                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00984             \}}
\DoxyCodeLine{00985 }
\DoxyCodeLine{00986             this.CheckConnectSetupWebGl();}
\DoxyCodeLine{00987 }
\DoxyCodeLine{00988             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.Connect(\textcolor{keyword}{this}.MasterServerAddress, \textcolor{keyword}{this}.ProxyServerAddress, \textcolor{keyword}{this}.AppId, \textcolor{keyword}{this}.TokenForInit))}
\DoxyCodeLine{00989             \{}
\DoxyCodeLine{00990                 this.DisconnectedCause = DisconnectCause.None;}
\DoxyCodeLine{00991                 this.connectToBestRegion = \textcolor{keyword}{false};}
\DoxyCodeLine{00992                 this.State = ClientState.ConnectingToMasterServer;}
\DoxyCodeLine{00993                 this.Server = ServerConnection.MasterServer;}
\DoxyCodeLine{00994                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00995             \}}
\DoxyCodeLine{00996 }
\DoxyCodeLine{00997             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00998         \}}
\DoxyCodeLine{00999 }
\DoxyCodeLine{01000 }
\DoxyCodeLine{01006         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} ConnectToNameServer()}
\DoxyCodeLine{01007         \{}
\DoxyCodeLine{01008             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.PeerState != PeerStateValue.Disconnected)}
\DoxyCodeLine{01009             \{}
\DoxyCodeLine{01010                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ConnectToNameServer() failed. Can only connect while in state 'Disconnected'. Current state: "{}} + \textcolor{keyword}{this}.LoadBalancingPeer.PeerState);}
\DoxyCodeLine{01011                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01012             \}}
\DoxyCodeLine{01013 }
\DoxyCodeLine{01014             this.IsUsingNameServer = \textcolor{keyword}{true};}
\DoxyCodeLine{01015             this.CloudRegion = \textcolor{keyword}{null};}
\DoxyCodeLine{01016 }
\DoxyCodeLine{01017 }
\DoxyCodeLine{01018             this.CheckConnectSetupWebGl();}
\DoxyCodeLine{01019 }
\DoxyCodeLine{01020 }
\DoxyCodeLine{01021             \textcolor{keywordflow}{if} (this.AuthMode == AuthModeOption.AuthOnceWss)}
\DoxyCodeLine{01022             \{}
\DoxyCodeLine{01023                 \textcolor{keywordflow}{if} (this.ExpectedProtocol == \textcolor{keyword}{null})}
\DoxyCodeLine{01024                 \{}
\DoxyCodeLine{01025                     this.ExpectedProtocol = this.LoadBalancingPeer.TransportProtocol;}
\DoxyCodeLine{01026                 \}}
\DoxyCodeLine{01027                 this.LoadBalancingPeer.TransportProtocol = ConnectionProtocol.WebSocketSecure;}
\DoxyCodeLine{01028             \}}
\DoxyCodeLine{01029 }
\DoxyCodeLine{01030             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.Connect(\textcolor{keyword}{this}.NameServerAddress, \textcolor{keyword}{this}.ProxyServerAddress, \textcolor{stringliteral}{"{}NameServer"{}}, \textcolor{keyword}{this}.TokenForInit))}
\DoxyCodeLine{01031             \{}
\DoxyCodeLine{01032                 this.DisconnectedCause = DisconnectCause.None;}
\DoxyCodeLine{01033                 this.connectToBestRegion = \textcolor{keyword}{false};}
\DoxyCodeLine{01034                 this.State = ClientState.ConnectingToNameServer;}
\DoxyCodeLine{01035                 this.Server = ServerConnection.NameServer;}
\DoxyCodeLine{01036                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01037             \}}
\DoxyCodeLine{01038 }
\DoxyCodeLine{01039             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01040         \}}
\DoxyCodeLine{01041 }
\DoxyCodeLine{01054         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} ConnectToRegionMaster(\textcolor{keywordtype}{string} region)}
\DoxyCodeLine{01055         \{}
\DoxyCodeLine{01056             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(region))}
\DoxyCodeLine{01057             \{}
\DoxyCodeLine{01058                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}ConnectToRegionMaster() failed. The region can not be null or empty."{}});}
\DoxyCodeLine{01059                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01060             \}}
\DoxyCodeLine{01061 }
\DoxyCodeLine{01062             this.IsUsingNameServer = \textcolor{keyword}{true};}
\DoxyCodeLine{01063 }
\DoxyCodeLine{01064             \textcolor{keywordflow}{if} (this.State == ClientState.Authenticating)}
\DoxyCodeLine{01065             \{}
\DoxyCodeLine{01066                 \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= DebugLevel.INFO)}
\DoxyCodeLine{01067                 \{}
\DoxyCodeLine{01068                     this.DebugReturn(DebugLevel.INFO, \textcolor{stringliteral}{"{}ConnectToRegionMaster() will skip calling authenticate, as the current state is 'Authenticating'. Just wait for the result."{}});}
\DoxyCodeLine{01069                 \}}
\DoxyCodeLine{01070                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01071             \}}
\DoxyCodeLine{01072 }
\DoxyCodeLine{01073             \textcolor{keywordflow}{if} (this.State == ClientState.ConnectedToNameServer)}
\DoxyCodeLine{01074             \{}
\DoxyCodeLine{01075                 this.CloudRegion = region;}
\DoxyCodeLine{01076 }
\DoxyCodeLine{01077                 \textcolor{keywordtype}{bool} authenticating = this.CallAuthenticate();}
\DoxyCodeLine{01078                 \textcolor{keywordflow}{if} (authenticating)}
\DoxyCodeLine{01079                 \{}
\DoxyCodeLine{01080                     this.State = ClientState.Authenticating;}
\DoxyCodeLine{01081                 \}}
\DoxyCodeLine{01082 }
\DoxyCodeLine{01083                 \textcolor{keywordflow}{return} authenticating;}
\DoxyCodeLine{01084             \}}
\DoxyCodeLine{01085 }
\DoxyCodeLine{01086 }
\DoxyCodeLine{01087             this.LoadBalancingPeer.Disconnect();}
\DoxyCodeLine{01088 }
\DoxyCodeLine{01089             \textcolor{keywordflow}{if} (!\textcolor{keywordtype}{string}.IsNullOrEmpty(region) \&\& !region.Contains(\textcolor{stringliteral}{"{}/"{}}))}
\DoxyCodeLine{01090             \{}
\DoxyCodeLine{01091                 region = region + \textcolor{stringliteral}{"{}/*"{}};}
\DoxyCodeLine{01092             \}}
\DoxyCodeLine{01093             this.CloudRegion = region;}
\DoxyCodeLine{01094 }
\DoxyCodeLine{01095 }
\DoxyCodeLine{01096             this.CheckConnectSetupWebGl();}
\DoxyCodeLine{01097 }
\DoxyCodeLine{01098 }
\DoxyCodeLine{01099             \textcolor{keywordflow}{if} (this.AuthMode == AuthModeOption.AuthOnceWss)}
\DoxyCodeLine{01100             \{}
\DoxyCodeLine{01101                 \textcolor{keywordflow}{if} (this.ExpectedProtocol == \textcolor{keyword}{null})}
\DoxyCodeLine{01102                 \{}
\DoxyCodeLine{01103                     this.ExpectedProtocol = this.LoadBalancingPeer.TransportProtocol;}
\DoxyCodeLine{01104                 \}}
\DoxyCodeLine{01105                 this.LoadBalancingPeer.TransportProtocol = ConnectionProtocol.WebSocketSecure;}
\DoxyCodeLine{01106             \}}
\DoxyCodeLine{01107 }
\DoxyCodeLine{01108             this.connectToBestRegion = \textcolor{keyword}{false};}
\DoxyCodeLine{01109             this.DisconnectedCause = DisconnectCause.None;}
\DoxyCodeLine{01110             \textcolor{keywordflow}{if} (!this.LoadBalancingPeer.Connect(\textcolor{keyword}{this}.NameServerAddress, \textcolor{keyword}{this}.ProxyServerAddress, \textcolor{stringliteral}{"{}NameServer"{}}, \textcolor{keyword}{null}))}
\DoxyCodeLine{01111             \{}
\DoxyCodeLine{01112                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01113             \}}
\DoxyCodeLine{01114 }
\DoxyCodeLine{01115             this.State = ClientState.ConnectingToNameServer;}
\DoxyCodeLine{01116             this.Server = ServerConnection.NameServer;}
\DoxyCodeLine{01117             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01118         \}}
\DoxyCodeLine{01119 }
\DoxyCodeLine{01120         [Conditional(\textcolor{stringliteral}{"{}UNITY\_WEBGL"{}})]}
\DoxyCodeLine{01121         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CheckConnectSetupWebGl()}
\DoxyCodeLine{01122         \{}
\DoxyCodeLine{01123 \textcolor{preprocessor}{            \#if UNITY\_WEBGL}}
\DoxyCodeLine{01124             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.TransportProtocol != ConnectionProtocol.WebSocket \&\& \textcolor{keyword}{this}.LoadBalancingPeer.TransportProtocol != ConnectionProtocol.WebSocketSecure)}
\DoxyCodeLine{01125             \{}
\DoxyCodeLine{01126                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}WebGL requires WebSockets. Switching TransportProtocol to WebSocketSecure."{}});}
\DoxyCodeLine{01127                 this.LoadBalancingPeer.TransportProtocol = ConnectionProtocol.WebSocketSecure;}
\DoxyCodeLine{01128             \}}
\DoxyCodeLine{01129 }
\DoxyCodeLine{01130             this.EnableProtocolFallback = \textcolor{keyword}{false}; \textcolor{comment}{// no fallback on WebGL}}
\DoxyCodeLine{01131 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{01132         \}}
\DoxyCodeLine{01133 }
\DoxyCodeLine{01137         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} Connect(\textcolor{keywordtype}{string} serverAddress, \textcolor{keywordtype}{string} proxyServerAddress, ServerConnection serverType)}
\DoxyCodeLine{01138         \{}
\DoxyCodeLine{01139             \textcolor{comment}{// TODO: Make sure app doesn't quit right now}}
\DoxyCodeLine{01140 }
\DoxyCodeLine{01141             \textcolor{keywordflow}{if} (this.State == ClientState.Disconnecting)}
\DoxyCodeLine{01142             \{}
\DoxyCodeLine{01143                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}Connect() failed. Can't connect while disconnecting (still). Current state: "{}} + \textcolor{keyword}{this}.State);}
\DoxyCodeLine{01144                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01145             \}}
\DoxyCodeLine{01146 }
\DoxyCodeLine{01147             \textcolor{comment}{// when using authMode AuthOnce or AuthOnceWSS, the token must be available for the init request. if it's null in that case, don't connect}}
\DoxyCodeLine{01148             \textcolor{keywordflow}{if} (this.AuthMode != AuthModeOption.Auth \&\& serverType != ServerConnection.NameServer \&\& \textcolor{keyword}{this}.TokenForInit == \textcolor{keyword}{null})}
\DoxyCodeLine{01149             \{}
\DoxyCodeLine{01150                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}Connect() failed. Can't connect to "{}} + serverType + \textcolor{stringliteral}{"{} with Token == null in AuthMode: "{}} + \textcolor{keyword}{this}.AuthMode);}
\DoxyCodeLine{01151                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01152             \}}
\DoxyCodeLine{01153 }
\DoxyCodeLine{01154             \textcolor{comment}{// connect might fail, if the DNS name can't be resolved or if no network connection is available, etc.}}
\DoxyCodeLine{01155             \textcolor{keywordtype}{bool} connecting = this.LoadBalancingPeer.Connect(serverAddress, proxyServerAddress, this.AppId, this.TokenForInit);}
\DoxyCodeLine{01156 }
\DoxyCodeLine{01157             \textcolor{keywordflow}{if} (connecting)}
\DoxyCodeLine{01158             \{}
\DoxyCodeLine{01159                 this.DisconnectedCause = DisconnectCause.None;}
\DoxyCodeLine{01160                 this.Server = serverType;}
\DoxyCodeLine{01161 }
\DoxyCodeLine{01162                 \textcolor{keywordflow}{switch} (serverType)}
\DoxyCodeLine{01163                 \{}
\DoxyCodeLine{01164                     \textcolor{keywordflow}{case} ServerConnection.NameServer:}
\DoxyCodeLine{01165                         State = ClientState.ConnectingToNameServer;}
\DoxyCodeLine{01166                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01167                     \textcolor{keywordflow}{case} ServerConnection.MasterServer:}
\DoxyCodeLine{01168                         State = ClientState.ConnectingToMasterServer;}
\DoxyCodeLine{01169                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01170                     \textcolor{keywordflow}{case} ServerConnection.GameServer:}
\DoxyCodeLine{01171                         State = ClientState.ConnectingToGameServer;}
\DoxyCodeLine{01172                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01173                 \}}
\DoxyCodeLine{01174             \}}
\DoxyCodeLine{01175 }
\DoxyCodeLine{01176             \textcolor{keywordflow}{return} connecting;}
\DoxyCodeLine{01177         \}}
\DoxyCodeLine{01178 }
\DoxyCodeLine{01179 }
\DoxyCodeLine{01182         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} ReconnectToMaster()}
\DoxyCodeLine{01183         \{}
\DoxyCodeLine{01184             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.PeerState != PeerStateValue.Disconnected)}
\DoxyCodeLine{01185             \{}
\DoxyCodeLine{01186                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectToMaster() failed. Can only connect while in state 'Disconnected'. Current state: "{}} + \textcolor{keyword}{this}.LoadBalancingPeer.PeerState);}
\DoxyCodeLine{01187                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01188             \}}
\DoxyCodeLine{01189 }
\DoxyCodeLine{01190             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(this.MasterServerAddress))}
\DoxyCodeLine{01191             \{}
\DoxyCodeLine{01192                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectToMaster() failed. MasterServerAddress is null or empty."{}});}
\DoxyCodeLine{01193                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01194             \}}
\DoxyCodeLine{01195             \textcolor{keywordflow}{if} (this.tokenCache == \textcolor{keyword}{null})}
\DoxyCodeLine{01196             \{}
\DoxyCodeLine{01197                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectToMaster() failed. It seems the client doesn't have any previous authentication token to re-\/connect."{}});}
\DoxyCodeLine{01198                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01199             \}}
\DoxyCodeLine{01200 }
\DoxyCodeLine{01201             \textcolor{keywordflow}{if} (this.AuthValues == \textcolor{keyword}{null})}
\DoxyCodeLine{01202             \{}
\DoxyCodeLine{01203                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectToMaster() with AuthValues == null is not correct!"{}});}
\DoxyCodeLine{01204                 this.AuthValues = \textcolor{keyword}{new} AuthenticationValues();}
\DoxyCodeLine{01205             \}}
\DoxyCodeLine{01206             this.AuthValues.Token = this.tokenCache;}
\DoxyCodeLine{01207 }
\DoxyCodeLine{01208             \textcolor{keywordflow}{return} this.Connect(this.MasterServerAddress, this.ProxyServerAddress, ServerConnection.MasterServer);}
\DoxyCodeLine{01209         \}}
\DoxyCodeLine{01210 }
\DoxyCodeLine{01219         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} ReconnectAndRejoin()}
\DoxyCodeLine{01220         \{}
\DoxyCodeLine{01221             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.PeerState != PeerStateValue.Disconnected)}
\DoxyCodeLine{01222             \{}
\DoxyCodeLine{01223                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectAndRejoin() failed. Can only connect while in state 'Disconnected'. Current state: "{}} + \textcolor{keyword}{this}.LoadBalancingPeer.PeerState);}
\DoxyCodeLine{01224                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01225             \}}
\DoxyCodeLine{01226 }
\DoxyCodeLine{01227             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(this.GameServerAddress))}
\DoxyCodeLine{01228             \{}
\DoxyCodeLine{01229                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectAndRejoin() failed. It seems the client wasn't connected to a game server before (no address)."{}});}
\DoxyCodeLine{01230                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01231             \}}
\DoxyCodeLine{01232             \textcolor{keywordflow}{if} (this.enterRoomParamsCache == \textcolor{keyword}{null})}
\DoxyCodeLine{01233             \{}
\DoxyCodeLine{01234                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectAndRejoin() failed. It seems the client doesn't have any previous room to re-\/join."{}});}
\DoxyCodeLine{01235                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01236             \}}
\DoxyCodeLine{01237             \textcolor{keywordflow}{if} (this.tokenCache == \textcolor{keyword}{null})}
\DoxyCodeLine{01238             \{}
\DoxyCodeLine{01239                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}ReconnectAndRejoin() failed. It seems the client doesn't have any previous authentication token to re-\/connect."{}});}
\DoxyCodeLine{01240                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01241             \}}
\DoxyCodeLine{01242 }
\DoxyCodeLine{01243             \textcolor{keywordflow}{if} (this.AuthValues == \textcolor{keyword}{null})}
\DoxyCodeLine{01244             \{}
\DoxyCodeLine{01245                 this.AuthValues = \textcolor{keyword}{new} AuthenticationValues();}
\DoxyCodeLine{01246             \}}
\DoxyCodeLine{01247             this.AuthValues.Token = this.tokenCache;}
\DoxyCodeLine{01248 }
\DoxyCodeLine{01249 }
\DoxyCodeLine{01250             \textcolor{keywordflow}{if} (!\textcolor{keywordtype}{string}.IsNullOrEmpty(this.GameServerAddress) \&\& this.enterRoomParamsCache != \textcolor{keyword}{null})}
\DoxyCodeLine{01251             \{}
\DoxyCodeLine{01252                 this.lastJoinType = JoinType.JoinRoom;}
\DoxyCodeLine{01253                 this.enterRoomParamsCache.JoinMode = JoinMode.RejoinOnly;}
\DoxyCodeLine{01254                 \textcolor{keywordflow}{return} this.Connect(this.GameServerAddress, this.ProxyServerAddress, ServerConnection.GameServer);}
\DoxyCodeLine{01255             \}}
\DoxyCodeLine{01256 }
\DoxyCodeLine{01257             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01258         \}}
\DoxyCodeLine{01259 }
\DoxyCodeLine{01260 }
\DoxyCodeLine{01270         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Disconnect(DisconnectCause cause = DisconnectCause.DisconnectByClientLogic)}
\DoxyCodeLine{01271         \{}
\DoxyCodeLine{01272             \textcolor{keywordflow}{if} (this.State == ClientState.Disconnecting || \textcolor{keyword}{this}.State == ClientState.PeerCreated)}
\DoxyCodeLine{01273             \{}
\DoxyCodeLine{01274                 this.DebugReturn(DebugLevel.INFO, \textcolor{stringliteral}{"{}Disconnect() call gets skipped due to State "{}} + \textcolor{keyword}{this}.State + \textcolor{stringliteral}{"{}. DisconnectedCause: "{}} + \textcolor{keyword}{this}.DisconnectedCause + \textcolor{stringliteral}{"{} Parameter cause: "{}} + cause);}
\DoxyCodeLine{01275                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01276             \}}
\DoxyCodeLine{01277 }
\DoxyCodeLine{01278             \textcolor{keywordflow}{if} (this.State != ClientState.Disconnected)}
\DoxyCodeLine{01279             \{}
\DoxyCodeLine{01280                 this.State = ClientState.Disconnecting;}
\DoxyCodeLine{01281                 this.DisconnectedCause = cause;}
\DoxyCodeLine{01282                 this.LoadBalancingPeer.Disconnect();}
\DoxyCodeLine{01283             \}}
\DoxyCodeLine{01284         \}}
\DoxyCodeLine{01285 }
\DoxyCodeLine{01286 }
\DoxyCodeLine{01290         \textcolor{keyword}{private} \textcolor{keywordtype}{void} DisconnectToReconnect()}
\DoxyCodeLine{01291         \{}
\DoxyCodeLine{01292             \textcolor{keywordflow}{switch} (this.Server)}
\DoxyCodeLine{01293             \{}
\DoxyCodeLine{01294                 \textcolor{keywordflow}{case} ServerConnection.NameServer:}
\DoxyCodeLine{01295                     this.State = ClientState.DisconnectingFromNameServer;}
\DoxyCodeLine{01296                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01297                 \textcolor{keywordflow}{case} ServerConnection.MasterServer:}
\DoxyCodeLine{01298                     this.State = ClientState.DisconnectingFromMasterServer;}
\DoxyCodeLine{01299                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01300                 \textcolor{keywordflow}{case} ServerConnection.GameServer:}
\DoxyCodeLine{01301                     this.State = ClientState.DisconnectingFromGameServer;}
\DoxyCodeLine{01302                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01303             \}}
\DoxyCodeLine{01304 }
\DoxyCodeLine{01305             this.LoadBalancingPeer.Disconnect();}
\DoxyCodeLine{01306         \}}
\DoxyCodeLine{01307 }
\DoxyCodeLine{01327         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SimulateConnectionLoss(\textcolor{keywordtype}{bool} simulateTimeout)}
\DoxyCodeLine{01328         \{}
\DoxyCodeLine{01329             this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}SimulateConnectionLoss() set to: "{}}+simulateTimeout);}
\DoxyCodeLine{01330 }
\DoxyCodeLine{01331             \textcolor{keywordflow}{if} (simulateTimeout)}
\DoxyCodeLine{01332             \{}
\DoxyCodeLine{01333                 this.LoadBalancingPeer.NetworkSimulationSettings.IncomingLossPercentage = 100;}
\DoxyCodeLine{01334                 this.LoadBalancingPeer.NetworkSimulationSettings.OutgoingLossPercentage = 100;}
\DoxyCodeLine{01335             \}}
\DoxyCodeLine{01336 }
\DoxyCodeLine{01337             this.LoadBalancingPeer.IsSimulationEnabled = simulateTimeout;}
\DoxyCodeLine{01338         \}}
\DoxyCodeLine{01339 }
\DoxyCodeLine{01340         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} CallAuthenticate()}
\DoxyCodeLine{01341         \{}
\DoxyCodeLine{01342             \textcolor{keywordflow}{if} (this.IsUsingNameServer \&\& this.Server != ServerConnection.NameServer \&\& (\textcolor{keyword}{this}.AuthValues == \textcolor{keyword}{null} || \textcolor{keyword}{this}.AuthValues.Token == \textcolor{keyword}{null}))}
\DoxyCodeLine{01343             \{}
\DoxyCodeLine{01344                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}Authenticate without Token is only allowed on Name Server. Connecting to: "{}} + \textcolor{keyword}{this}.Server + \textcolor{stringliteral}{"{} on: "{}} + \textcolor{keyword}{this}.CurrentServerAddress + \textcolor{stringliteral}{"{}. State: "{}} + \textcolor{keyword}{this}.State);}
\DoxyCodeLine{01345                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01346             \}}
\DoxyCodeLine{01347 }
\DoxyCodeLine{01348             \textcolor{keywordflow}{if} (this.AuthMode == AuthModeOption.Auth)}
\DoxyCodeLine{01349             \{}
\DoxyCodeLine{01350                 \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.Authenticate, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}Authenticate"{}}))}
\DoxyCodeLine{01351                 \{}
\DoxyCodeLine{01352                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01353                 \}}
\DoxyCodeLine{01354                 \textcolor{keywordflow}{return} this.LoadBalancingPeer.OpAuthenticate(this.AppId, this.AppVersion, this.AuthValues, this.CloudRegion, (this.EnableLobbyStatistics \&\& this.Server == ServerConnection.MasterServer));}
\DoxyCodeLine{01355             \}}
\DoxyCodeLine{01356             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01357             \{}
\DoxyCodeLine{01358                 \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.AuthenticateOnce, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}AuthenticateOnce"{}}))}
\DoxyCodeLine{01359                 \{}
\DoxyCodeLine{01360                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01361                 \}}
\DoxyCodeLine{01362 }
\DoxyCodeLine{01363                 ConnectionProtocol targetProtocolPastNameServer = this.ExpectedProtocol != \textcolor{keyword}{null} ? (ConnectionProtocol) this.ExpectedProtocol : this.LoadBalancingPeer.TransportProtocol;}
\DoxyCodeLine{01364                 \textcolor{keywordflow}{return} \textcolor{keyword}{this}.LoadBalancingPeer.OpAuthenticateOnce(\textcolor{keyword}{this}.AppId, \textcolor{keyword}{this}.AppVersion, \textcolor{keyword}{this}.AuthValues, \textcolor{keyword}{this}.CloudRegion, \textcolor{keyword}{this}.EncryptionMode, targetProtocolPastNameServer);}
\DoxyCodeLine{01365             \}}
\DoxyCodeLine{01366         \}}
\DoxyCodeLine{01367 }
\DoxyCodeLine{01368 }
\DoxyCodeLine{01395         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Service()}
\DoxyCodeLine{01396         \{}
\DoxyCodeLine{01397             \textcolor{keywordflow}{if} (this.LoadBalancingPeer != \textcolor{keyword}{null})}
\DoxyCodeLine{01398             \{}
\DoxyCodeLine{01399                 this.LoadBalancingPeer.Service();}
\DoxyCodeLine{01400             \}}
\DoxyCodeLine{01401         \}}
\DoxyCodeLine{01402 }
\DoxyCodeLine{01403 }
\DoxyCodeLine{01408         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} OpGetRegions()}
\DoxyCodeLine{01409         \{}
\DoxyCodeLine{01410             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.GetRegions, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}GetRegions"{}}))}
\DoxyCodeLine{01411             \{}
\DoxyCodeLine{01412                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01413             \}}
\DoxyCodeLine{01414 }
\DoxyCodeLine{01415             \textcolor{keywordtype}{bool} sent = this.LoadBalancingPeer.OpGetRegions(this.AppId);}
\DoxyCodeLine{01416             \textcolor{keywordflow}{return} sent;}
\DoxyCodeLine{01417         \}}
\DoxyCodeLine{01418 }
\DoxyCodeLine{01419 }
\DoxyCodeLine{01444         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpFindFriends(\textcolor{keywordtype}{string}[] friendsToFind, FindFriendsOptions options = \textcolor{keyword}{null})}
\DoxyCodeLine{01445         \{}
\DoxyCodeLine{01446             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.FindFriends, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}FindFriends"{}}))}
\DoxyCodeLine{01447             \{}
\DoxyCodeLine{01448                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01449             \}}
\DoxyCodeLine{01450 }
\DoxyCodeLine{01451             \textcolor{keywordflow}{if} (this.IsFetchingFriendList)}
\DoxyCodeLine{01452             \{}
\DoxyCodeLine{01453                 this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}OpFindFriends skipped: already fetching friends list."{}});}
\DoxyCodeLine{01454                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};   \textcolor{comment}{// fetching friends currently, so don't do it again (avoid changing the list while fetching friends)}}
\DoxyCodeLine{01455             \}}
\DoxyCodeLine{01456 }
\DoxyCodeLine{01457             \textcolor{keywordflow}{if} (friendsToFind == \textcolor{keyword}{null} || friendsToFind.Length == 0)}
\DoxyCodeLine{01458             \{}
\DoxyCodeLine{01459                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpFindFriends skipped: friendsToFind array is null or empty."{}});}
\DoxyCodeLine{01460                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01461             \}}
\DoxyCodeLine{01462 }
\DoxyCodeLine{01463             \textcolor{keywordflow}{if} (friendsToFind.Length > FriendRequestListMax)}
\DoxyCodeLine{01464             \{}
\DoxyCodeLine{01465                 this.DebugReturn(DebugLevel.ERROR, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}OpFindFriends skipped: friendsToFind array exceeds allowed length of \{0\}."{}}, FriendRequestListMax));}
\DoxyCodeLine{01466                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01467             \}}
\DoxyCodeLine{01468 }
\DoxyCodeLine{01469             List<string> friendsList = \textcolor{keyword}{new} List<string>(friendsToFind.Length);}
\DoxyCodeLine{01470             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < friendsToFind.Length; i++)}
\DoxyCodeLine{01471             \{}
\DoxyCodeLine{01472                 \textcolor{keywordtype}{string} friendUserId = friendsToFind[i];}
\DoxyCodeLine{01473                 \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(friendUserId))}
\DoxyCodeLine{01474                 \{}
\DoxyCodeLine{01475                     this.DebugReturn(DebugLevel.WARNING,}
\DoxyCodeLine{01476                         \textcolor{keywordtype}{string}.Format(}
\DoxyCodeLine{01477                             \textcolor{stringliteral}{"{}friendsToFind array contains a null or empty UserId, element at position \{0\} skipped."{}},}
\DoxyCodeLine{01478                             i));}
\DoxyCodeLine{01479                 \}}
\DoxyCodeLine{01480                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (friendUserId.Equals(UserId))}
\DoxyCodeLine{01481                 \{}
\DoxyCodeLine{01482                     this.DebugReturn(DebugLevel.WARNING,}
\DoxyCodeLine{01483                         \textcolor{keywordtype}{string}.Format(}
\DoxyCodeLine{01484                             \textcolor{stringliteral}{"{}friendsToFind array contains local player's UserId \(\backslash\)"{}\{0\}\(\backslash\)"{}, element at position \{1\} skipped."{}},}
\DoxyCodeLine{01485                             friendUserId,}
\DoxyCodeLine{01486                             i));}
\DoxyCodeLine{01487                 \}}
\DoxyCodeLine{01488                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (friendsList.Contains(friendUserId))}
\DoxyCodeLine{01489                 \{}
\DoxyCodeLine{01490                     this.DebugReturn(DebugLevel.WARNING,}
\DoxyCodeLine{01491                         \textcolor{keywordtype}{string}.Format(}
\DoxyCodeLine{01492                             \textcolor{stringliteral}{"{}friendsToFind array contains duplicate UserId \(\backslash\)"{}\{0\}\(\backslash\)"{}, element at position \{1\} skipped."{}},}
\DoxyCodeLine{01493                             friendUserId,}
\DoxyCodeLine{01494                             i));}
\DoxyCodeLine{01495                 \}}
\DoxyCodeLine{01496                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{01497                 \{}
\DoxyCodeLine{01498                     friendsList.Add(friendUserId);}
\DoxyCodeLine{01499                 \}}
\DoxyCodeLine{01500             \}}
\DoxyCodeLine{01501 }
\DoxyCodeLine{01502             \textcolor{keywordflow}{if} (friendsList.Count == 0)}
\DoxyCodeLine{01503             \{}
\DoxyCodeLine{01504                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpFindFriends skipped: friends list to find is empty."{}});}
\DoxyCodeLine{01505                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01506             \}}
\DoxyCodeLine{01507 }
\DoxyCodeLine{01508             \textcolor{keywordtype}{string}[] filteredArray = friendsList.ToArray();}
\DoxyCodeLine{01509             \textcolor{keywordtype}{bool} sent = this.LoadBalancingPeer.OpFindFriends(filteredArray, options);}
\DoxyCodeLine{01510             this.friendListRequested = sent ? filteredArray : \textcolor{keyword}{null};}
\DoxyCodeLine{01511 }
\DoxyCodeLine{01512             \textcolor{keywordflow}{return} sent;}
\DoxyCodeLine{01513         \}}
\DoxyCodeLine{01514 }
\DoxyCodeLine{01518         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpJoinLobby(TypedLobby lobby)}
\DoxyCodeLine{01519         \{}
\DoxyCodeLine{01520             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.JoinLobby, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}JoinLobby"{}}))}
\DoxyCodeLine{01521             \{}
\DoxyCodeLine{01522                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01523             \}}
\DoxyCodeLine{01524 }
\DoxyCodeLine{01525             \textcolor{keywordflow}{if} (lobby == \textcolor{keyword}{null})}
\DoxyCodeLine{01526             \{}
\DoxyCodeLine{01527                 lobby = TypedLobby.Default;}
\DoxyCodeLine{01528             \}}
\DoxyCodeLine{01529             \textcolor{keywordtype}{bool} sent = this.LoadBalancingPeer.OpJoinLobby(lobby);}
\DoxyCodeLine{01530             \textcolor{keywordflow}{if} (sent)}
\DoxyCodeLine{01531             \{}
\DoxyCodeLine{01532                 this.CurrentLobby = lobby;}
\DoxyCodeLine{01533                 this.State = ClientState.JoiningLobby;}
\DoxyCodeLine{01534             \}}
\DoxyCodeLine{01535 }
\DoxyCodeLine{01536             \textcolor{keywordflow}{return} sent;}
\DoxyCodeLine{01537         \}}
\DoxyCodeLine{01538 }
\DoxyCodeLine{01539 }
\DoxyCodeLine{01542         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpLeaveLobby()}
\DoxyCodeLine{01543         \{}
\DoxyCodeLine{01544             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.LeaveLobby, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}LeaveLobby"{}}))}
\DoxyCodeLine{01545             \{}
\DoxyCodeLine{01546                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01547             \}}
\DoxyCodeLine{01548             \textcolor{keywordflow}{return} this.LoadBalancingPeer.OpLeaveLobby();}
\DoxyCodeLine{01549         \}}
\DoxyCodeLine{01550 }
\DoxyCodeLine{01551 }
\DoxyCodeLine{01590         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpJoinRandomRoom(OpJoinRandomRoomParams opJoinRandomRoomParams = \textcolor{keyword}{null})}
\DoxyCodeLine{01591         \{}
\DoxyCodeLine{01592             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.JoinRandomGame, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}JoinRandomGame"{}}))}
\DoxyCodeLine{01593             \{}
\DoxyCodeLine{01594                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01595             \}}
\DoxyCodeLine{01596 }
\DoxyCodeLine{01597             \textcolor{keywordflow}{if} (opJoinRandomRoomParams == \textcolor{keyword}{null})}
\DoxyCodeLine{01598             \{}
\DoxyCodeLine{01599                 opJoinRandomRoomParams = \textcolor{keyword}{new} OpJoinRandomRoomParams();}
\DoxyCodeLine{01600             \}}
\DoxyCodeLine{01601 }
\DoxyCodeLine{01602             this.enterRoomParamsCache = \textcolor{keyword}{new} EnterRoomParams();}
\DoxyCodeLine{01603             this.enterRoomParamsCache.Lobby = opJoinRandomRoomParams.TypedLobby;}
\DoxyCodeLine{01604             this.enterRoomParamsCache.ExpectedUsers = opJoinRandomRoomParams.ExpectedUsers;}
\DoxyCodeLine{01605 }
\DoxyCodeLine{01606 }
\DoxyCodeLine{01607             \textcolor{keywordtype}{bool} sending = this.LoadBalancingPeer.OpJoinRandomRoom(opJoinRandomRoomParams);}
\DoxyCodeLine{01608             \textcolor{keywordflow}{if} (sending)}
\DoxyCodeLine{01609             \{}
\DoxyCodeLine{01610                 this.lastJoinType = JoinType.JoinRandomRoom;}
\DoxyCodeLine{01611                 this.State = ClientState.Joining;}
\DoxyCodeLine{01612             \}}
\DoxyCodeLine{01613             \textcolor{keywordflow}{return} sending;}
\DoxyCodeLine{01614         \}}
\DoxyCodeLine{01615 }
\DoxyCodeLine{01616 }
\DoxyCodeLine{01640         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpJoinRandomOrCreateRoom(OpJoinRandomRoomParams opJoinRandomRoomParams, EnterRoomParams createRoomParams)}
\DoxyCodeLine{01641         \{}
\DoxyCodeLine{01642             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.JoinRandomGame, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}OpJoinRandomOrCreateRoom"{}}))}
\DoxyCodeLine{01643             \{}
\DoxyCodeLine{01644                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01645             \}}
\DoxyCodeLine{01646 }
\DoxyCodeLine{01647             \textcolor{keywordflow}{if} (opJoinRandomRoomParams == \textcolor{keyword}{null})}
\DoxyCodeLine{01648             \{}
\DoxyCodeLine{01649                 opJoinRandomRoomParams = \textcolor{keyword}{new} OpJoinRandomRoomParams();}
\DoxyCodeLine{01650             \}}
\DoxyCodeLine{01651             \textcolor{keywordflow}{if} (createRoomParams == \textcolor{keyword}{null})}
\DoxyCodeLine{01652             \{}
\DoxyCodeLine{01653                 createRoomParams = \textcolor{keyword}{new} EnterRoomParams();}
\DoxyCodeLine{01654             \}}
\DoxyCodeLine{01655 }
\DoxyCodeLine{01656             createRoomParams.JoinMode = JoinMode.CreateIfNotExists;}
\DoxyCodeLine{01657             this.enterRoomParamsCache = createRoomParams;}
\DoxyCodeLine{01658             this.enterRoomParamsCache.Lobby = opJoinRandomRoomParams.TypedLobby;}
\DoxyCodeLine{01659             this.enterRoomParamsCache.ExpectedUsers = opJoinRandomRoomParams.ExpectedUsers;}
\DoxyCodeLine{01660 }
\DoxyCodeLine{01661 }
\DoxyCodeLine{01662             \textcolor{keywordtype}{bool} sending = this.LoadBalancingPeer.OpJoinRandomOrCreateRoom(opJoinRandomRoomParams, createRoomParams);}
\DoxyCodeLine{01663             \textcolor{keywordflow}{if} (sending)}
\DoxyCodeLine{01664             \{}
\DoxyCodeLine{01665                 this.lastJoinType = JoinType.JoinRandomOrCreateRoom;}
\DoxyCodeLine{01666                 this.State = ClientState.Joining;}
\DoxyCodeLine{01667             \}}
\DoxyCodeLine{01668             \textcolor{keywordflow}{return} sending;}
\DoxyCodeLine{01669         \}}
\DoxyCodeLine{01670 }
\DoxyCodeLine{01671 }
\DoxyCodeLine{01672 }
\DoxyCodeLine{01702         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpCreateRoom(EnterRoomParams enterRoomParams)}
\DoxyCodeLine{01703         \{}
\DoxyCodeLine{01704             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.CreateGame, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}CreateGame"{}}))}
\DoxyCodeLine{01705             \{}
\DoxyCodeLine{01706                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01707             \}}
\DoxyCodeLine{01708             \textcolor{keywordtype}{bool} onGameServer = this.Server == ServerConnection.GameServer;}
\DoxyCodeLine{01709             enterRoomParams.OnGameServer = onGameServer;}
\DoxyCodeLine{01710             \textcolor{keywordflow}{if} (!onGameServer)}
\DoxyCodeLine{01711             \{}
\DoxyCodeLine{01712                 this.enterRoomParamsCache = enterRoomParams;}
\DoxyCodeLine{01713             \}}
\DoxyCodeLine{01714 }
\DoxyCodeLine{01715             \textcolor{keywordtype}{bool} sending = this.LoadBalancingPeer.OpCreateRoom(enterRoomParams);}
\DoxyCodeLine{01716             \textcolor{keywordflow}{if} (sending)}
\DoxyCodeLine{01717             \{}
\DoxyCodeLine{01718                 this.lastJoinType = JoinType.CreateRoom;}
\DoxyCodeLine{01719                 this.State = ClientState.Joining;}
\DoxyCodeLine{01720             \}}
\DoxyCodeLine{01721             \textcolor{keywordflow}{return} sending;}
\DoxyCodeLine{01722         \}}
\DoxyCodeLine{01723 }
\DoxyCodeLine{01724 }
\DoxyCodeLine{01765         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpJoinOrCreateRoom(EnterRoomParams enterRoomParams)}
\DoxyCodeLine{01766         \{}
\DoxyCodeLine{01767             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.JoinGame, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}JoinOrCreateRoom"{}}))}
\DoxyCodeLine{01768             \{}
\DoxyCodeLine{01769                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01770             \}}
\DoxyCodeLine{01771 }
\DoxyCodeLine{01772             \textcolor{keywordtype}{bool} onGameServer = this.Server == ServerConnection.GameServer;}
\DoxyCodeLine{01773             enterRoomParams.JoinMode = JoinMode.CreateIfNotExists;}
\DoxyCodeLine{01774             enterRoomParams.OnGameServer = onGameServer;}
\DoxyCodeLine{01775             \textcolor{keywordflow}{if} (!onGameServer)}
\DoxyCodeLine{01776             \{}
\DoxyCodeLine{01777                 this.enterRoomParamsCache = enterRoomParams;}
\DoxyCodeLine{01778             \}}
\DoxyCodeLine{01779 }
\DoxyCodeLine{01780             \textcolor{keywordtype}{bool} sending = this.LoadBalancingPeer.OpJoinRoom(enterRoomParams);}
\DoxyCodeLine{01781             \textcolor{keywordflow}{if} (sending)}
\DoxyCodeLine{01782             \{}
\DoxyCodeLine{01783                 this.lastJoinType = JoinType.JoinOrCreateRoom;}
\DoxyCodeLine{01784                 this.State = ClientState.Joining;}
\DoxyCodeLine{01785             \}}
\DoxyCodeLine{01786             \textcolor{keywordflow}{return} sending;}
\DoxyCodeLine{01787         \}}
\DoxyCodeLine{01788 }
\DoxyCodeLine{01789 }
\DoxyCodeLine{01830         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpJoinRoom(EnterRoomParams enterRoomParams)}
\DoxyCodeLine{01831         \{}
\DoxyCodeLine{01832             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.JoinGame, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}JoinRoom"{}}))}
\DoxyCodeLine{01833             \{}
\DoxyCodeLine{01834                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01835             \}}
\DoxyCodeLine{01836 }
\DoxyCodeLine{01837             \textcolor{keywordtype}{bool} onGameServer = this.Server == ServerConnection.GameServer;}
\DoxyCodeLine{01838             enterRoomParams.OnGameServer = onGameServer;}
\DoxyCodeLine{01839             \textcolor{keywordflow}{if} (!onGameServer)}
\DoxyCodeLine{01840             \{}
\DoxyCodeLine{01841                 this.enterRoomParamsCache = enterRoomParams;}
\DoxyCodeLine{01842             \}}
\DoxyCodeLine{01843 }
\DoxyCodeLine{01844             \textcolor{keywordtype}{bool} sending = this.LoadBalancingPeer.OpJoinRoom(enterRoomParams);}
\DoxyCodeLine{01845             \textcolor{keywordflow}{if} (sending)}
\DoxyCodeLine{01846             \{}
\DoxyCodeLine{01847                 this.lastJoinType = enterRoomParams.JoinMode == JoinMode.CreateIfNotExists ? JoinType.JoinOrCreateRoom : JoinType.JoinRoom;}
\DoxyCodeLine{01848                 this.State = ClientState.Joining;}
\DoxyCodeLine{01849             \}}
\DoxyCodeLine{01850             \textcolor{keywordflow}{return} sending;}
\DoxyCodeLine{01851         \}}
\DoxyCodeLine{01852 }
\DoxyCodeLine{01853 }
\DoxyCodeLine{01871         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpRejoinRoom(\textcolor{keywordtype}{string} roomName)}
\DoxyCodeLine{01872         \{}
\DoxyCodeLine{01873             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.JoinGame, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}RejoinRoom"{}}))}
\DoxyCodeLine{01874             \{}
\DoxyCodeLine{01875                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01876             \}}
\DoxyCodeLine{01877 }
\DoxyCodeLine{01878             \textcolor{keywordtype}{bool} onGameServer = this.Server == ServerConnection.GameServer;}
\DoxyCodeLine{01879 }
\DoxyCodeLine{01880             EnterRoomParams opParams = \textcolor{keyword}{new} EnterRoomParams();}
\DoxyCodeLine{01881             this.enterRoomParamsCache = opParams;}
\DoxyCodeLine{01882             opParams.RoomName = roomName;}
\DoxyCodeLine{01883             opParams.OnGameServer = onGameServer;}
\DoxyCodeLine{01884             opParams.JoinMode = JoinMode.RejoinOnly;}
\DoxyCodeLine{01885 }
\DoxyCodeLine{01886             \textcolor{keywordtype}{bool} sending = this.LoadBalancingPeer.OpJoinRoom(opParams);}
\DoxyCodeLine{01887             \textcolor{keywordflow}{if} (sending)}
\DoxyCodeLine{01888             \{}
\DoxyCodeLine{01889                 this.lastJoinType = JoinType.JoinRoom;}
\DoxyCodeLine{01890                 this.State = ClientState.Joining;}
\DoxyCodeLine{01891             \}}
\DoxyCodeLine{01892             \textcolor{keywordflow}{return} sending;}
\DoxyCodeLine{01893         \}}
\DoxyCodeLine{01894 }
\DoxyCodeLine{01895 }
\DoxyCodeLine{01910         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpLeaveRoom(\textcolor{keywordtype}{bool} becomeInactive, \textcolor{keywordtype}{bool} sendAuthCookie = \textcolor{keyword}{false})}
\DoxyCodeLine{01911         \{}
\DoxyCodeLine{01912             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.Leave, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}LeaveRoom"{}}))}
\DoxyCodeLine{01913             \{}
\DoxyCodeLine{01914                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01915             \}}
\DoxyCodeLine{01916 }
\DoxyCodeLine{01917             this.State = ClientState.Leaving;}
\DoxyCodeLine{01918             this.GameServerAddress = String.Empty;}
\DoxyCodeLine{01919             this.enterRoomParamsCache = \textcolor{keyword}{null};}
\DoxyCodeLine{01920             \textcolor{keywordflow}{return} this.LoadBalancingPeer.OpLeaveRoom(becomeInactive, sendAuthCookie);}
\DoxyCodeLine{01921         \}}
\DoxyCodeLine{01922 }
\DoxyCodeLine{01923 }
\DoxyCodeLine{01935         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpGetGameList(TypedLobby typedLobby, \textcolor{keywordtype}{string} sqlLobbyFilter)}
\DoxyCodeLine{01936         \{}
\DoxyCodeLine{01937             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.GetGameList, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}GetGameList"{}}))}
\DoxyCodeLine{01938             \{}
\DoxyCodeLine{01939                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01940             \}}
\DoxyCodeLine{01941 }
\DoxyCodeLine{01942             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(sqlLobbyFilter))}
\DoxyCodeLine{01943             \{}
\DoxyCodeLine{01944                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}Operation GetGameList requires a filter."{}});}
\DoxyCodeLine{01945                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01946             \}}
\DoxyCodeLine{01947             \textcolor{keywordflow}{if} (typedLobby.Type != LobbyType.SqlLobby)}
\DoxyCodeLine{01948             \{}
\DoxyCodeLine{01949                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}Operation GetGameList can only be used for lobbies of type SqlLobby."{}});}
\DoxyCodeLine{01950                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01951             \}}
\DoxyCodeLine{01952 }
\DoxyCodeLine{01953             \textcolor{keywordflow}{return} this.LoadBalancingPeer.OpGetGameList(typedLobby, sqlLobbyFilter);}
\DoxyCodeLine{01954         \}}
\DoxyCodeLine{01955 }
\DoxyCodeLine{01956 }
\DoxyCodeLine{02005         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpSetCustomPropertiesOfActor(\textcolor{keywordtype}{int} actorNr, Hashtable propertiesToSet, Hashtable expectedProperties = \textcolor{keyword}{null}, WebFlags webFlags = \textcolor{keyword}{null})}
\DoxyCodeLine{02006         \{}
\DoxyCodeLine{02007             \textcolor{keywordflow}{if} (propertiesToSet == \textcolor{keyword}{null} || propertiesToSet.Count == 0)}
\DoxyCodeLine{02008             \{}
\DoxyCodeLine{02009                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetCustomPropertiesOfActor() failed. propertiesToSet must not be null nor empty."{}});}
\DoxyCodeLine{02010                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02011             \}}
\DoxyCodeLine{02012 }
\DoxyCodeLine{02013             \textcolor{keywordflow}{if} (this.CurrentRoom == \textcolor{keyword}{null})}
\DoxyCodeLine{02014             \{}
\DoxyCodeLine{02015                 \textcolor{comment}{// if you attempt to set this player's values without conditions, then fine:}}
\DoxyCodeLine{02016                 \textcolor{keywordflow}{if} (expectedProperties == \textcolor{keyword}{null} \&\& webFlags == \textcolor{keyword}{null} \&\& this.LocalPlayer != \textcolor{keyword}{null} \&\& this.LocalPlayer.ActorNumber == actorNr)}
\DoxyCodeLine{02017                 \{}
\DoxyCodeLine{02018                     \textcolor{keywordflow}{return} this.LocalPlayer.SetCustomProperties(propertiesToSet);}
\DoxyCodeLine{02019                 \}}
\DoxyCodeLine{02020 }
\DoxyCodeLine{02021                 \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= DebugLevel.ERROR)}
\DoxyCodeLine{02022                 \{}
\DoxyCodeLine{02023                     this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetCustomPropertiesOfActor() failed. To use expectedProperties or webForward, you have to be in a room. State: "{}} + \textcolor{keyword}{this}.State);}
\DoxyCodeLine{02024                 \}}
\DoxyCodeLine{02025                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02026             \}}
\DoxyCodeLine{02027 }
\DoxyCodeLine{02028             Hashtable customActorProperties = \textcolor{keyword}{new} Hashtable();}
\DoxyCodeLine{02029             customActorProperties.MergeStringKeys(propertiesToSet);}
\DoxyCodeLine{02030             \textcolor{keywordflow}{if} (customActorProperties.Count == 0)}
\DoxyCodeLine{02031             \{}
\DoxyCodeLine{02032                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetCustomPropertiesOfActor() failed. Only string keys allowed for custom properties."{}});}
\DoxyCodeLine{02033                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02034             \}}
\DoxyCodeLine{02035             \textcolor{keywordflow}{return} this.OpSetPropertiesOfActor(actorNr, customActorProperties, expectedProperties, webFlags);}
\DoxyCodeLine{02036         \}}
\DoxyCodeLine{02037 }
\DoxyCodeLine{02038 }
\DoxyCodeLine{02041         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keywordtype}{bool} OpSetPropertiesOfActor(\textcolor{keywordtype}{int} actorNr, Hashtable actorProperties, Hashtable expectedProperties = \textcolor{keyword}{null}, WebFlags webFlags = \textcolor{keyword}{null})}
\DoxyCodeLine{02042         \{}
\DoxyCodeLine{02043             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.SetProperties, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}SetProperties"{}}))}
\DoxyCodeLine{02044             \{}
\DoxyCodeLine{02045                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02046             \}}
\DoxyCodeLine{02047 }
\DoxyCodeLine{02048             \textcolor{keywordflow}{if} (actorProperties == \textcolor{keyword}{null} || actorProperties.Count == 0)}
\DoxyCodeLine{02049             \{}
\DoxyCodeLine{02050                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetPropertiesOfActor() failed. actorProperties must not be null nor empty."{}});}
\DoxyCodeLine{02051                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02052             \}}
\DoxyCodeLine{02053             \textcolor{keywordtype}{bool} res = this.LoadBalancingPeer.OpSetPropertiesOfActor(actorNr, actorProperties, expectedProperties, webFlags);}
\DoxyCodeLine{02054             \textcolor{keywordflow}{if} (res \&\& !this.CurrentRoom.BroadcastPropertiesChangeToAll \&\& (expectedProperties == \textcolor{keyword}{null} || expectedProperties.Count == 0))}
\DoxyCodeLine{02055             \{}
\DoxyCodeLine{02056                 Player target = this.CurrentRoom.GetPlayer(actorNr);}
\DoxyCodeLine{02057                 \textcolor{keywordflow}{if} (target != \textcolor{keyword}{null})}
\DoxyCodeLine{02058                 \{}
\DoxyCodeLine{02059                     target.InternalCacheProperties(actorProperties);}
\DoxyCodeLine{02060                     this.InRoomCallbackTargets.OnPlayerPropertiesUpdate(target, actorProperties);}
\DoxyCodeLine{02061                 \}}
\DoxyCodeLine{02062             \}}
\DoxyCodeLine{02063             \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{02064         \}}
\DoxyCodeLine{02065 }
\DoxyCodeLine{02066 }
\DoxyCodeLine{02112         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpSetCustomPropertiesOfRoom(Hashtable propertiesToSet, Hashtable expectedProperties = \textcolor{keyword}{null}, WebFlags webFlags = \textcolor{keyword}{null})}
\DoxyCodeLine{02113         \{}
\DoxyCodeLine{02114             \textcolor{keywordflow}{if} (propertiesToSet == \textcolor{keyword}{null} || propertiesToSet.Count == 0)}
\DoxyCodeLine{02115             \{}
\DoxyCodeLine{02116                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetCustomPropertiesOfRoom() failed. propertiesToSet must not be null nor empty."{}});}
\DoxyCodeLine{02117                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02118             \}}
\DoxyCodeLine{02119             Hashtable customGameProps = \textcolor{keyword}{new} Hashtable();}
\DoxyCodeLine{02120             customGameProps.MergeStringKeys(propertiesToSet);}
\DoxyCodeLine{02121             \textcolor{keywordflow}{if} (customGameProps.Count == 0)}
\DoxyCodeLine{02122             \{}
\DoxyCodeLine{02123                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetCustomPropertiesOfRoom() failed. Only string keys are allowed for custom properties."{}});}
\DoxyCodeLine{02124                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02125             \}}
\DoxyCodeLine{02126             \textcolor{keywordflow}{return} this.OpSetPropertiesOfRoom(customGameProps, expectedProperties, webFlags);}
\DoxyCodeLine{02127         \}}
\DoxyCodeLine{02128 }
\DoxyCodeLine{02129 }
\DoxyCodeLine{02130         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keywordtype}{bool} OpSetPropertyOfRoom(\textcolor{keywordtype}{byte} propCode, \textcolor{keywordtype}{object} value)}
\DoxyCodeLine{02131         \{}
\DoxyCodeLine{02132             Hashtable properties = \textcolor{keyword}{new} Hashtable();}
\DoxyCodeLine{02133             properties[propCode] = value;}
\DoxyCodeLine{02134             \textcolor{keywordflow}{return} this.OpSetPropertiesOfRoom(properties);}
\DoxyCodeLine{02135         \}}
\DoxyCodeLine{02136 }
\DoxyCodeLine{02139         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keywordtype}{bool} OpSetPropertiesOfRoom(Hashtable gameProperties, Hashtable expectedProperties = \textcolor{keyword}{null}, WebFlags webFlags = \textcolor{keyword}{null})}
\DoxyCodeLine{02140         \{}
\DoxyCodeLine{02141             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.SetProperties, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}SetProperties"{}}))}
\DoxyCodeLine{02142             \{}
\DoxyCodeLine{02143                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02144             \}}
\DoxyCodeLine{02145 }
\DoxyCodeLine{02146             \textcolor{keywordflow}{if} (gameProperties == \textcolor{keyword}{null} || gameProperties.Count == 0)}
\DoxyCodeLine{02147             \{}
\DoxyCodeLine{02148                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpSetPropertiesOfRoom() failed. gameProperties must not be null nor empty."{}});}
\DoxyCodeLine{02149                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02150             \}}
\DoxyCodeLine{02151             \textcolor{keywordtype}{bool} res = this.LoadBalancingPeer.OpSetPropertiesOfRoom(gameProperties, expectedProperties, webFlags);}
\DoxyCodeLine{02152             \textcolor{keywordflow}{if} (res \&\& !this.CurrentRoom.BroadcastPropertiesChangeToAll \&\& (expectedProperties == \textcolor{keyword}{null} || expectedProperties.Count == 0))}
\DoxyCodeLine{02153             \{}
\DoxyCodeLine{02154                 this.CurrentRoom.InternalCacheProperties(gameProperties);}
\DoxyCodeLine{02155                 this.InRoomCallbackTargets.OnRoomPropertiesUpdate(gameProperties);}
\DoxyCodeLine{02156             \}}
\DoxyCodeLine{02157             \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{02158         \}}
\DoxyCodeLine{02159 }
\DoxyCodeLine{02160 }
\DoxyCodeLine{02169         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} OpRaiseEvent(\textcolor{keywordtype}{byte} eventCode, \textcolor{keywordtype}{object} customEventContent, RaiseEventOptions raiseEventOptions, SendOptions sendOptions)}
\DoxyCodeLine{02170         \{}
\DoxyCodeLine{02171             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.RaiseEvent, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}RaiseEvent"{}}))}
\DoxyCodeLine{02172             \{}
\DoxyCodeLine{02173                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02174             \}}
\DoxyCodeLine{02175 }
\DoxyCodeLine{02176             \textcolor{keywordflow}{return} this.LoadBalancingPeer.OpRaiseEvent(eventCode, customEventContent, raiseEventOptions, sendOptions);}
\DoxyCodeLine{02177         \}}
\DoxyCodeLine{02178 }
\DoxyCodeLine{02179 }
\DoxyCodeLine{02180 }
\DoxyCodeLine{02195         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} OpChangeGroups(\textcolor{keywordtype}{byte}[] groupsToRemove, \textcolor{keywordtype}{byte}[] groupsToAdd)}
\DoxyCodeLine{02196         \{}
\DoxyCodeLine{02197             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.ChangeGroups, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}ChangeGroups"{}}))}
\DoxyCodeLine{02198             \{}
\DoxyCodeLine{02199                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02200             \}}
\DoxyCodeLine{02201 }
\DoxyCodeLine{02202             \textcolor{keywordflow}{return} this.LoadBalancingPeer.OpChangeGroups(groupsToRemove, groupsToAdd);}
\DoxyCodeLine{02203         \}}
\DoxyCodeLine{02204 }
\DoxyCodeLine{02205 }
\DoxyCodeLine{02206 \textcolor{preprocessor}{        \#endregion}}
\DoxyCodeLine{02207 }
\DoxyCodeLine{02208 \textcolor{preprocessor}{        \#region Helpers}}
\DoxyCodeLine{02209 }
\DoxyCodeLine{02213         \textcolor{keyword}{private} \textcolor{keywordtype}{void} ReadoutProperties(Hashtable gameProperties, Hashtable actorProperties, \textcolor{keywordtype}{int} targetActorNr)}
\DoxyCodeLine{02214         \{}
\DoxyCodeLine{02215             \textcolor{comment}{// read game properties and cache them locally}}
\DoxyCodeLine{02216             \textcolor{keywordflow}{if} (this.CurrentRoom != \textcolor{keyword}{null} \&\& gameProperties != \textcolor{keyword}{null})}
\DoxyCodeLine{02217             \{}
\DoxyCodeLine{02218                 this.CurrentRoom.InternalCacheProperties(gameProperties);}
\DoxyCodeLine{02219                 \textcolor{keywordflow}{if} (this.InRoom)}
\DoxyCodeLine{02220                 \{}
\DoxyCodeLine{02221                     this.InRoomCallbackTargets.OnRoomPropertiesUpdate(gameProperties);}
\DoxyCodeLine{02222                 \}}
\DoxyCodeLine{02223             \}}
\DoxyCodeLine{02224 }
\DoxyCodeLine{02225             \textcolor{keywordflow}{if} (actorProperties != \textcolor{keyword}{null} \&\& actorProperties.Count > 0)}
\DoxyCodeLine{02226             \{}
\DoxyCodeLine{02227                 \textcolor{keywordflow}{if} (targetActorNr > 0)}
\DoxyCodeLine{02228                 \{}
\DoxyCodeLine{02229                     \textcolor{comment}{// we have a single entry in the actorProperties with one user's name}}
\DoxyCodeLine{02230                     \textcolor{comment}{// targets MUST exist before you set properties}}
\DoxyCodeLine{02231                     Player target = this.CurrentRoom.GetPlayer(targetActorNr);}
\DoxyCodeLine{02232                     \textcolor{keywordflow}{if} (target != \textcolor{keyword}{null})}
\DoxyCodeLine{02233                     \{}
\DoxyCodeLine{02234                         Hashtable props = this.ReadoutPropertiesForActorNr(actorProperties, targetActorNr);}
\DoxyCodeLine{02235                         target.InternalCacheProperties(props);}
\DoxyCodeLine{02236                         this.InRoomCallbackTargets.OnPlayerPropertiesUpdate(target, props);}
\DoxyCodeLine{02237                     \}}
\DoxyCodeLine{02238                 \}}
\DoxyCodeLine{02239                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{02240                 \{}
\DoxyCodeLine{02241                     \textcolor{comment}{// in this case, we've got a key-\/value pair per actor (each}}
\DoxyCodeLine{02242                     \textcolor{comment}{// value is a hashtable with the actor's properties then)}}
\DoxyCodeLine{02243                     \textcolor{keywordtype}{int} actorNr;}
\DoxyCodeLine{02244                     Hashtable props;}
\DoxyCodeLine{02245                     \textcolor{keywordtype}{string} newName;}
\DoxyCodeLine{02246                     Player target;}
\DoxyCodeLine{02247 }
\DoxyCodeLine{02248                     \textcolor{keywordflow}{foreach} (\textcolor{keywordtype}{object} key \textcolor{keywordflow}{in} actorProperties.Keys)}
\DoxyCodeLine{02249                     \{}
\DoxyCodeLine{02250                         actorNr = (int)key;}
\DoxyCodeLine{02251                         \textcolor{keywordflow}{if} (actorNr == 0)}
\DoxyCodeLine{02252                         \{}
\DoxyCodeLine{02253                             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02254                         \}}
\DoxyCodeLine{02255 }
\DoxyCodeLine{02256                         props = (Hashtable)actorProperties[key];}
\DoxyCodeLine{02257                         newName = (string)props[ActorProperties.PlayerName];}
\DoxyCodeLine{02258 }
\DoxyCodeLine{02259                         target = \textcolor{keyword}{this}.CurrentRoom.GetPlayer(actorNr);}
\DoxyCodeLine{02260                         \textcolor{keywordflow}{if} (target == \textcolor{keyword}{null})}
\DoxyCodeLine{02261                         \{}
\DoxyCodeLine{02262                             target = this.CreatePlayer(newName, actorNr, \textcolor{keyword}{false}, props);}
\DoxyCodeLine{02263                             this.CurrentRoom.StorePlayer(target);}
\DoxyCodeLine{02264                         \}}
\DoxyCodeLine{02265                         target.InternalCacheProperties(props);}
\DoxyCodeLine{02266                     \}}
\DoxyCodeLine{02267                 \}}
\DoxyCodeLine{02268             \}}
\DoxyCodeLine{02269         \}}
\DoxyCodeLine{02270 }
\DoxyCodeLine{02271 }
\DoxyCodeLine{02275         \textcolor{keyword}{private} Hashtable ReadoutPropertiesForActorNr(Hashtable actorProperties, \textcolor{keywordtype}{int} actorNr)}
\DoxyCodeLine{02276         \{}
\DoxyCodeLine{02277             \textcolor{keywordflow}{if} (actorProperties.ContainsKey(actorNr))}
\DoxyCodeLine{02278             \{}
\DoxyCodeLine{02279                 \textcolor{keywordflow}{return} (Hashtable)actorProperties[actorNr];}
\DoxyCodeLine{02280             \}}
\DoxyCodeLine{02281 }
\DoxyCodeLine{02282             \textcolor{keywordflow}{return} actorProperties;}
\DoxyCodeLine{02283         \}}
\DoxyCodeLine{02284 }
\DoxyCodeLine{02289         \textcolor{keyword}{public} \textcolor{keywordtype}{void} ChangeLocalID(\textcolor{keywordtype}{int} newID)}
\DoxyCodeLine{02290         \{}
\DoxyCodeLine{02291             \textcolor{keywordflow}{if} (this.LocalPlayer == \textcolor{keyword}{null})}
\DoxyCodeLine{02292             \{}
\DoxyCodeLine{02293                 this.DebugReturn(DebugLevel.WARNING, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Local actor is null or not in mActors! mLocalActor: \{0\} mActors==null: \{1\} newID: \{2\}"{}}, \textcolor{keyword}{this}.LocalPlayer, \textcolor{keyword}{this}.CurrentRoom.Players == \textcolor{keyword}{null}, newID));}
\DoxyCodeLine{02294             \}}
\DoxyCodeLine{02295 }
\DoxyCodeLine{02296             \textcolor{keywordflow}{if} (this.CurrentRoom == \textcolor{keyword}{null})}
\DoxyCodeLine{02297             \{}
\DoxyCodeLine{02298                 \textcolor{comment}{// change to new actor/player ID and make sure the player does not have a room reference left}}
\DoxyCodeLine{02299                 this.LocalPlayer.ChangeLocalID(newID);}
\DoxyCodeLine{02300                 this.LocalPlayer.RoomReference = \textcolor{keyword}{null};}
\DoxyCodeLine{02301             \}}
\DoxyCodeLine{02302             \textcolor{keywordflow}{else}}
\DoxyCodeLine{02303             \{}
\DoxyCodeLine{02304                 \textcolor{comment}{// remove old actorId from actor list}}
\DoxyCodeLine{02305                 this.CurrentRoom.RemovePlayer(this.LocalPlayer);}
\DoxyCodeLine{02306 }
\DoxyCodeLine{02307                 \textcolor{comment}{// change to new actor/player ID}}
\DoxyCodeLine{02308                 this.LocalPlayer.ChangeLocalID(newID);}
\DoxyCodeLine{02309 }
\DoxyCodeLine{02310                 \textcolor{comment}{// update the room's list with the new reference}}
\DoxyCodeLine{02311                 this.CurrentRoom.StorePlayer(this.LocalPlayer);}
\DoxyCodeLine{02312             \}}
\DoxyCodeLine{02313         \}}
\DoxyCodeLine{02314 }
\DoxyCodeLine{02315 }
\DoxyCodeLine{02316 }
\DoxyCodeLine{02325         \textcolor{keyword}{private} \textcolor{keywordtype}{void} GameEnteredOnGameServer(OperationResponse operationResponse)}
\DoxyCodeLine{02326         \{}
\DoxyCodeLine{02327             this.CurrentRoom = this.CreateRoom(this.enterRoomParamsCache.RoomName, \textcolor{keyword}{this}.enterRoomParamsCache.RoomOptions);}
\DoxyCodeLine{02328             this.CurrentRoom.LoadBalancingClient = \textcolor{keyword}{this};}
\DoxyCodeLine{02329 }
\DoxyCodeLine{02330             \textcolor{comment}{// first change the local id, instead of first updating the actorList since actorList uses ID to update itself}}
\DoxyCodeLine{02331 }
\DoxyCodeLine{02332             \textcolor{comment}{// the local player's actor-\/properties are not returned in join-\/result. add this player to the list}}
\DoxyCodeLine{02333             \textcolor{keywordtype}{int} localActorNr = (int)operationResponse[ParameterCode.ActorNr];}
\DoxyCodeLine{02334             \textcolor{keyword}{this}.ChangeLocalID(localActorNr);}
\DoxyCodeLine{02335 }
\DoxyCodeLine{02336             \textcolor{keywordflow}{if} (operationResponse.Parameters.ContainsKey(ParameterCode.ActorList))}
\DoxyCodeLine{02337             \{}
\DoxyCodeLine{02338                 \textcolor{keywordtype}{int}[] actorsInRoom = (\textcolor{keywordtype}{int}[])operationResponse.Parameters[ParameterCode.ActorList];}
\DoxyCodeLine{02339                 \textcolor{keyword}{this}.UpdatedActorList(actorsInRoom);}
\DoxyCodeLine{02340             \}}
\DoxyCodeLine{02341 }
\DoxyCodeLine{02342 }
\DoxyCodeLine{02343             Hashtable actorProperties = (Hashtable)operationResponse[ParameterCode.PlayerProperties];}
\DoxyCodeLine{02344             Hashtable gameProperties = (Hashtable)operationResponse[ParameterCode.GameProperties];}
\DoxyCodeLine{02345             this.ReadoutProperties(gameProperties, actorProperties, 0);}
\DoxyCodeLine{02346 }
\DoxyCodeLine{02347             \textcolor{keywordtype}{object} temp;}
\DoxyCodeLine{02348             \textcolor{keywordflow}{if} (operationResponse.Parameters.TryGetValue(ParameterCode.RoomOptionFlags, out temp))}
\DoxyCodeLine{02349             \{}
\DoxyCodeLine{02350                 this.CurrentRoom.InternalCacheRoomFlags((\textcolor{keywordtype}{int})temp);}
\DoxyCodeLine{02351             \}}
\DoxyCodeLine{02352 }
\DoxyCodeLine{02353             this.State = ClientState.Joined;}
\DoxyCodeLine{02354 }
\DoxyCodeLine{02355 }
\DoxyCodeLine{02356             \textcolor{comment}{// the callbacks OnCreatedRoom and OnJoinedRoom are called in the event join. it contains important info about the room and players.}}
\DoxyCodeLine{02357             \textcolor{comment}{// unless there will be no room events (RoomOptions.SuppressRoomEvents = true)}}
\DoxyCodeLine{02358             \textcolor{keywordflow}{if} (this.CurrentRoom.SuppressRoomEvents)}
\DoxyCodeLine{02359             \{}
\DoxyCodeLine{02360                 \textcolor{keywordflow}{if} (this.lastJoinType == JoinType.CreateRoom || (\textcolor{keyword}{this}.lastJoinType == JoinType.JoinOrCreateRoom \&\& \textcolor{keyword}{this}.LocalPlayer.ActorNumber == 1))}
\DoxyCodeLine{02361                 \{}
\DoxyCodeLine{02362                     this.MatchMakingCallbackTargets.OnCreatedRoom();}
\DoxyCodeLine{02363                 \}}
\DoxyCodeLine{02364 }
\DoxyCodeLine{02365                 this.MatchMakingCallbackTargets.OnJoinedRoom();}
\DoxyCodeLine{02366             \}}
\DoxyCodeLine{02367         \}}
\DoxyCodeLine{02368 }
\DoxyCodeLine{02369 }
\DoxyCodeLine{02370         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdatedActorList(\textcolor{keywordtype}{int}[] actorsInGame)}
\DoxyCodeLine{02371         \{}
\DoxyCodeLine{02372             \textcolor{keywordflow}{if} (actorsInGame != \textcolor{keyword}{null})}
\DoxyCodeLine{02373             \{}
\DoxyCodeLine{02374                 \textcolor{keywordflow}{foreach} (\textcolor{keywordtype}{int} actorNumber \textcolor{keywordflow}{in} actorsInGame)}
\DoxyCodeLine{02375                 \{}
\DoxyCodeLine{02376                     \textcolor{keywordflow}{if} (actorNumber == 0)}
\DoxyCodeLine{02377                     \{}
\DoxyCodeLine{02378                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02379                     \}}
\DoxyCodeLine{02380 }
\DoxyCodeLine{02381                     Player target = this.CurrentRoom.GetPlayer(actorNumber);}
\DoxyCodeLine{02382                     \textcolor{keywordflow}{if} (target == \textcolor{keyword}{null})}
\DoxyCodeLine{02383                     \{}
\DoxyCodeLine{02384                         this.CurrentRoom.StorePlayer(this.CreatePlayer(\textcolor{keywordtype}{string}.Empty, actorNumber, \textcolor{keyword}{false}, \textcolor{keyword}{null}));}
\DoxyCodeLine{02385                     \}}
\DoxyCodeLine{02386                 \}}
\DoxyCodeLine{02387             \}}
\DoxyCodeLine{02388         \}}
\DoxyCodeLine{02389 }
\DoxyCodeLine{02398         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keyword}{virtual} Player CreatePlayer(\textcolor{keywordtype}{string} actorName, \textcolor{keywordtype}{int} actorNumber, \textcolor{keywordtype}{bool} isLocal, Hashtable actorProperties)}
\DoxyCodeLine{02399         \{}
\DoxyCodeLine{02400             Player newPlayer = \textcolor{keyword}{new} Player(actorName, actorNumber, isLocal, actorProperties);}
\DoxyCodeLine{02401             \textcolor{keywordflow}{return} newPlayer;}
\DoxyCodeLine{02402         \}}
\DoxyCodeLine{02403 }
\DoxyCodeLine{02405         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keyword}{virtual} Room CreateRoom(\textcolor{keywordtype}{string} roomName, RoomOptions opt)}
\DoxyCodeLine{02406         \{}
\DoxyCodeLine{02407             Room r = \textcolor{keyword}{new} Room(roomName, opt);}
\DoxyCodeLine{02408             \textcolor{keywordflow}{return} r;}
\DoxyCodeLine{02409         \}}
\DoxyCodeLine{02410 }
\DoxyCodeLine{02411         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} CheckIfOpAllowedOnServer(\textcolor{keywordtype}{byte} opCode, ServerConnection serverConnection)}
\DoxyCodeLine{02412         \{}
\DoxyCodeLine{02413             \textcolor{keywordflow}{switch} (serverConnection)}
\DoxyCodeLine{02414             \{}
\DoxyCodeLine{02415                 \textcolor{keywordflow}{case} ServerConnection.MasterServer:}
\DoxyCodeLine{02416                     \textcolor{keywordflow}{switch} (opCode)}
\DoxyCodeLine{02417                     \{}
\DoxyCodeLine{02418                         \textcolor{keywordflow}{case} OperationCode.CreateGame:}
\DoxyCodeLine{02419                         \textcolor{keywordflow}{case} OperationCode.Authenticate:}
\DoxyCodeLine{02420                         \textcolor{keywordflow}{case} OperationCode.AuthenticateOnce:}
\DoxyCodeLine{02421                         \textcolor{keywordflow}{case} OperationCode.FindFriends:}
\DoxyCodeLine{02422                         \textcolor{keywordflow}{case} OperationCode.GetGameList:}
\DoxyCodeLine{02423                         \textcolor{keywordflow}{case} OperationCode.GetLobbyStats:}
\DoxyCodeLine{02424                         \textcolor{keywordflow}{case} OperationCode.JoinGame:}
\DoxyCodeLine{02425                         \textcolor{keywordflow}{case} OperationCode.JoinLobby:}
\DoxyCodeLine{02426                         \textcolor{keywordflow}{case} OperationCode.LeaveLobby:}
\DoxyCodeLine{02427                         \textcolor{keywordflow}{case} OperationCode.WebRpc:}
\DoxyCodeLine{02428                         \textcolor{keywordflow}{case} OperationCode.ServerSettings:}
\DoxyCodeLine{02429                         \textcolor{keywordflow}{case} OperationCode.JoinRandomGame:}
\DoxyCodeLine{02430                             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02431                     \}}
\DoxyCodeLine{02432                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02433                 \textcolor{keywordflow}{case} ServerConnection.GameServer:}
\DoxyCodeLine{02434                     \textcolor{keywordflow}{switch} (opCode)}
\DoxyCodeLine{02435                     \{}
\DoxyCodeLine{02436                         \textcolor{keywordflow}{case} OperationCode.CreateGame:}
\DoxyCodeLine{02437                         \textcolor{keywordflow}{case} OperationCode.Authenticate:}
\DoxyCodeLine{02438                         \textcolor{keywordflow}{case} OperationCode.AuthenticateOnce:}
\DoxyCodeLine{02439                         \textcolor{keywordflow}{case} OperationCode.ChangeGroups:}
\DoxyCodeLine{02440                         \textcolor{keywordflow}{case} OperationCode.GetProperties:}
\DoxyCodeLine{02441                         \textcolor{keywordflow}{case} OperationCode.JoinGame:}
\DoxyCodeLine{02442                         \textcolor{keywordflow}{case} OperationCode.Leave:}
\DoxyCodeLine{02443                         \textcolor{keywordflow}{case} OperationCode.WebRpc:}
\DoxyCodeLine{02444                         \textcolor{keywordflow}{case} OperationCode.ServerSettings:}
\DoxyCodeLine{02445                         \textcolor{keywordflow}{case} OperationCode.SetProperties:}
\DoxyCodeLine{02446                         \textcolor{keywordflow}{case} OperationCode.RaiseEvent:}
\DoxyCodeLine{02447                             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02448                     \}}
\DoxyCodeLine{02449                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02450                 \textcolor{keywordflow}{case} ServerConnection.NameServer:}
\DoxyCodeLine{02451                     \textcolor{keywordflow}{switch} (opCode)}
\DoxyCodeLine{02452                     \{}
\DoxyCodeLine{02453                         \textcolor{keywordflow}{case} OperationCode.Authenticate:}
\DoxyCodeLine{02454                         \textcolor{keywordflow}{case} OperationCode.AuthenticateOnce:}
\DoxyCodeLine{02455                         \textcolor{keywordflow}{case} OperationCode.GetRegions:}
\DoxyCodeLine{02456                         \textcolor{keywordflow}{case} OperationCode.ServerSettings:}
\DoxyCodeLine{02457                             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02458                     \}}
\DoxyCodeLine{02459                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02460                 \textcolor{keywordflow}{default}:}
\DoxyCodeLine{02461                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException(\textcolor{stringliteral}{"{}serverConnection"{}}, serverConnection, \textcolor{keyword}{null});}
\DoxyCodeLine{02462             \}}
\DoxyCodeLine{02463             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02464         \}}
\DoxyCodeLine{02465 }
\DoxyCodeLine{02466         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} CheckIfOpCanBeSent(\textcolor{keywordtype}{byte} opCode, ServerConnection serverConnection, \textcolor{keywordtype}{string} opName)}
\DoxyCodeLine{02467         \{}
\DoxyCodeLine{02468             \textcolor{keywordflow}{if} (this.LoadBalancingPeer == \textcolor{keyword}{null})}
\DoxyCodeLine{02469             \{}
\DoxyCodeLine{02470                 this.DebugReturn(DebugLevel.ERROR, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Operation \{0\} (\{1\}) can't be sent because peer is null"{}}, opName, opCode));}
\DoxyCodeLine{02471                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02472             \}}
\DoxyCodeLine{02473 }
\DoxyCodeLine{02474             \textcolor{keywordflow}{if} (!this.CheckIfOpAllowedOnServer(opCode, serverConnection))}
\DoxyCodeLine{02475             \{}
\DoxyCodeLine{02476                 \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= DebugLevel.ERROR)}
\DoxyCodeLine{02477                 \{}
\DoxyCodeLine{02478                     this.DebugReturn(DebugLevel.ERROR, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Operation \{0\} (\{1\}) not allowed on current server (\{2\})"{}}, opName, opCode, serverConnection));}
\DoxyCodeLine{02479                 \}}
\DoxyCodeLine{02480                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02481             \}}
\DoxyCodeLine{02482 }
\DoxyCodeLine{02483             \textcolor{keywordflow}{if} (!this.CheckIfClientIsReadyToCallOperation(opCode))}
\DoxyCodeLine{02484             \{}
\DoxyCodeLine{02485                 DebugLevel levelToReport = DebugLevel.ERROR;}
\DoxyCodeLine{02486                 \textcolor{keywordflow}{if} (opCode == OperationCode.RaiseEvent \&\& (\textcolor{keyword}{this}.State == ClientState.Leaving || \textcolor{keyword}{this}.State == ClientState.Disconnecting || \textcolor{keyword}{this}.State == ClientState.DisconnectingFromGameServer))}
\DoxyCodeLine{02487                 \{}
\DoxyCodeLine{02488                     levelToReport = DebugLevel.INFO;}
\DoxyCodeLine{02489                 \}}
\DoxyCodeLine{02490 }
\DoxyCodeLine{02491                 \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= levelToReport)}
\DoxyCodeLine{02492                 \{}
\DoxyCodeLine{02493                     this.DebugReturn(levelToReport, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Operation \{0\} (\{1\}) not called because client is not connected or not ready yet, client state: \{2\}"{}}, opName, opCode, Enum.GetName(typeof(ClientState), this.State)));}
\DoxyCodeLine{02494                 \}}
\DoxyCodeLine{02495 }
\DoxyCodeLine{02496                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02497             \}}
\DoxyCodeLine{02498 }
\DoxyCodeLine{02499             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.PeerState != PeerStateValue.Connected)}
\DoxyCodeLine{02500             \{}
\DoxyCodeLine{02501                 this.DebugReturn(DebugLevel.ERROR, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Operation \{0\} (\{1\}) can't be sent because peer is not connected, peer state: \{2\}"{}}, opName, opCode, \textcolor{keyword}{this}.LoadBalancingPeer.PeerState));}
\DoxyCodeLine{02502                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{02503             \}}
\DoxyCodeLine{02504             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{02505         \}}
\DoxyCodeLine{02506 }
\DoxyCodeLine{02507         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} CheckIfClientIsReadyToCallOperation(\textcolor{keywordtype}{byte} opCode)}
\DoxyCodeLine{02508         \{}
\DoxyCodeLine{02509             \textcolor{keywordflow}{switch} (opCode)}
\DoxyCodeLine{02510             \{}
\DoxyCodeLine{02511                 \textcolor{comment}{//case OperationCode.ServerSettings: // ??}}
\DoxyCodeLine{02512                 \textcolor{comment}{//case OperationCode.WebRpc: // WebRPC works on MS and GS and I think it does not need the client to be ready}}
\DoxyCodeLine{02513 }
\DoxyCodeLine{02514                 \textcolor{keywordflow}{case} OperationCode.Authenticate:}
\DoxyCodeLine{02515                 \textcolor{keywordflow}{case} OperationCode.AuthenticateOnce:}
\DoxyCodeLine{02516                     \textcolor{keywordflow}{return} this.IsConnectedAndReady ||}
\DoxyCodeLine{02517                          this.State == ClientState.ConnectingToNameServer || \textcolor{comment}{// this is required since we do not set state to ConnectedToNameServer before authentication}}
\DoxyCodeLine{02518                         this.State == ClientState.ConnectingToMasterServer || \textcolor{comment}{// this is required since we do not set state to ConnectedToMasterServer before authentication}}
\DoxyCodeLine{02519                         this.State == ClientState.ConnectingToGameServer; \textcolor{comment}{// this is required since we do not set state to ConnectedToGameServer before authentication}}
\DoxyCodeLine{02520 }
\DoxyCodeLine{02521                 \textcolor{keywordflow}{case} OperationCode.ChangeGroups:}
\DoxyCodeLine{02522                 \textcolor{keywordflow}{case} OperationCode.GetProperties:}
\DoxyCodeLine{02523                 \textcolor{keywordflow}{case} OperationCode.SetProperties:}
\DoxyCodeLine{02524                 \textcolor{keywordflow}{case} OperationCode.RaiseEvent:}
\DoxyCodeLine{02525                 \textcolor{keywordflow}{case} OperationCode.Leave:}
\DoxyCodeLine{02526                     \textcolor{keywordflow}{return} this.InRoom;}
\DoxyCodeLine{02527 }
\DoxyCodeLine{02528                 \textcolor{keywordflow}{case} OperationCode.JoinGame:}
\DoxyCodeLine{02529                 \textcolor{keywordflow}{case} OperationCode.CreateGame:}
\DoxyCodeLine{02530                     \textcolor{keywordflow}{return} this.State == ClientState.ConnectedToMasterServer || this.InLobby || this.State == ClientState.ConnectedToGameServer; \textcolor{comment}{// CurrentRoom can be not null in case of quick rejoin}}
\DoxyCodeLine{02531 }
\DoxyCodeLine{02532                 \textcolor{keywordflow}{case} OperationCode.LeaveLobby:}
\DoxyCodeLine{02533                     \textcolor{keywordflow}{return} this.InLobby;}
\DoxyCodeLine{02534 }
\DoxyCodeLine{02535                 \textcolor{keywordflow}{case} OperationCode.JoinRandomGame:}
\DoxyCodeLine{02536                 \textcolor{keywordflow}{case} OperationCode.FindFriends:}
\DoxyCodeLine{02537                 \textcolor{keywordflow}{case} OperationCode.GetGameList:}
\DoxyCodeLine{02538                 \textcolor{keywordflow}{case} OperationCode.GetLobbyStats: \textcolor{comment}{// do we need to be inside lobby to call this?}}
\DoxyCodeLine{02539                 \textcolor{keywordflow}{case} OperationCode.JoinLobby: \textcolor{comment}{// You don't have to explicitly leave a lobby to join another (client can be in one max, at any time)}}
\DoxyCodeLine{02540                     \textcolor{keywordflow}{return} this.State == ClientState.ConnectedToMasterServer || this.InLobby;}
\DoxyCodeLine{02541                 \textcolor{keywordflow}{case} OperationCode.GetRegions:}
\DoxyCodeLine{02542                     \textcolor{keywordflow}{return} this.State == ClientState.ConnectedToNameServer;}
\DoxyCodeLine{02543             \}}
\DoxyCodeLine{02544             \textcolor{keywordflow}{return} this.IsConnected;}
\DoxyCodeLine{02545         \}}
\DoxyCodeLine{02546 }
\DoxyCodeLine{02547 \textcolor{preprocessor}{        \#endregion}}
\DoxyCodeLine{02548 }
\DoxyCodeLine{02549 \textcolor{preprocessor}{        \#region Implementation of IPhotonPeerListener}}
\DoxyCodeLine{02550 }
\DoxyCodeLine{02553         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} DebugReturn(DebugLevel level, \textcolor{keywordtype}{string} message)}
\DoxyCodeLine{02554         \{}
\DoxyCodeLine{02555             \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut != DebugLevel.ALL \&\& level > \textcolor{keyword}{this}.LoadBalancingPeer.DebugOut)}
\DoxyCodeLine{02556             \{}
\DoxyCodeLine{02557                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{02558             \}}
\DoxyCodeLine{02559 \textcolor{preprocessor}{            \#if !SUPPORTED\_UNITY}}
\DoxyCodeLine{02560             Debug.WriteLine(message);}
\DoxyCodeLine{02561 \textcolor{preprocessor}{            \#else}}
\DoxyCodeLine{02562             \textcolor{keywordflow}{if} (level == DebugLevel.ERROR)}
\DoxyCodeLine{02563             \{}
\DoxyCodeLine{02564                 Debug.LogError(message);}
\DoxyCodeLine{02565             \}}
\DoxyCodeLine{02566             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (level == DebugLevel.WARNING)}
\DoxyCodeLine{02567             \{}
\DoxyCodeLine{02568                 Debug.LogWarning(message);}
\DoxyCodeLine{02569             \}}
\DoxyCodeLine{02570             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (level == DebugLevel.INFO)}
\DoxyCodeLine{02571             \{}
\DoxyCodeLine{02572                 Debug.Log(message);}
\DoxyCodeLine{02573             \}}
\DoxyCodeLine{02574             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (level == DebugLevel.ALL)}
\DoxyCodeLine{02575             \{}
\DoxyCodeLine{02576                 Debug.Log(message);}
\DoxyCodeLine{02577             \}}
\DoxyCodeLine{02578 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{02579         \}}
\DoxyCodeLine{02580 }
\DoxyCodeLine{02581         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CallbackRoomEnterFailed(OperationResponse operationResponse)}
\DoxyCodeLine{02582         \{}
\DoxyCodeLine{02583             \textcolor{keywordflow}{if} (operationResponse.ReturnCode != 0)}
\DoxyCodeLine{02584             \{}
\DoxyCodeLine{02585                 \textcolor{keywordflow}{if} (operationResponse.OperationCode == OperationCode.JoinGame)}
\DoxyCodeLine{02586                 \{}
\DoxyCodeLine{02587                     this.MatchMakingCallbackTargets.OnJoinRoomFailed(operationResponse.ReturnCode, operationResponse.DebugMessage);}
\DoxyCodeLine{02588                 \}}
\DoxyCodeLine{02589                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (operationResponse.OperationCode == OperationCode.CreateGame)}
\DoxyCodeLine{02590                 \{}
\DoxyCodeLine{02591                     this.MatchMakingCallbackTargets.OnCreateRoomFailed(operationResponse.ReturnCode, operationResponse.DebugMessage);}
\DoxyCodeLine{02592                 \}}
\DoxyCodeLine{02593                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (operationResponse.OperationCode == OperationCode.JoinRandomGame)}
\DoxyCodeLine{02594                 \{}
\DoxyCodeLine{02595                     this.MatchMakingCallbackTargets.OnJoinRandomFailed(operationResponse.ReturnCode, operationResponse.DebugMessage);}
\DoxyCodeLine{02596                 \}}
\DoxyCodeLine{02597             \}}
\DoxyCodeLine{02598         \}}
\DoxyCodeLine{02599 }
\DoxyCodeLine{02614         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnOperationResponse(OperationResponse operationResponse)}
\DoxyCodeLine{02615         \{}
\DoxyCodeLine{02616             \textcolor{comment}{// if (operationResponse.ReturnCode != 0) this.DebugReturn(DebugLevel.ERROR, operationResponse.ToStringFull());}}
\DoxyCodeLine{02617 }
\DoxyCodeLine{02618             \textcolor{comment}{// use the "{}secret"{} or "{}token"{} whenever we get it. doesn't really matter if it's in AuthResponse.}}
\DoxyCodeLine{02619             \textcolor{keywordflow}{if} (operationResponse.Parameters.ContainsKey(ParameterCode.Token))}
\DoxyCodeLine{02620             \{}
\DoxyCodeLine{02621                 \textcolor{keywordflow}{if} (this.AuthValues == \textcolor{keyword}{null})}
\DoxyCodeLine{02622                 \{}
\DoxyCodeLine{02623                     this.AuthValues = \textcolor{keyword}{new} AuthenticationValues();}
\DoxyCodeLine{02624                     \textcolor{comment}{//this.DebugReturn(DebugLevel.ERROR, "{}Server returned secret. Created AuthValues."{});}}
\DoxyCodeLine{02625                 \}}
\DoxyCodeLine{02626 }
\DoxyCodeLine{02627                 this.AuthValues.Token = operationResponse[ParameterCode.Token] as string;}
\DoxyCodeLine{02628                 this.tokenCache = this.AuthValues.Token;}
\DoxyCodeLine{02629             \}}
\DoxyCodeLine{02630 }
\DoxyCodeLine{02631             \textcolor{comment}{// if the operation limit was reached, disconnect (but still execute the operation response).}}
\DoxyCodeLine{02632             \textcolor{keywordflow}{if} (operationResponse.ReturnCode == ErrorCode.OperationLimitReached)}
\DoxyCodeLine{02633             \{}
\DoxyCodeLine{02634                 this.Disconnect(DisconnectCause.DisconnectByOperationLimit);}
\DoxyCodeLine{02635             \}}
\DoxyCodeLine{02636 }
\DoxyCodeLine{02637             \textcolor{keywordflow}{switch} (operationResponse.OperationCode)}
\DoxyCodeLine{02638             \{}
\DoxyCodeLine{02639                 \textcolor{keywordflow}{case} OperationCode.Authenticate:}
\DoxyCodeLine{02640                 \textcolor{keywordflow}{case} OperationCode.AuthenticateOnce:}
\DoxyCodeLine{02641                     \{}
\DoxyCodeLine{02642                         \textcolor{keywordflow}{if} (operationResponse.ReturnCode != 0)}
\DoxyCodeLine{02643                         \{}
\DoxyCodeLine{02644                             this.DebugReturn(DebugLevel.ERROR, operationResponse.ToStringFull() + \textcolor{stringliteral}{"{} Server: "{}} + \textcolor{keyword}{this}.Server + \textcolor{stringliteral}{"{} Address: "{}} + \textcolor{keyword}{this}.LoadBalancingPeer.ServerAddress);}
\DoxyCodeLine{02645 }
\DoxyCodeLine{02646                             \textcolor{keywordflow}{switch} (operationResponse.ReturnCode)}
\DoxyCodeLine{02647                             \{}
\DoxyCodeLine{02648                                 \textcolor{keywordflow}{case} ErrorCode.InvalidAuthentication:}
\DoxyCodeLine{02649                                     this.DisconnectedCause = DisconnectCause.InvalidAuthentication;}
\DoxyCodeLine{02650                                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02651                                 \textcolor{keywordflow}{case} ErrorCode.CustomAuthenticationFailed:}
\DoxyCodeLine{02652                                     this.DisconnectedCause = DisconnectCause.CustomAuthenticationFailed;}
\DoxyCodeLine{02653                                     this.ConnectionCallbackTargets.OnCustomAuthenticationFailed(operationResponse.DebugMessage);}
\DoxyCodeLine{02654                                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02655                                 \textcolor{keywordflow}{case} ErrorCode.InvalidRegion:}
\DoxyCodeLine{02656                                     this.DisconnectedCause = DisconnectCause.InvalidRegion;}
\DoxyCodeLine{02657                                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02658                                 \textcolor{keywordflow}{case} ErrorCode.MaxCcuReached:}
\DoxyCodeLine{02659                                     this.DisconnectedCause = DisconnectCause.MaxCcuReached;}
\DoxyCodeLine{02660                                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02661                                 \textcolor{keywordflow}{case} ErrorCode.InvalidOperation:}
\DoxyCodeLine{02662                                 \textcolor{keywordflow}{case} ErrorCode.OperationNotAllowedInCurrentState:}
\DoxyCodeLine{02663                                     this.DisconnectedCause = DisconnectCause.OperationNotAllowedInCurrentState;}
\DoxyCodeLine{02664                                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02665                                 \textcolor{keywordflow}{case} ErrorCode.AuthenticationTicketExpired:}
\DoxyCodeLine{02666                                     this.DisconnectedCause = DisconnectCause.AuthenticationTicketExpired;}
\DoxyCodeLine{02667                                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02668                             \}}
\DoxyCodeLine{02669 }
\DoxyCodeLine{02670                             this.Disconnect(this.DisconnectedCause);}
\DoxyCodeLine{02671                             \textcolor{keywordflow}{break};  \textcolor{comment}{// if auth didn't succeed, we disconnect (above) and exit this operation's handling}}
\DoxyCodeLine{02672                         \}}
\DoxyCodeLine{02673 }
\DoxyCodeLine{02674                         \textcolor{keywordflow}{if} (this.Server == ServerConnection.NameServer || \textcolor{keyword}{this}.Server == ServerConnection.MasterServer)}
\DoxyCodeLine{02675                         \{}
\DoxyCodeLine{02676                             \textcolor{keywordflow}{if} (operationResponse.Parameters.ContainsKey(ParameterCode.UserId))}
\DoxyCodeLine{02677                             \{}
\DoxyCodeLine{02678                                 \textcolor{keywordtype}{string} incomingId = (string)operationResponse.Parameters[ParameterCode.UserId];}
\DoxyCodeLine{02679                                 if (!\textcolor{keywordtype}{string}.IsNullOrEmpty(incomingId))}
\DoxyCodeLine{02680                                 \{}
\DoxyCodeLine{02681                                     this.UserId = incomingId;}
\DoxyCodeLine{02682                                     this.LocalPlayer.UserId = incomingId;}
\DoxyCodeLine{02683                                     this.DebugReturn(DebugLevel.INFO, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Received your UserID from server. Updating local value to: \{0\}"{}}, \textcolor{keyword}{this}.UserId));}
\DoxyCodeLine{02684                                 \}}
\DoxyCodeLine{02685                             \}}
\DoxyCodeLine{02686                             \textcolor{keywordflow}{if} (operationResponse.Parameters.ContainsKey(ParameterCode.NickName))}
\DoxyCodeLine{02687                             \{}
\DoxyCodeLine{02688                                 this.NickName = (string)operationResponse.Parameters[ParameterCode.NickName];}
\DoxyCodeLine{02689                                 \textcolor{keyword}{this}.DebugReturn(DebugLevel.INFO, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Received your NickName from server. Updating local value to: \{0\}"{}}, \textcolor{keyword}{this}.NickName));}
\DoxyCodeLine{02690                             \}}
\DoxyCodeLine{02691 }
\DoxyCodeLine{02692                             \textcolor{keywordflow}{if} (operationResponse.Parameters.ContainsKey(ParameterCode.EncryptionData))}
\DoxyCodeLine{02693                             \{}
\DoxyCodeLine{02694                                 this.SetupEncryption((Dictionary<byte, object>)operationResponse.Parameters[ParameterCode.EncryptionData]);}
\DoxyCodeLine{02695                             \}}
\DoxyCodeLine{02696                         \}}
\DoxyCodeLine{02697 }
\DoxyCodeLine{02698                         \textcolor{keywordflow}{if} (this.Server == ServerConnection.NameServer)}
\DoxyCodeLine{02699                         \{}
\DoxyCodeLine{02700                             \textcolor{keywordtype}{string} receivedCluster = operationResponse[ParameterCode.Cluster] as string;}
\DoxyCodeLine{02701                             \textcolor{keywordflow}{if} (!\textcolor{keywordtype}{string}.IsNullOrEmpty(receivedCluster))}
\DoxyCodeLine{02702                             \{}
\DoxyCodeLine{02703                                 this.CurrentCluster = receivedCluster;}
\DoxyCodeLine{02704                             \}}
\DoxyCodeLine{02705 }
\DoxyCodeLine{02706                             \textcolor{comment}{// on the NameServer, authenticate returns the MasterServer address for a region and we hop off to there}}
\DoxyCodeLine{02707                             this.MasterServerAddress = operationResponse[ParameterCode.Address] as string;}
\DoxyCodeLine{02708                             \textcolor{keywordflow}{if} (this.ServerPortOverrides.MasterServerPort != 0)}
\DoxyCodeLine{02709                             \{}
\DoxyCodeLine{02710                                 \textcolor{comment}{//Debug.LogWarning("{}Incoming MasterServer Address: "{}+this.MasterServerAddress);}}
\DoxyCodeLine{02711                                 this.MasterServerAddress = ReplacePortWithAlternative(this.MasterServerAddress, this.ServerPortOverrides.MasterServerPort);}
\DoxyCodeLine{02712                                 \textcolor{comment}{//Debug.LogWarning("{}New MasterServer Address: "{}+this.MasterServerAddress);}}
\DoxyCodeLine{02713                             \}}
\DoxyCodeLine{02714 }
\DoxyCodeLine{02715                             \textcolor{keywordflow}{if} (this.AuthMode == AuthModeOption.AuthOnceWss \&\& \textcolor{keyword}{this}.ExpectedProtocol != \textcolor{keyword}{null})}
\DoxyCodeLine{02716                             \{}
\DoxyCodeLine{02717                                 this.DebugReturn(DebugLevel.INFO, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}AuthOnceWss mode. Auth response switches TransportProtocol to ExpectedProtocol: \{0\}."{}}, \textcolor{keyword}{this}.ExpectedProtocol));}
\DoxyCodeLine{02718                                 this.LoadBalancingPeer.TransportProtocol = (ConnectionProtocol)this.ExpectedProtocol;}
\DoxyCodeLine{02719                                 this.ExpectedProtocol = \textcolor{keyword}{null};}
\DoxyCodeLine{02720                             \}}
\DoxyCodeLine{02721                             this.DisconnectToReconnect();}
\DoxyCodeLine{02722                         \}}
\DoxyCodeLine{02723                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (this.Server == ServerConnection.MasterServer)}
\DoxyCodeLine{02724                         \{}
\DoxyCodeLine{02725                             this.State = ClientState.ConnectedToMasterServer;}
\DoxyCodeLine{02726                             \textcolor{keywordflow}{if} (this.failedRoomEntryOperation == \textcolor{keyword}{null})}
\DoxyCodeLine{02727                             \{}
\DoxyCodeLine{02728                                 this.ConnectionCallbackTargets.OnConnectedToMaster();}
\DoxyCodeLine{02729                             \}}
\DoxyCodeLine{02730                             \textcolor{keywordflow}{else}}
\DoxyCodeLine{02731                             \{}
\DoxyCodeLine{02732                                 this.CallbackRoomEnterFailed(this.failedRoomEntryOperation);}
\DoxyCodeLine{02733                                 this.failedRoomEntryOperation = \textcolor{keyword}{null};}
\DoxyCodeLine{02734                             \}}
\DoxyCodeLine{02735 }
\DoxyCodeLine{02736                             \textcolor{keywordflow}{if} (this.AuthMode != AuthModeOption.Auth)}
\DoxyCodeLine{02737                             \{}
\DoxyCodeLine{02738                                 this.LoadBalancingPeer.OpSettings(this.EnableLobbyStatistics);}
\DoxyCodeLine{02739                             \}}
\DoxyCodeLine{02740                         \}}
\DoxyCodeLine{02741                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (this.Server == ServerConnection.GameServer)}
\DoxyCodeLine{02742                         \{}
\DoxyCodeLine{02743                             this.State = ClientState.Joining;}
\DoxyCodeLine{02744 }
\DoxyCodeLine{02745                             \textcolor{keywordflow}{if} (this.enterRoomParamsCache.JoinMode == JoinMode.RejoinOnly)}
\DoxyCodeLine{02746                             \{}
\DoxyCodeLine{02747                                 this.enterRoomParamsCache.PlayerProperties = \textcolor{keyword}{null};}
\DoxyCodeLine{02748                             \}}
\DoxyCodeLine{02749                             \textcolor{keywordflow}{else}}
\DoxyCodeLine{02750                             \{}
\DoxyCodeLine{02751                                 Hashtable allProps = \textcolor{keyword}{new} Hashtable();}
\DoxyCodeLine{02752                                 allProps.Merge(this.LocalPlayer.CustomProperties);}
\DoxyCodeLine{02753 }
\DoxyCodeLine{02754                                 \textcolor{keywordflow}{if} (!\textcolor{keywordtype}{string}.IsNullOrEmpty(this.LocalPlayer.NickName))}
\DoxyCodeLine{02755                                 \{}
\DoxyCodeLine{02756                                     allProps[ActorProperties.PlayerName] = this.LocalPlayer.NickName;}
\DoxyCodeLine{02757                                 \}}
\DoxyCodeLine{02758 }
\DoxyCodeLine{02759                                 this.enterRoomParamsCache.PlayerProperties = allProps;}
\DoxyCodeLine{02760                             \}}
\DoxyCodeLine{02761 }
\DoxyCodeLine{02762                             this.enterRoomParamsCache.OnGameServer = \textcolor{keyword}{true};}
\DoxyCodeLine{02763 }
\DoxyCodeLine{02764                             \textcolor{keywordflow}{if} (this.lastJoinType == JoinType.JoinRoom || \textcolor{keyword}{this}.lastJoinType == JoinType.JoinRandomRoom  || \textcolor{keyword}{this}.lastJoinType == JoinType.JoinRandomOrCreateRoom || \textcolor{keyword}{this}.lastJoinType == JoinType.JoinOrCreateRoom)}
\DoxyCodeLine{02765                             \{}
\DoxyCodeLine{02766                                 this.LoadBalancingPeer.OpJoinRoom(this.enterRoomParamsCache);}
\DoxyCodeLine{02767                             \}}
\DoxyCodeLine{02768                             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (this.lastJoinType == JoinType.CreateRoom)}
\DoxyCodeLine{02769                             \{}
\DoxyCodeLine{02770                                 this.LoadBalancingPeer.OpCreateRoom(this.enterRoomParamsCache);}
\DoxyCodeLine{02771                             \}}
\DoxyCodeLine{02772                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{02773                         \}}
\DoxyCodeLine{02774 }
\DoxyCodeLine{02775                         \textcolor{comment}{// optionally, OpAuth may return some data for the client to use. if it's available, call OnCustomAuthenticationResponse}}
\DoxyCodeLine{02776                         Dictionary<string, object> data = (Dictionary<string, object>)operationResponse[ParameterCode.Data];}
\DoxyCodeLine{02777                         if (data != \textcolor{keyword}{null})}
\DoxyCodeLine{02778                         \{}
\DoxyCodeLine{02779                             this.ConnectionCallbackTargets.OnCustomAuthenticationResponse(data);}
\DoxyCodeLine{02780                         \}}
\DoxyCodeLine{02781                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{02782                     \}}
\DoxyCodeLine{02783 }
\DoxyCodeLine{02784                 \textcolor{keywordflow}{case} OperationCode.GetRegions:}
\DoxyCodeLine{02785                     \textcolor{comment}{// Debug.Log("{}GetRegions returned: "{} + operationResponse.ToStringFull());}}
\DoxyCodeLine{02786 }
\DoxyCodeLine{02787                     \textcolor{keywordflow}{if} (operationResponse.ReturnCode == ErrorCode.InvalidAuthentication)}
\DoxyCodeLine{02788                     \{}
\DoxyCodeLine{02789                         this.DebugReturn(DebugLevel.ERROR, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}GetRegions failed. AppId is unknown on the (cloud) server. "{}}+operationResponse.DebugMessage));}
\DoxyCodeLine{02790                         this.Disconnect(DisconnectCause.InvalidAuthentication);}
\DoxyCodeLine{02791                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{02792                     \}}
\DoxyCodeLine{02793                     \textcolor{keywordflow}{if} (operationResponse.ReturnCode != ErrorCode.Ok)}
\DoxyCodeLine{02794                     \{}
\DoxyCodeLine{02795                         this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}GetRegions failed. Can't provide regions list. ReturnCode: "{}} + operationResponse.ReturnCode + \textcolor{stringliteral}{"{}: "{}} + operationResponse.DebugMessage);}
\DoxyCodeLine{02796                         this.Disconnect(DisconnectCause.InvalidAuthentication);}
\DoxyCodeLine{02797                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{02798                     \}}
\DoxyCodeLine{02799                     \textcolor{keywordflow}{if} (this.RegionHandler == \textcolor{keyword}{null})}
\DoxyCodeLine{02800                     \{}
\DoxyCodeLine{02801                         this.RegionHandler = \textcolor{keyword}{new} RegionHandler(this.ServerPortOverrides.MasterServerPort);}
\DoxyCodeLine{02802                     \}}
\DoxyCodeLine{02803 }
\DoxyCodeLine{02804                     \textcolor{keywordflow}{if} (this.RegionHandler.IsPinging)}
\DoxyCodeLine{02805                     \{}
\DoxyCodeLine{02806                         this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}Received an response for OpGetRegions while the RegionHandler is pinging regions already. Skipping this response in favor of completing the current region-\/pinging."{}});}
\DoxyCodeLine{02807                         \textcolor{keywordflow}{return}; \textcolor{comment}{// in this particular case, we suppress the duplicate GetRegion response. we don't want a callback for this, cause there is a warning already.}}
\DoxyCodeLine{02808                     \}}
\DoxyCodeLine{02809 }
\DoxyCodeLine{02810                     this.RegionHandler.SetRegions(operationResponse);}
\DoxyCodeLine{02811                     this.ConnectionCallbackTargets.OnRegionListReceived(this.RegionHandler);}
\DoxyCodeLine{02812 }
\DoxyCodeLine{02813                     \textcolor{keywordflow}{if} (this.connectToBestRegion)}
\DoxyCodeLine{02814                     \{}
\DoxyCodeLine{02815                         \textcolor{comment}{// ping minimal regions (if one is known) and connect}}
\DoxyCodeLine{02816                         this.RegionHandler.PingMinimumOfRegions(this.OnRegionPingCompleted, this.bestRegionSummaryFromStorage);}
\DoxyCodeLine{02817                     \}}
\DoxyCodeLine{02818                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02819 }
\DoxyCodeLine{02820                 \textcolor{keywordflow}{case} OperationCode.JoinRandomGame:  \textcolor{comment}{// this happens only on the master server. on gameserver this is a "{}regular"{} join}}
\DoxyCodeLine{02821                 \textcolor{keywordflow}{case} OperationCode.CreateGame:}
\DoxyCodeLine{02822                 \textcolor{keywordflow}{case} OperationCode.JoinGame:}
\DoxyCodeLine{02823 }
\DoxyCodeLine{02824                     \textcolor{keywordflow}{if} (operationResponse.ReturnCode != 0)}
\DoxyCodeLine{02825                     \{}
\DoxyCodeLine{02826                         \textcolor{keywordflow}{if} (this.Server == ServerConnection.GameServer)}
\DoxyCodeLine{02827                         \{}
\DoxyCodeLine{02828                             this.failedRoomEntryOperation = operationResponse;}
\DoxyCodeLine{02829                             this.DisconnectToReconnect();}
\DoxyCodeLine{02830                         \}}
\DoxyCodeLine{02831                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{02832                         \{}
\DoxyCodeLine{02833                             this.State = (this.InLobby) ? ClientState.JoinedLobby : ClientState.ConnectedToMasterServer;}
\DoxyCodeLine{02834                             \textcolor{keyword}{this}.CallbackRoomEnterFailed(operationResponse);}
\DoxyCodeLine{02835                         \}}
\DoxyCodeLine{02836                     \}}
\DoxyCodeLine{02837                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{02838                     \{}
\DoxyCodeLine{02839                         \textcolor{keywordflow}{if} (this.Server == ServerConnection.GameServer)}
\DoxyCodeLine{02840                         \{}
\DoxyCodeLine{02841                             this.GameEnteredOnGameServer(operationResponse);}
\DoxyCodeLine{02842                         \}}
\DoxyCodeLine{02843                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{02844                         \{}
\DoxyCodeLine{02845                             this.GameServerAddress = (string)operationResponse[ParameterCode.Address];}
\DoxyCodeLine{02846                             if (this.ServerPortOverrides.GameServerPort != 0)}
\DoxyCodeLine{02847                             \{}
\DoxyCodeLine{02848                                 \textcolor{comment}{//Debug.LogWarning("{}Incoming GameServer Address: "{} + this.GameServerAddress);}}
\DoxyCodeLine{02849                                 this.GameServerAddress = ReplacePortWithAlternative(this.GameServerAddress, this.ServerPortOverrides.GameServerPort);}
\DoxyCodeLine{02850                                 \textcolor{comment}{//Debug.LogWarning("{}New GameServer Address: "{} + this.GameServerAddress);}}
\DoxyCodeLine{02851                             \}}
\DoxyCodeLine{02852 }
\DoxyCodeLine{02853                             \textcolor{keywordtype}{string} roomName = operationResponse[ParameterCode.RoomName] as string;}
\DoxyCodeLine{02854                             \textcolor{keywordflow}{if} (!\textcolor{keywordtype}{string}.IsNullOrEmpty(roomName))}
\DoxyCodeLine{02855                             \{}
\DoxyCodeLine{02856                                 this.enterRoomParamsCache.RoomName = roomName;}
\DoxyCodeLine{02857                             \}}
\DoxyCodeLine{02858 }
\DoxyCodeLine{02859                             this.DisconnectToReconnect();}
\DoxyCodeLine{02860                         \}}
\DoxyCodeLine{02861                     \}}
\DoxyCodeLine{02862                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02863 }
\DoxyCodeLine{02864                 \textcolor{keywordflow}{case} OperationCode.GetGameList:}
\DoxyCodeLine{02865                     \textcolor{keywordflow}{if} (operationResponse.ReturnCode != 0)}
\DoxyCodeLine{02866                     \{}
\DoxyCodeLine{02867                         this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}GetGameList failed: "{}} + operationResponse.ToStringFull());}
\DoxyCodeLine{02868                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{02869                     \}}
\DoxyCodeLine{02870 }
\DoxyCodeLine{02871                     List<RoomInfo> \_RoomInfoList = \textcolor{keyword}{new} List<RoomInfo>();}
\DoxyCodeLine{02872 }
\DoxyCodeLine{02873                     Hashtable games = (Hashtable)operationResponse[ParameterCode.GameList];}
\DoxyCodeLine{02874                     foreach (\textcolor{keywordtype}{string} gameName in games.Keys)}
\DoxyCodeLine{02875                     \{}
\DoxyCodeLine{02876                         \_RoomInfoList.Add(\textcolor{keyword}{new} RoomInfo(gameName, (Hashtable)games[gameName]));}
\DoxyCodeLine{02877                     \}}
\DoxyCodeLine{02878 }
\DoxyCodeLine{02879                     this.LobbyCallbackTargets.OnRoomListUpdate(\_RoomInfoList);}
\DoxyCodeLine{02880                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02881 }
\DoxyCodeLine{02882                 \textcolor{keywordflow}{case} OperationCode.JoinLobby:}
\DoxyCodeLine{02883                     this.State = ClientState.JoinedLobby;}
\DoxyCodeLine{02884                     this.LobbyCallbackTargets.OnJoinedLobby();}
\DoxyCodeLine{02885                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02886 }
\DoxyCodeLine{02887                 \textcolor{keywordflow}{case} OperationCode.LeaveLobby:}
\DoxyCodeLine{02888                     this.State = ClientState.ConnectedToMasterServer;}
\DoxyCodeLine{02889                     this.LobbyCallbackTargets.OnLeftLobby();}
\DoxyCodeLine{02890                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02891 }
\DoxyCodeLine{02892                 \textcolor{keywordflow}{case} OperationCode.Leave:}
\DoxyCodeLine{02893                     this.DisconnectToReconnect();}
\DoxyCodeLine{02894                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02895 }
\DoxyCodeLine{02896                 \textcolor{keywordflow}{case} OperationCode.FindFriends:}
\DoxyCodeLine{02897                     \textcolor{keywordflow}{if} (operationResponse.ReturnCode != 0)}
\DoxyCodeLine{02898                     \{}
\DoxyCodeLine{02899                         this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpFindFriends failed: "{}} + operationResponse.ToStringFull());}
\DoxyCodeLine{02900                         this.friendListRequested = \textcolor{keyword}{null};}
\DoxyCodeLine{02901                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{02902                     \}}
\DoxyCodeLine{02903 }
\DoxyCodeLine{02904                     \textcolor{keywordtype}{bool}[] onlineList = operationResponse[ParameterCode.FindFriendsResponseOnlineList] as \textcolor{keywordtype}{bool}[];}
\DoxyCodeLine{02905                     \textcolor{keywordtype}{string}[] roomList = operationResponse[ParameterCode.FindFriendsResponseRoomIdList] as \textcolor{keywordtype}{string}[];}
\DoxyCodeLine{02906 }
\DoxyCodeLine{02907                     \textcolor{comment}{//if (onlineList == null || roomList == null || this.friendListRequested == null || onlineList.Length != this.friendListRequested.Length)}}
\DoxyCodeLine{02908                     \textcolor{comment}{//\{}}
\DoxyCodeLine{02909                     \textcolor{comment}{//    // TODO: Check if we should handle this case better / more extensively}}
\DoxyCodeLine{02910                     \textcolor{comment}{//    this.DebugReturn(DebugLevel.ERROR, "{}OpFindFriends failed. Some list is not set. OpResponse: "{} + operationResponse.ToStringFull());}}
\DoxyCodeLine{02911                     \textcolor{comment}{//    this.friendListRequested = null;}}
\DoxyCodeLine{02912                     \textcolor{comment}{//    this.isFetchingFriendList = false;}}
\DoxyCodeLine{02913                     \textcolor{comment}{//    break;}}
\DoxyCodeLine{02914                     \textcolor{comment}{//\}}}
\DoxyCodeLine{02915 }
\DoxyCodeLine{02916                     List<FriendInfo> friendList = \textcolor{keyword}{new} List<FriendInfo>(this.friendListRequested.Length);}
\DoxyCodeLine{02917                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < this.friendListRequested.Length; index++)}
\DoxyCodeLine{02918                     \{}
\DoxyCodeLine{02919                         FriendInfo \textcolor{keyword}{friend} = \textcolor{keyword}{new} FriendInfo();}
\DoxyCodeLine{02920                         \textcolor{keyword}{friend}.UserId = this.friendListRequested[index];}
\DoxyCodeLine{02921                         \textcolor{keyword}{friend}.Room = roomList[index];}
\DoxyCodeLine{02922                         \textcolor{keyword}{friend}.IsOnline = onlineList[index];}
\DoxyCodeLine{02923                         friendList.Insert(index, \textcolor{keyword}{friend});}
\DoxyCodeLine{02924                     \}}
\DoxyCodeLine{02925 }
\DoxyCodeLine{02926                     this.friendListRequested = \textcolor{keyword}{null};}
\DoxyCodeLine{02927 }
\DoxyCodeLine{02928                     this.MatchMakingCallbackTargets.OnFriendListUpdate(friendList);}
\DoxyCodeLine{02929                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02930 }
\DoxyCodeLine{02931                 \textcolor{keywordflow}{case} OperationCode.WebRpc:}
\DoxyCodeLine{02932                     this.WebRpcCallbackTargets.OnWebRpcResponse(operationResponse);}
\DoxyCodeLine{02933                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02934             \}}
\DoxyCodeLine{02935 }
\DoxyCodeLine{02936             \textcolor{keywordflow}{if} (this.OpResponseReceived != \textcolor{keyword}{null}) this.OpResponseReceived(operationResponse);}
\DoxyCodeLine{02937         \}}
\DoxyCodeLine{02938 }
\DoxyCodeLine{02943         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnStatusChanged(StatusCode statusCode)}
\DoxyCodeLine{02944         \{}
\DoxyCodeLine{02945             \textcolor{keywordflow}{switch} (statusCode)}
\DoxyCodeLine{02946             \{}
\DoxyCodeLine{02947                 \textcolor{keywordflow}{case} StatusCode.Connect:}
\DoxyCodeLine{02948                     \textcolor{keywordflow}{if} (this.State == ClientState.ConnectingToNameServer)}
\DoxyCodeLine{02949                     \{}
\DoxyCodeLine{02950                         \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= DebugLevel.ALL)}
\DoxyCodeLine{02951                         \{}
\DoxyCodeLine{02952                             this.DebugReturn(DebugLevel.ALL, \textcolor{stringliteral}{"{}Connected to nameserver."{}});}
\DoxyCodeLine{02953                         \}}
\DoxyCodeLine{02954 }
\DoxyCodeLine{02955                         this.Server = ServerConnection.NameServer;}
\DoxyCodeLine{02956                         \textcolor{keywordflow}{if} (this.AuthValues != \textcolor{keyword}{null})}
\DoxyCodeLine{02957                         \{}
\DoxyCodeLine{02958                             this.AuthValues.Token = \textcolor{keyword}{null}; \textcolor{comment}{// when connecting to NameServer, invalidate the secret (only)}}
\DoxyCodeLine{02959                         \}}
\DoxyCodeLine{02960                     \}}
\DoxyCodeLine{02961 }
\DoxyCodeLine{02962                     \textcolor{keywordflow}{if} (this.State == ClientState.ConnectingToGameServer)}
\DoxyCodeLine{02963                     \{}
\DoxyCodeLine{02964                         \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= DebugLevel.ALL)}
\DoxyCodeLine{02965                         \{}
\DoxyCodeLine{02966                             this.DebugReturn(DebugLevel.ALL, \textcolor{stringliteral}{"{}Connected to gameserver."{}});}
\DoxyCodeLine{02967                         \}}
\DoxyCodeLine{02968 }
\DoxyCodeLine{02969                         this.Server = ServerConnection.GameServer;}
\DoxyCodeLine{02970                     \}}
\DoxyCodeLine{02971 }
\DoxyCodeLine{02972                     \textcolor{keywordflow}{if} (this.State == ClientState.ConnectingToMasterServer)}
\DoxyCodeLine{02973                     \{}
\DoxyCodeLine{02974                         \textcolor{keywordflow}{if} (this.LoadBalancingPeer.DebugOut >= DebugLevel.ALL)}
\DoxyCodeLine{02975                         \{}
\DoxyCodeLine{02976                             this.DebugReturn(DebugLevel.ALL, \textcolor{stringliteral}{"{}Connected to masterserver."{}});}
\DoxyCodeLine{02977                         \}}
\DoxyCodeLine{02978 }
\DoxyCodeLine{02979                         this.Server = ServerConnection.MasterServer;}
\DoxyCodeLine{02980                         this.ConnectionCallbackTargets.OnConnected(); \textcolor{comment}{// if initial connect}}
\DoxyCodeLine{02981                     \}}
\DoxyCodeLine{02982 }
\DoxyCodeLine{02983 }
\DoxyCodeLine{02984                     \textcolor{keywordflow}{if} (this.LoadBalancingPeer.TransportProtocol != ConnectionProtocol.WebSocketSecure)}
\DoxyCodeLine{02985                     \{}
\DoxyCodeLine{02986                         \textcolor{keywordflow}{if} (this.Server == ServerConnection.NameServer || \textcolor{keyword}{this}.AuthMode == AuthModeOption.Auth)}
\DoxyCodeLine{02987                         \{}
\DoxyCodeLine{02988                             this.LoadBalancingPeer.EstablishEncryption();}
\DoxyCodeLine{02989                         \}}
\DoxyCodeLine{02990                     \}}
\DoxyCodeLine{02991                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{02992                     \{}
\DoxyCodeLine{02993                         \textcolor{keywordflow}{goto} \textcolor{keywordflow}{case} StatusCode.EncryptionEstablished;}
\DoxyCodeLine{02994                     \}}
\DoxyCodeLine{02995 }
\DoxyCodeLine{02996                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{02997 }
\DoxyCodeLine{02998                 \textcolor{keywordflow}{case} StatusCode.EncryptionEstablished:}
\DoxyCodeLine{02999                     \textcolor{keywordflow}{if} (this.Server == ServerConnection.NameServer)}
\DoxyCodeLine{03000                     \{}
\DoxyCodeLine{03001                         this.State = ClientState.ConnectedToNameServer;}
\DoxyCodeLine{03002 }
\DoxyCodeLine{03003                         \textcolor{comment}{// if there is no specific region to connect to, get available regions from the Name Server. the result triggers next actions in workflow}}
\DoxyCodeLine{03004                         \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(this.CloudRegion))}
\DoxyCodeLine{03005                         \{}
\DoxyCodeLine{03006                             this.OpGetRegions();}
\DoxyCodeLine{03007                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03008                         \}}
\DoxyCodeLine{03009                     \}}
\DoxyCodeLine{03010                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03011                     \{}
\DoxyCodeLine{03012                         \textcolor{comment}{// auth AuthOnce, no explicit authentication is needed on Master Server and Game Server. this is done via token, so: break}}
\DoxyCodeLine{03013                         \textcolor{keywordflow}{if} (this.AuthMode == AuthModeOption.AuthOnce || \textcolor{keyword}{this}.AuthMode == AuthModeOption.AuthOnceWss)}
\DoxyCodeLine{03014                         \{}
\DoxyCodeLine{03015                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03016                         \}}
\DoxyCodeLine{03017                     \}}
\DoxyCodeLine{03018 }
\DoxyCodeLine{03019                     \textcolor{comment}{// authenticate in all other cases (using the CloudRegion, if available)}}
\DoxyCodeLine{03020                     \textcolor{keywordtype}{bool} authenticating = this.CallAuthenticate();}
\DoxyCodeLine{03021                     \textcolor{keywordflow}{if} (authenticating)}
\DoxyCodeLine{03022                     \{}
\DoxyCodeLine{03023                         this.State = ClientState.Authenticating;}
\DoxyCodeLine{03024                     \}}
\DoxyCodeLine{03025                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03026                     \{}
\DoxyCodeLine{03027                         this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}OpAuthenticate failed. Check log output and AuthValues. State: "{}} + \textcolor{keyword}{this}.State);}
\DoxyCodeLine{03028                     \}}
\DoxyCodeLine{03029                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03030 }
\DoxyCodeLine{03031                 \textcolor{keywordflow}{case} StatusCode.Disconnect:}
\DoxyCodeLine{03032                     \textcolor{comment}{// disconnect due to connection exception is handled below (don't connect to GS or master in that case)}}
\DoxyCodeLine{03033                     this.friendListRequested = \textcolor{keyword}{null};}
\DoxyCodeLine{03034 }
\DoxyCodeLine{03035                     \textcolor{keywordtype}{bool} wasInRoom = this.CurrentRoom != \textcolor{keyword}{null};}
\DoxyCodeLine{03036                     this.CurrentRoom = \textcolor{keyword}{null};    \textcolor{comment}{// players get cleaned up inside this, too, except LocalPlayer (which we keep)}}
\DoxyCodeLine{03037                     this.ChangeLocalID(-\/1);     \textcolor{comment}{// depends on this.CurrentRoom, so it must be called after updating that}}
\DoxyCodeLine{03038 }
\DoxyCodeLine{03039                     \textcolor{keywordflow}{if} (this.Server == ServerConnection.GameServer \&\& wasInRoom)}
\DoxyCodeLine{03040                     \{}
\DoxyCodeLine{03041                         this.MatchMakingCallbackTargets.OnLeftRoom();}
\DoxyCodeLine{03042                     \}}
\DoxyCodeLine{03043 }
\DoxyCodeLine{03044                     \textcolor{keywordflow}{if} (this.ExpectedProtocol != \textcolor{keyword}{null} \&\& this.LoadBalancingPeer.TransportProtocol != \textcolor{keyword}{this}.ExpectedProtocol)}
\DoxyCodeLine{03045                     \{}
\DoxyCodeLine{03046                         this.DebugReturn(DebugLevel.INFO, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}On disconnect switches TransportProtocol to ExpectedProtocol: \{0\}."{}}, \textcolor{keyword}{this}.ExpectedProtocol));}
\DoxyCodeLine{03047                         this.LoadBalancingPeer.TransportProtocol = (ConnectionProtocol)this.ExpectedProtocol;}
\DoxyCodeLine{03048                         this.ExpectedProtocol = \textcolor{keyword}{null};}
\DoxyCodeLine{03049                     \}}
\DoxyCodeLine{03050 }
\DoxyCodeLine{03051                     \textcolor{keywordflow}{switch} (this.State)}
\DoxyCodeLine{03052                     \{}
\DoxyCodeLine{03053                         \textcolor{keywordflow}{case} ClientState.ConnectWithFallbackProtocol:}
\DoxyCodeLine{03054                             this.EnableProtocolFallback = \textcolor{keyword}{false};    \textcolor{comment}{// the client does a fallback only one time}}
\DoxyCodeLine{03055                             this.LoadBalancingPeer.TransportProtocol = (this.LoadBalancingPeer.TransportProtocol == ConnectionProtocol.Tcp) ? ConnectionProtocol.Udp : ConnectionProtocol.Tcp;}
\DoxyCodeLine{03056                             \textcolor{keyword}{this}.NameServerPortInAppSettings = 0;                   \textcolor{comment}{// this does not affect the ServerSettings file, just a variable at runtime}}
\DoxyCodeLine{03057                             \textcolor{keyword}{this}.ServerPortOverrides = \textcolor{keyword}{new} PhotonPortDefinition();  \textcolor{comment}{// use default ports for the fallback}}
\DoxyCodeLine{03058 }
\DoxyCodeLine{03059                             \textcolor{keywordflow}{if} (!this.LoadBalancingPeer.Connect(\textcolor{keyword}{this}.NameServerAddress, \textcolor{keyword}{this}.ProxyServerAddress, \textcolor{keyword}{this}.AppId, \textcolor{keyword}{this}.TokenForInit))}
\DoxyCodeLine{03060                             \{}
\DoxyCodeLine{03061                                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{03062                             \}}
\DoxyCodeLine{03063                             this.State = ClientState.ConnectingToNameServer;}
\DoxyCodeLine{03064                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03065                         \textcolor{keywordflow}{case} ClientState.PeerCreated:}
\DoxyCodeLine{03066                         \textcolor{keywordflow}{case} ClientState.Disconnecting:}
\DoxyCodeLine{03067                             \textcolor{keywordflow}{if} (this.AuthValues != \textcolor{keyword}{null})}
\DoxyCodeLine{03068                             \{}
\DoxyCodeLine{03069                                 this.AuthValues.Token = \textcolor{keyword}{null}; \textcolor{comment}{// when leaving the server, invalidate the secret (but not the auth values)}}
\DoxyCodeLine{03070                             \}}
\DoxyCodeLine{03071                             this.State = ClientState.Disconnected;}
\DoxyCodeLine{03072                             this.ConnectionCallbackTargets.OnDisconnected(this.DisconnectedCause);}
\DoxyCodeLine{03073                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03074 }
\DoxyCodeLine{03075                         \textcolor{keywordflow}{case} ClientState.DisconnectingFromGameServer:}
\DoxyCodeLine{03076                         \textcolor{keywordflow}{case} ClientState.DisconnectingFromNameServer:}
\DoxyCodeLine{03077                             this.ConnectToMasterServer();                 \textcolor{comment}{// this gets the client back to the Master Server}}
\DoxyCodeLine{03078                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03079 }
\DoxyCodeLine{03080                         \textcolor{keywordflow}{case} ClientState.DisconnectingFromMasterServer:}
\DoxyCodeLine{03081                             this.Connect(this.GameServerAddress, this.ProxyServerAddress, ServerConnection.GameServer);     \textcolor{comment}{// this connects the client with the Game Server (when joining/creating a room)}}
\DoxyCodeLine{03082                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03083 }
\DoxyCodeLine{03084                         \textcolor{keywordflow}{case} ClientState.Disconnected:}
\DoxyCodeLine{03085                             \textcolor{comment}{// this client is already Disconnected, so no further action is needed.}}
\DoxyCodeLine{03086                             \textcolor{comment}{// this.DebugReturn(DebugLevel.INFO, "{}LBC.OnStatusChanged(Disconnect) this.State: "{} + this.State + "{}. Server: "{} + this.Server);}}
\DoxyCodeLine{03087                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03088 }
\DoxyCodeLine{03089                         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{03090                             \textcolor{keywordtype}{string} stacktrace = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{03091 \textcolor{preprocessor}{                            \#if DEBUG \&\& !NETFX\_CORE}}
\DoxyCodeLine{03092                             stacktrace = \textcolor{keyword}{new} System.Diagnostics.StackTrace(\textcolor{keyword}{true}).ToString();}
\DoxyCodeLine{03093 \textcolor{preprocessor}{                            \#endif}}
\DoxyCodeLine{03094                             this.DebugReturn(DebugLevel.WARNING, \textcolor{stringliteral}{"{}Got a unexpected Disconnect in LoadBalancingClient State: "{}} + \textcolor{keyword}{this}.State + \textcolor{stringliteral}{"{}. Server: "{}} + \textcolor{keyword}{this}.Server + \textcolor{stringliteral}{"{} Trace: "{}} + stacktrace);}
\DoxyCodeLine{03095 }
\DoxyCodeLine{03096                             \textcolor{keywordflow}{if} (this.AuthValues != \textcolor{keyword}{null})}
\DoxyCodeLine{03097                             \{}
\DoxyCodeLine{03098                                 this.AuthValues.Token = \textcolor{keyword}{null}; \textcolor{comment}{// when leaving the server, invalidate the secret (but not the auth values)}}
\DoxyCodeLine{03099                             \}}
\DoxyCodeLine{03100                             this.State = ClientState.Disconnected;}
\DoxyCodeLine{03101                             this.ConnectionCallbackTargets.OnDisconnected(this.DisconnectedCause);}
\DoxyCodeLine{03102                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{03103                     \}}
\DoxyCodeLine{03104                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03105 }
\DoxyCodeLine{03106                 \textcolor{keywordflow}{case} StatusCode.DisconnectByServerUserLimit:}
\DoxyCodeLine{03107                     this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}This connection was rejected due to the apps CCU limit."{}});}
\DoxyCodeLine{03108                     this.DisconnectedCause = DisconnectCause.MaxCcuReached;}
\DoxyCodeLine{03109                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03110                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03111                 \textcolor{keywordflow}{case} StatusCode.DnsExceptionOnConnect:}
\DoxyCodeLine{03112                     this.DisconnectedCause = DisconnectCause.DnsExceptionOnConnect;}
\DoxyCodeLine{03113                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03114                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03115                 \textcolor{keywordflow}{case} StatusCode.ServerAddressInvalid:}
\DoxyCodeLine{03116                     this.DisconnectedCause = DisconnectCause.ServerAddressInvalid;}
\DoxyCodeLine{03117                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03118                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03119                 \textcolor{keywordflow}{case} StatusCode.ExceptionOnConnect:}
\DoxyCodeLine{03120                 \textcolor{keywordflow}{case} StatusCode.SecurityExceptionOnConnect:}
\DoxyCodeLine{03121                 \textcolor{keywordflow}{case} StatusCode.EncryptionFailedToEstablish:}
\DoxyCodeLine{03122                     this.DisconnectedCause = DisconnectCause.ExceptionOnConnect;}
\DoxyCodeLine{03123 }
\DoxyCodeLine{03124                     \textcolor{comment}{// if enabled, the client can attempt to connect with another networking-\/protocol to check if that connects}}
\DoxyCodeLine{03125                     \textcolor{keywordflow}{if} (this.EnableProtocolFallback \&\& this.State == ClientState.ConnectingToNameServer)}
\DoxyCodeLine{03126                     \{}
\DoxyCodeLine{03127                         this.State = ClientState.ConnectWithFallbackProtocol;}
\DoxyCodeLine{03128                     \}}
\DoxyCodeLine{03129                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03130                     \{}
\DoxyCodeLine{03131                         this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03132                     \}}
\DoxyCodeLine{03133                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03134                 \textcolor{keywordflow}{case} StatusCode.Exception:}
\DoxyCodeLine{03135                 \textcolor{keywordflow}{case} StatusCode.ExceptionOnReceive:}
\DoxyCodeLine{03136                 \textcolor{keywordflow}{case} StatusCode.SendError:}
\DoxyCodeLine{03137                     this.DisconnectedCause = DisconnectCause.Exception;}
\DoxyCodeLine{03138                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03139                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03140                 \textcolor{keywordflow}{case} StatusCode.DisconnectByServerTimeout:}
\DoxyCodeLine{03141                     this.DisconnectedCause = DisconnectCause.ServerTimeout;}
\DoxyCodeLine{03142                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03143                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03144                 \textcolor{keywordflow}{case} StatusCode.DisconnectByServerLogic:}
\DoxyCodeLine{03145                     this.DisconnectedCause = DisconnectCause.DisconnectByServerLogic;}
\DoxyCodeLine{03146                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03147                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03148                 \textcolor{keywordflow}{case} StatusCode.DisconnectByServerReasonUnknown:}
\DoxyCodeLine{03149                     this.DisconnectedCause = DisconnectCause.DisconnectByServerReasonUnknown;}
\DoxyCodeLine{03150                     this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03151                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03152                 \textcolor{keywordflow}{case} StatusCode.TimeoutDisconnect:}
\DoxyCodeLine{03153                     this.DisconnectedCause = DisconnectCause.ClientTimeout;}
\DoxyCodeLine{03154 }
\DoxyCodeLine{03155                     \textcolor{comment}{// if enabled, the client can attempt to connect with another networking-\/protocol to check if that connects}}
\DoxyCodeLine{03156                     \textcolor{keywordflow}{if} (this.EnableProtocolFallback \&\& this.State == ClientState.ConnectingToNameServer)}
\DoxyCodeLine{03157                     \{}
\DoxyCodeLine{03158                         this.State = ClientState.ConnectWithFallbackProtocol;}
\DoxyCodeLine{03159                     \}}
\DoxyCodeLine{03160                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03161                     \{}
\DoxyCodeLine{03162                         this.State = ClientState.Disconnecting;}
\DoxyCodeLine{03163                     \}}
\DoxyCodeLine{03164                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03165             \}}
\DoxyCodeLine{03166         \}}
\DoxyCodeLine{03167 }
\DoxyCodeLine{03168 }
\DoxyCodeLine{03173         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnEvent(EventData photonEvent)}
\DoxyCodeLine{03174         \{}
\DoxyCodeLine{03175             \textcolor{keywordtype}{int} actorNr = photonEvent.Sender;}
\DoxyCodeLine{03176             Player originatingPlayer = (this.CurrentRoom != \textcolor{keyword}{null}) ? this.CurrentRoom.GetPlayer(actorNr) : \textcolor{keyword}{null};}
\DoxyCodeLine{03177 }
\DoxyCodeLine{03178             \textcolor{keywordflow}{switch} (photonEvent.Code)}
\DoxyCodeLine{03179             \{}
\DoxyCodeLine{03180                 \textcolor{keywordflow}{case} EventCode.GameList:}
\DoxyCodeLine{03181                 \textcolor{keywordflow}{case} EventCode.GameListUpdate:}
\DoxyCodeLine{03182                     List<RoomInfo> \_RoomInfoList = \textcolor{keyword}{new} List<RoomInfo>();}
\DoxyCodeLine{03183 }
\DoxyCodeLine{03184                     Hashtable games = (Hashtable)photonEvent[ParameterCode.GameList];}
\DoxyCodeLine{03185                     foreach (\textcolor{keywordtype}{string} gameName in games.Keys)}
\DoxyCodeLine{03186                     \{}
\DoxyCodeLine{03187                         \_RoomInfoList.Add(\textcolor{keyword}{new} RoomInfo(gameName, (Hashtable)games[gameName]));}
\DoxyCodeLine{03188                     \}}
\DoxyCodeLine{03189 }
\DoxyCodeLine{03190                     this.LobbyCallbackTargets.OnRoomListUpdate(\_RoomInfoList);}
\DoxyCodeLine{03191 }
\DoxyCodeLine{03192                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03193 }
\DoxyCodeLine{03194                 \textcolor{keywordflow}{case} EventCode.Join:}
\DoxyCodeLine{03195                     Hashtable actorProperties = (Hashtable)photonEvent[ParameterCode.PlayerProperties];}
\DoxyCodeLine{03196 }
\DoxyCodeLine{03197                     if (originatingPlayer == \textcolor{keyword}{null})}
\DoxyCodeLine{03198                     \{}
\DoxyCodeLine{03199                         \textcolor{keywordflow}{if} (actorNr > 0)}
\DoxyCodeLine{03200                         \{}
\DoxyCodeLine{03201                             originatingPlayer = this.CreatePlayer(\textcolor{keywordtype}{string}.Empty, actorNr, \textcolor{keyword}{false}, actorProperties);}
\DoxyCodeLine{03202                             this.CurrentRoom.StorePlayer(originatingPlayer);}
\DoxyCodeLine{03203                         \}}
\DoxyCodeLine{03204                     \}}
\DoxyCodeLine{03205                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03206                     \{}
\DoxyCodeLine{03207                         originatingPlayer.InternalCacheProperties(actorProperties);}
\DoxyCodeLine{03208                         originatingPlayer.IsInactive = \textcolor{keyword}{false};}
\DoxyCodeLine{03209                         originatingPlayer.HasRejoined = actorNr != this.LocalPlayer.ActorNumber;    \textcolor{comment}{// event is for non-\/local player, who is known (by ActorNumber), so it's a returning player}}
\DoxyCodeLine{03210                     \}}
\DoxyCodeLine{03211 }
\DoxyCodeLine{03212                     \textcolor{keywordflow}{if} (actorNr == this.LocalPlayer.ActorNumber)}
\DoxyCodeLine{03213                     \{}
\DoxyCodeLine{03214                         \textcolor{comment}{// in this player's own join event, we get a complete list of players in the room, so check if we know each of the}}
\DoxyCodeLine{03215                         \textcolor{keywordtype}{int}[] actorsInRoom = (\textcolor{keywordtype}{int}[])photonEvent[ParameterCode.ActorList];}
\DoxyCodeLine{03216                         \textcolor{keyword}{this}.UpdatedActorList(actorsInRoom);}
\DoxyCodeLine{03217 }
\DoxyCodeLine{03218                         \textcolor{comment}{// any operation that does a "{}rejoin"{} will set this value to true. this can indicate if the local player returns to a room.}}
\DoxyCodeLine{03219                         originatingPlayer.HasRejoined = this.enterRoomParamsCache.JoinMode == JoinMode.RejoinOnly;}
\DoxyCodeLine{03220 }
\DoxyCodeLine{03221                         \textcolor{comment}{// joinWithCreateOnDemand can turn an OpJoin into creating the room. Then actorNumber is 1 and callback: OnCreatedRoom()}}
\DoxyCodeLine{03222                         \textcolor{keywordflow}{if} (this.lastJoinType == JoinType.CreateRoom || (\textcolor{keyword}{this}.lastJoinType == JoinType.JoinOrCreateRoom \&\& \textcolor{keyword}{this}.LocalPlayer.ActorNumber == 1))}
\DoxyCodeLine{03223                         \{}
\DoxyCodeLine{03224                             this.MatchMakingCallbackTargets.OnCreatedRoom();}
\DoxyCodeLine{03225                         \}}
\DoxyCodeLine{03226 }
\DoxyCodeLine{03227                         this.MatchMakingCallbackTargets.OnJoinedRoom();}
\DoxyCodeLine{03228                     \}}
\DoxyCodeLine{03229                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03230                     \{}
\DoxyCodeLine{03231                         this.InRoomCallbackTargets.OnPlayerEnteredRoom(originatingPlayer);}
\DoxyCodeLine{03232                     \}}
\DoxyCodeLine{03233                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03234 }
\DoxyCodeLine{03235                 \textcolor{keywordflow}{case} EventCode.Leave:}
\DoxyCodeLine{03236                     \textcolor{keywordflow}{if} (originatingPlayer != \textcolor{keyword}{null})}
\DoxyCodeLine{03237                     \{}
\DoxyCodeLine{03238                         \textcolor{keywordtype}{bool} isInactive = \textcolor{keyword}{false};}
\DoxyCodeLine{03239                         \textcolor{keywordflow}{if} (photonEvent.Parameters.ContainsKey(ParameterCode.IsInactive))}
\DoxyCodeLine{03240                         \{}
\DoxyCodeLine{03241                             isInactive = (bool)photonEvent.Parameters[ParameterCode.IsInactive];}
\DoxyCodeLine{03242                         \}}
\DoxyCodeLine{03243 }
\DoxyCodeLine{03244                         \textcolor{keywordflow}{if} (isInactive)}
\DoxyCodeLine{03245                         \{}
\DoxyCodeLine{03246                             originatingPlayer.IsInactive = \textcolor{keyword}{true};}
\DoxyCodeLine{03247                         \}}
\DoxyCodeLine{03248                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{03249                         \{}
\DoxyCodeLine{03250                             originatingPlayer.IsInactive = \textcolor{keyword}{false};}
\DoxyCodeLine{03251                             this.CurrentRoom.RemovePlayer(actorNr);}
\DoxyCodeLine{03252                         \}}
\DoxyCodeLine{03253                     \}}
\DoxyCodeLine{03254 }
\DoxyCodeLine{03255                     \textcolor{keywordflow}{if} (photonEvent.Parameters.ContainsKey(ParameterCode.MasterClientId))}
\DoxyCodeLine{03256                     \{}
\DoxyCodeLine{03257                         \textcolor{keywordtype}{int} newMaster = (int)photonEvent[ParameterCode.MasterClientId];}
\DoxyCodeLine{03258                         if (newMaster != 0)}
\DoxyCodeLine{03259                         \{}
\DoxyCodeLine{03260                             this.CurrentRoom.masterClientId = newMaster;}
\DoxyCodeLine{03261                             this.InRoomCallbackTargets.OnMasterClientSwitched(this.CurrentRoom.GetPlayer(newMaster));}
\DoxyCodeLine{03262                         \}}
\DoxyCodeLine{03263                     \}}
\DoxyCodeLine{03264                     \textcolor{comment}{// finally, send notification that a player left}}
\DoxyCodeLine{03265                     this.InRoomCallbackTargets.OnPlayerLeftRoom(originatingPlayer);}
\DoxyCodeLine{03266                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03267 }
\DoxyCodeLine{03268                 \textcolor{keywordflow}{case} EventCode.PropertiesChanged:}
\DoxyCodeLine{03269                     \textcolor{comment}{// whenever properties are sent in-\/room, they can be broadcasted as event (which we handle here)}}
\DoxyCodeLine{03270                     \textcolor{comment}{// we get PLAYERproperties if actorNr > 0 or ROOMproperties if actorNumber is not set or 0}}
\DoxyCodeLine{03271                     \textcolor{keywordtype}{int} targetActorNr = 0;}
\DoxyCodeLine{03272                     \textcolor{keywordflow}{if} (photonEvent.Parameters.ContainsKey(ParameterCode.TargetActorNr))}
\DoxyCodeLine{03273                     \{}
\DoxyCodeLine{03274                         targetActorNr = (int)photonEvent[ParameterCode.TargetActorNr];}
\DoxyCodeLine{03275                     \}}
\DoxyCodeLine{03276 }
\DoxyCodeLine{03277                     Hashtable gameProperties = \textcolor{keyword}{null};}
\DoxyCodeLine{03278                     Hashtable actorProps = \textcolor{keyword}{null};}
\DoxyCodeLine{03279                     \textcolor{keywordflow}{if} (targetActorNr == 0)}
\DoxyCodeLine{03280                     \{}
\DoxyCodeLine{03281                         gameProperties = (Hashtable)photonEvent[ParameterCode.Properties];}
\DoxyCodeLine{03282                     \}}
\DoxyCodeLine{03283                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03284                     \{}
\DoxyCodeLine{03285                         actorProps = (Hashtable)photonEvent[ParameterCode.Properties];}
\DoxyCodeLine{03286                     \}}
\DoxyCodeLine{03287 }
\DoxyCodeLine{03288                     this.ReadoutProperties(gameProperties, actorProps, targetActorNr);}
\DoxyCodeLine{03289                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03290 }
\DoxyCodeLine{03291                 \textcolor{keywordflow}{case} EventCode.AppStats:}
\DoxyCodeLine{03292                     \textcolor{comment}{// only the master server sends these in (1 minute) intervals}}
\DoxyCodeLine{03293                     this.PlayersInRoomsCount = (int)photonEvent[ParameterCode.PeerCount];}
\DoxyCodeLine{03294                     \textcolor{keyword}{this}.RoomsCount = (\textcolor{keywordtype}{int})photonEvent[ParameterCode.GameCount];}
\DoxyCodeLine{03295                     this.PlayersOnMasterCount = (int)photonEvent[ParameterCode.MasterPeerCount];}
\DoxyCodeLine{03296                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03297 }
\DoxyCodeLine{03298                 \textcolor{keywordflow}{case} EventCode.LobbyStats:}
\DoxyCodeLine{03299                     \textcolor{keywordtype}{string}[] names = photonEvent[ParameterCode.LobbyName] as \textcolor{keywordtype}{string}[];}
\DoxyCodeLine{03300                     \textcolor{keywordtype}{int}[] peers = photonEvent[ParameterCode.PeerCount] as \textcolor{keywordtype}{int}[];}
\DoxyCodeLine{03301                     \textcolor{keywordtype}{int}[] rooms = photonEvent[ParameterCode.GameCount] as \textcolor{keywordtype}{int}[];}
\DoxyCodeLine{03302 }
\DoxyCodeLine{03303                     \textcolor{keywordtype}{byte}[] types;}
\DoxyCodeLine{03304                     ByteArraySlice slice = photonEvent[ParameterCode.LobbyType] as ByteArraySlice;}
\DoxyCodeLine{03305                     \textcolor{keywordtype}{bool} useByteArraySlice = slice != \textcolor{keyword}{null};}
\DoxyCodeLine{03306 }
\DoxyCodeLine{03307                     if (useByteArraySlice)}
\DoxyCodeLine{03308                     \{}
\DoxyCodeLine{03309                         types = slice.Buffer;}
\DoxyCodeLine{03310                     \}}
\DoxyCodeLine{03311                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03312                     \{}
\DoxyCodeLine{03313                         types = photonEvent[ParameterCode.LobbyType] as \textcolor{keywordtype}{byte}[];}
\DoxyCodeLine{03314                     \}}
\DoxyCodeLine{03315 }
\DoxyCodeLine{03316                     this.lobbyStatistics.Clear();}
\DoxyCodeLine{03317                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < names.Length; i++)}
\DoxyCodeLine{03318                     \{}
\DoxyCodeLine{03319                         TypedLobbyInfo info = \textcolor{keyword}{new} TypedLobbyInfo();}
\DoxyCodeLine{03320                         info.Name = names[i];}
\DoxyCodeLine{03321                         info.Type = (LobbyType)types[i];}
\DoxyCodeLine{03322                         info.PlayerCount = peers[i];}
\DoxyCodeLine{03323                         info.RoomCount = rooms[i];}
\DoxyCodeLine{03324 }
\DoxyCodeLine{03325                         this.lobbyStatistics.Add(info);}
\DoxyCodeLine{03326                     \}}
\DoxyCodeLine{03327 }
\DoxyCodeLine{03328                     \textcolor{keywordflow}{if} (useByteArraySlice)}
\DoxyCodeLine{03329                     \{}
\DoxyCodeLine{03330                         slice.Release();}
\DoxyCodeLine{03331                     \}}
\DoxyCodeLine{03332 }
\DoxyCodeLine{03333                     this.LobbyCallbackTargets.OnLobbyStatisticsUpdate(this.lobbyStatistics);}
\DoxyCodeLine{03334                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03335 }
\DoxyCodeLine{03336                 \textcolor{keywordflow}{case} EventCode.ErrorInfo:}
\DoxyCodeLine{03337                     this.ErrorInfoCallbackTargets.OnErrorInfo(\textcolor{keyword}{new} ErrorInfo(photonEvent));}
\DoxyCodeLine{03338                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03339 }
\DoxyCodeLine{03340                 \textcolor{keywordflow}{case} EventCode.AuthEvent:}
\DoxyCodeLine{03341                     \textcolor{keywordflow}{if} (this.AuthValues == \textcolor{keyword}{null})}
\DoxyCodeLine{03342                     \{}
\DoxyCodeLine{03343                         this.AuthValues = \textcolor{keyword}{new} AuthenticationValues();}
\DoxyCodeLine{03344                     \}}
\DoxyCodeLine{03345 }
\DoxyCodeLine{03346                     this.AuthValues.Token = photonEvent[ParameterCode.Token] as string;}
\DoxyCodeLine{03347                     this.tokenCache = this.AuthValues.Token;}
\DoxyCodeLine{03348                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03349 }
\DoxyCodeLine{03350             \}}
\DoxyCodeLine{03351 }
\DoxyCodeLine{03352             this.UpdateCallbackTargets();}
\DoxyCodeLine{03353             \textcolor{keywordflow}{if} (this.EventReceived != \textcolor{keyword}{null}) this.EventReceived(photonEvent);}
\DoxyCodeLine{03354         \}}
\DoxyCodeLine{03355 }
\DoxyCodeLine{03357         \textcolor{keyword}{public} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnMessage(\textcolor{keywordtype}{object} message)}
\DoxyCodeLine{03358         \{}
\DoxyCodeLine{03359             this.DebugReturn(DebugLevel.ALL, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}got OnMessage \{0\}"{}}, message));}
\DoxyCodeLine{03360         \}}
\DoxyCodeLine{03361 }
\DoxyCodeLine{03362 \textcolor{preprocessor}{        \#endregion}}
\DoxyCodeLine{03363 }
\DoxyCodeLine{03364 }
\DoxyCodeLine{03365         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnDisconnectMessageReceived(DisconnectMessage obj)}
\DoxyCodeLine{03366         \{}
\DoxyCodeLine{03367             this.DebugReturn(DebugLevel.ERROR, \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}Got DisconnectMessage. Code: \{0\} Msg: \(\backslash\)"{}\{1\}\(\backslash\)"{}. Debug Info: \{2\}"{}}, obj.Code, obj.DebugMessage, obj.Parameters.ToStringFull()));}
\DoxyCodeLine{03368             this.Disconnect(DisconnectCause.DisconnectByDisconnectMessage);}
\DoxyCodeLine{03369         \}}
\DoxyCodeLine{03370 }
\DoxyCodeLine{03371 }
\DoxyCodeLine{03374         \textcolor{keyword}{private} \textcolor{keywordtype}{void} OnRegionPingCompleted(RegionHandler regionHandler)}
\DoxyCodeLine{03375         \{}
\DoxyCodeLine{03376             \textcolor{comment}{//Debug.Log("{}OnRegionPingCompleted "{} + regionHandler.BestRegion);}}
\DoxyCodeLine{03377             \textcolor{comment}{//Debug.Log("{}RegionPingSummary: "{} + regionHandler.SummaryToCache);}}
\DoxyCodeLine{03378             this.SummaryToCache = regionHandler.SummaryToCache;}
\DoxyCodeLine{03379             this.ConnectToRegionMaster(regionHandler.BestRegion.Code);}
\DoxyCodeLine{03380         \}}
\DoxyCodeLine{03381 }
\DoxyCodeLine{03382 }
\DoxyCodeLine{03383         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keyword}{static} \textcolor{keywordtype}{string} ReplacePortWithAlternative(\textcolor{keywordtype}{string} address, ushort replacementPort)}
\DoxyCodeLine{03384         \{}
\DoxyCodeLine{03385             \textcolor{keywordtype}{bool} webSocket = address.StartsWith(\textcolor{stringliteral}{"{}ws"{}});}
\DoxyCodeLine{03386             \textcolor{keywordflow}{if} (webSocket)}
\DoxyCodeLine{03387             \{}
\DoxyCodeLine{03388                 UriBuilder urib = \textcolor{keyword}{new} UriBuilder(address);}
\DoxyCodeLine{03389                 urib.Port = replacementPort;}
\DoxyCodeLine{03390                 \textcolor{keywordflow}{return} urib.ToString();}
\DoxyCodeLine{03391             \}}
\DoxyCodeLine{03392             \textcolor{keywordflow}{else}}
\DoxyCodeLine{03393             \{}
\DoxyCodeLine{03394                 UriBuilder urib = \textcolor{keyword}{new} UriBuilder(\textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}scheme://\{0\}"{}}, address));}
\DoxyCodeLine{03395                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}\{0\}:\{1\}"{}}, urib.Host, replacementPort);}
\DoxyCodeLine{03396             \}}
\DoxyCodeLine{03397         \}}
\DoxyCodeLine{03398 }
\DoxyCodeLine{03399         \textcolor{keyword}{private} \textcolor{keywordtype}{void} SetupEncryption(Dictionary<byte, object> encryptionData)}
\DoxyCodeLine{03400         \{}
\DoxyCodeLine{03401             var mode = (EncryptionMode)(\textcolor{keywordtype}{byte})encryptionData[EncryptionDataParameters.Mode];}
\DoxyCodeLine{03402             \textcolor{keywordflow}{switch} (mode)}
\DoxyCodeLine{03403             \{}
\DoxyCodeLine{03404                 \textcolor{keywordflow}{case} EncryptionMode.PayloadEncryption:}
\DoxyCodeLine{03405                     \textcolor{keywordtype}{byte}[] encryptionSecret = (\textcolor{keywordtype}{byte}[])encryptionData[EncryptionDataParameters.Secret1];}
\DoxyCodeLine{03406                     \textcolor{keyword}{this}.LoadBalancingPeer.InitPayloadEncryption(encryptionSecret);}
\DoxyCodeLine{03407                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03408                 \textcolor{keywordflow}{case} EncryptionMode.DatagramEncryption:}
\DoxyCodeLine{03409                 \textcolor{keywordflow}{case} EncryptionMode.DatagramEncryptionRandomSequence:}
\DoxyCodeLine{03410                     \{}
\DoxyCodeLine{03411                         \textcolor{keywordtype}{byte}[] secret1 = (\textcolor{keywordtype}{byte}[])encryptionData[EncryptionDataParameters.Secret1];}
\DoxyCodeLine{03412                         \textcolor{keywordtype}{byte}[] secret2 = (\textcolor{keywordtype}{byte}[])encryptionData[EncryptionDataParameters.Secret2];}
\DoxyCodeLine{03413                         this.LoadBalancingPeer.InitDatagramEncryption(secret1, secret2, mode == EncryptionMode.DatagramEncryptionRandomSequence);}
\DoxyCodeLine{03414                     \}}
\DoxyCodeLine{03415                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03416                 \textcolor{keywordflow}{case} EncryptionMode.DatagramEncryptionGCM:}
\DoxyCodeLine{03417                     \{}
\DoxyCodeLine{03418                         \textcolor{keywordtype}{byte}[] secret1 = (\textcolor{keywordtype}{byte}[])encryptionData[EncryptionDataParameters.Secret1];}
\DoxyCodeLine{03419                         \textcolor{keyword}{this}.LoadBalancingPeer.InitDatagramEncryption(secret1, \textcolor{keyword}{null}, \textcolor{keyword}{true}, \textcolor{keyword}{true});}
\DoxyCodeLine{03420                     \}}
\DoxyCodeLine{03421                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{03422                 \textcolor{keywordflow}{default}:}
\DoxyCodeLine{03423                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentOutOfRangeException();}
\DoxyCodeLine{03424             \}}
\DoxyCodeLine{03425         \}}
\DoxyCodeLine{03426 }
\DoxyCodeLine{03427 }
\DoxyCodeLine{03428 }
\DoxyCodeLine{03449         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} OpWebRpc(\textcolor{keywordtype}{string} uriPath, \textcolor{keywordtype}{object} parameters, \textcolor{keywordtype}{bool} sendAuthCookie = \textcolor{keyword}{false})}
\DoxyCodeLine{03450         \{}
\DoxyCodeLine{03451             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(uriPath))}
\DoxyCodeLine{03452             \{}
\DoxyCodeLine{03453                 this.DebugReturn(DebugLevel.ERROR, \textcolor{stringliteral}{"{}WebRPC method name must not be null nor empty."{}});}
\DoxyCodeLine{03454                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{03455             \}}
\DoxyCodeLine{03456             \textcolor{keywordflow}{if} (!this.CheckIfOpCanBeSent(OperationCode.WebRpc, \textcolor{keyword}{this}.Server, \textcolor{stringliteral}{"{}WebRpc"{}}))}
\DoxyCodeLine{03457             \{}
\DoxyCodeLine{03458                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{03459             \}}
\DoxyCodeLine{03460             Dictionary<byte, object> opParameters = \textcolor{keyword}{new} Dictionary<byte, object>();}
\DoxyCodeLine{03461             opParameters.Add(ParameterCode.UriPath, uriPath);}
\DoxyCodeLine{03462             \textcolor{keywordflow}{if} (parameters != \textcolor{keyword}{null})}
\DoxyCodeLine{03463             \{}
\DoxyCodeLine{03464                 opParameters.Add(ParameterCode.WebRpcParameters, parameters);}
\DoxyCodeLine{03465             \}}
\DoxyCodeLine{03466             \textcolor{keywordflow}{if} (sendAuthCookie)}
\DoxyCodeLine{03467             \{}
\DoxyCodeLine{03468                 opParameters.Add(ParameterCode.EventForward, WebFlags.SendAuthCookieConst);}
\DoxyCodeLine{03469             \}}
\DoxyCodeLine{03470 }
\DoxyCodeLine{03471             \textcolor{comment}{//return this.LoadBalancingPeer.OpCustom(OperationCode.WebRpc, opParameters, true);}}
\DoxyCodeLine{03472             \textcolor{keywordflow}{return} this.LoadBalancingPeer.SendOperation(OperationCode.WebRpc, opParameters, SendOptions.SendReliable);}
\DoxyCodeLine{03473         \}}
\DoxyCodeLine{03474 }
\DoxyCodeLine{03475 }
\DoxyCodeLine{03490         \textcolor{keyword}{public} \textcolor{keywordtype}{void} AddCallbackTarget(\textcolor{keywordtype}{object} target)}
\DoxyCodeLine{03491         \{}
\DoxyCodeLine{03492             this.callbackTargetChanges.Enqueue(\textcolor{keyword}{new} CallbackTargetChange(target, \textcolor{keyword}{true}));}
\DoxyCodeLine{03493         \}}
\DoxyCodeLine{03494 }
\DoxyCodeLine{03509         \textcolor{keyword}{public} \textcolor{keywordtype}{void} RemoveCallbackTarget(\textcolor{keywordtype}{object} target)}
\DoxyCodeLine{03510         \{}
\DoxyCodeLine{03511             this.callbackTargetChanges.Enqueue(\textcolor{keyword}{new} CallbackTargetChange(target, \textcolor{keyword}{false}));}
\DoxyCodeLine{03512         \}}
\DoxyCodeLine{03513 }
\DoxyCodeLine{03514 }
\DoxyCodeLine{03521         \textcolor{keyword}{protected} \textcolor{keyword}{internal} \textcolor{keywordtype}{void} UpdateCallbackTargets()}
\DoxyCodeLine{03522         \{}
\DoxyCodeLine{03523             \textcolor{keywordflow}{while} (this.callbackTargetChanges.Count > 0)}
\DoxyCodeLine{03524             \{}
\DoxyCodeLine{03525                 CallbackTargetChange change = this.callbackTargetChanges.Dequeue();}
\DoxyCodeLine{03526 }
\DoxyCodeLine{03527                 \textcolor{keywordflow}{if} (change.AddTarget)}
\DoxyCodeLine{03528                 \{}
\DoxyCodeLine{03529                     \textcolor{keywordflow}{if} (this.callbackTargets.Contains(change.Target))}
\DoxyCodeLine{03530                     \{}
\DoxyCodeLine{03531                         \textcolor{comment}{//Debug.Log("{}UpdateCallbackTargets skipped adding a target, as the object is already registered. Target: "{} + change.Target);}}
\DoxyCodeLine{03532                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{03533                     \}}
\DoxyCodeLine{03534 }
\DoxyCodeLine{03535                     this.callbackTargets.Add(change.Target);}
\DoxyCodeLine{03536                 \}}
\DoxyCodeLine{03537                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{03538                 \{}
\DoxyCodeLine{03539                     \textcolor{keywordflow}{if} (!this.callbackTargets.Contains(change.Target))}
\DoxyCodeLine{03540                     \{}
\DoxyCodeLine{03541                         \textcolor{comment}{//Debug.Log("{}UpdateCallbackTargets skipped removing a target, as the object is not registered. Target: "{} + change.Target);}}
\DoxyCodeLine{03542                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{03543                     \}}
\DoxyCodeLine{03544 }
\DoxyCodeLine{03545                     this.callbackTargets.Remove(change.Target);}
\DoxyCodeLine{03546                 \}}
\DoxyCodeLine{03547 }
\DoxyCodeLine{03548                 this.UpdateCallbackTarget<IInRoomCallbacks>(change, this.InRoomCallbackTargets);}
\DoxyCodeLine{03549                 this.UpdateCallbackTarget<IConnectionCallbacks>(change, this.ConnectionCallbackTargets);}
\DoxyCodeLine{03550                 this.UpdateCallbackTarget<IMatchmakingCallbacks>(change, this.MatchMakingCallbackTargets);}
\DoxyCodeLine{03551                 this.UpdateCallbackTarget<ILobbyCallbacks>(change, this.LobbyCallbackTargets);}
\DoxyCodeLine{03552                 this.UpdateCallbackTarget<IWebRpcCallback>(change, this.WebRpcCallbackTargets);}
\DoxyCodeLine{03553                 this.UpdateCallbackTarget<IErrorInfoCallback>(change, this.ErrorInfoCallbackTargets);}
\DoxyCodeLine{03554 }
\DoxyCodeLine{03555                 IOnEventCallback onEventCallback = change.Target as IOnEventCallback;}
\DoxyCodeLine{03556                 \textcolor{keywordflow}{if} (onEventCallback != \textcolor{keyword}{null})}
\DoxyCodeLine{03557                 \{}
\DoxyCodeLine{03558                     \textcolor{keywordflow}{if} (change.AddTarget)}
\DoxyCodeLine{03559                     \{}
\DoxyCodeLine{03560                         EventReceived += onEventCallback.OnEvent;}
\DoxyCodeLine{03561                     \}}
\DoxyCodeLine{03562                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{03563                     \{}
\DoxyCodeLine{03564                         EventReceived -\/= onEventCallback.OnEvent;}
\DoxyCodeLine{03565                     \}}
\DoxyCodeLine{03566                 \}}
\DoxyCodeLine{03567             \}}
\DoxyCodeLine{03568         \}}
\DoxyCodeLine{03569 }
\DoxyCodeLine{03574         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateCallbackTarget<T>(CallbackTargetChange change, List<T> container) where T : \textcolor{keyword}{class}}
\DoxyCodeLine{03575         \{}
\DoxyCodeLine{03576             T target = change.Target as T;}
\DoxyCodeLine{03577             \textcolor{keywordflow}{if} (target != \textcolor{keyword}{null})}
\DoxyCodeLine{03578             \{}
\DoxyCodeLine{03579                 \textcolor{keywordflow}{if} (change.AddTarget)}
\DoxyCodeLine{03580                 \{}
\DoxyCodeLine{03581                     container.Add(target);}
\DoxyCodeLine{03582                 \}}
\DoxyCodeLine{03583                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{03584                 \{}
\DoxyCodeLine{03585                     container.Remove(target);}
\DoxyCodeLine{03586                 \}}
\DoxyCodeLine{03587             \}}
\DoxyCodeLine{03588         \}}
\DoxyCodeLine{03589     \}}
\DoxyCodeLine{03590 }
\DoxyCodeLine{03591 }
\DoxyCodeLine{03603     \textcolor{keyword}{public} \textcolor{keyword}{interface }IConnectionCallbacks}
\DoxyCodeLine{03604     \{}
\DoxyCodeLine{03619         \textcolor{keywordtype}{void} OnConnected();}
\DoxyCodeLine{03620 }
\DoxyCodeLine{03628         \textcolor{keywordtype}{void} OnConnectedToMaster();}
\DoxyCodeLine{03629 }
\DoxyCodeLine{03636         \textcolor{keywordtype}{void} OnDisconnected(DisconnectCause cause);}
\DoxyCodeLine{03637 }
\DoxyCodeLine{03643         \textcolor{keywordtype}{void} OnRegionListReceived(RegionHandler regionHandler);}
\DoxyCodeLine{03644 }
\DoxyCodeLine{03645 }
\DoxyCodeLine{03658         \textcolor{keywordtype}{void} OnCustomAuthenticationResponse(Dictionary<string, object> data);}
\DoxyCodeLine{03659 }
\DoxyCodeLine{03674         \textcolor{keywordtype}{void} OnCustomAuthenticationFailed(\textcolor{keywordtype}{string} debugMessage);}
\DoxyCodeLine{03675 }
\DoxyCodeLine{03676     \}}
\DoxyCodeLine{03677 }
\DoxyCodeLine{03678 }
\DoxyCodeLine{03690     \textcolor{keyword}{public} \textcolor{keyword}{interface }ILobbyCallbacks}
\DoxyCodeLine{03691     \{}
\DoxyCodeLine{03692 }
\DoxyCodeLine{03700         \textcolor{keywordtype}{void} OnJoinedLobby();}
\DoxyCodeLine{03701 }
\DoxyCodeLine{03709         \textcolor{keywordtype}{void} OnLeftLobby();}
\DoxyCodeLine{03710 }
\DoxyCodeLine{03718         \textcolor{keywordtype}{void} OnRoomListUpdate(List<RoomInfo> roomList);}
\DoxyCodeLine{03719 }
\DoxyCodeLine{03728         \textcolor{keywordtype}{void} OnLobbyStatisticsUpdate(List<TypedLobbyInfo> lobbyStatistics);}
\DoxyCodeLine{03729     \}}
\DoxyCodeLine{03730 }
\DoxyCodeLine{03731 }
\DoxyCodeLine{03743     \textcolor{keyword}{public} \textcolor{keyword}{interface }IMatchmakingCallbacks}
\DoxyCodeLine{03744     \{}
\DoxyCodeLine{03745 }
\DoxyCodeLine{03755         \textcolor{keywordtype}{void} OnFriendListUpdate(List<FriendInfo> friendList);}
\DoxyCodeLine{03756 }
\DoxyCodeLine{03769         \textcolor{keywordtype}{void} OnCreatedRoom();}
\DoxyCodeLine{03770 }
\DoxyCodeLine{03786         \textcolor{keywordtype}{void} OnCreateRoomFailed(\textcolor{keywordtype}{short} returnCode, \textcolor{keywordtype}{string} message);}
\DoxyCodeLine{03787 }
\DoxyCodeLine{03798         \textcolor{keywordtype}{void} OnJoinedRoom();}
\DoxyCodeLine{03799 }
\DoxyCodeLine{03815         \textcolor{keywordtype}{void} OnJoinRoomFailed(\textcolor{keywordtype}{short} returnCode, \textcolor{keywordtype}{string} message);}
\DoxyCodeLine{03816 }
\DoxyCodeLine{03830         \textcolor{keywordtype}{void} OnJoinRandomFailed(\textcolor{keywordtype}{short} returnCode, \textcolor{keywordtype}{string} message);}
\DoxyCodeLine{03831 }
\DoxyCodeLine{03841         \textcolor{keywordtype}{void} OnLeftRoom();}
\DoxyCodeLine{03842     \}}
\DoxyCodeLine{03843 }
\DoxyCodeLine{03855     \textcolor{keyword}{public} \textcolor{keyword}{interface }IInRoomCallbacks}
\DoxyCodeLine{03856     \{}
\DoxyCodeLine{03864         \textcolor{keywordtype}{void} OnPlayerEnteredRoom(Player newPlayer);}
\DoxyCodeLine{03865 }
\DoxyCodeLine{03879         \textcolor{keywordtype}{void} OnPlayerLeftRoom(Player otherPlayer);}
\DoxyCodeLine{03880 }
\DoxyCodeLine{03881 }
\DoxyCodeLine{03890         \textcolor{keywordtype}{void} OnRoomPropertiesUpdate(Hashtable propertiesThatChanged);}
\DoxyCodeLine{03891 }
\DoxyCodeLine{03900         \textcolor{keywordtype}{void} OnPlayerPropertiesUpdate(Player targetPlayer, Hashtable changedProps);}
\DoxyCodeLine{03901 }
\DoxyCodeLine{03909         \textcolor{keywordtype}{void} OnMasterClientSwitched(Player newMasterClient);}
\DoxyCodeLine{03910     \}}
\DoxyCodeLine{03911 }
\DoxyCodeLine{03912 }
\DoxyCodeLine{03924     \textcolor{keyword}{public} \textcolor{keyword}{interface }IOnEventCallback}
\DoxyCodeLine{03925     \{}
\DoxyCodeLine{03936         \textcolor{keywordtype}{void} OnEvent(EventData photonEvent);}
\DoxyCodeLine{03937     \}}
\DoxyCodeLine{03938 }
\DoxyCodeLine{03950     \textcolor{keyword}{public} \textcolor{keyword}{interface }IWebRpcCallback}
\DoxyCodeLine{03951     \{}
\DoxyCodeLine{04020         \textcolor{keywordtype}{void} OnWebRpcResponse(OperationResponse response);}
\DoxyCodeLine{04021     \}}
\DoxyCodeLine{04022 }
\DoxyCodeLine{04034     \textcolor{keyword}{public} \textcolor{keyword}{interface }IErrorInfoCallback}
\DoxyCodeLine{04035     \{}
\DoxyCodeLine{04052         \textcolor{keywordtype}{void} OnErrorInfo(ErrorInfo errorInfo);}
\DoxyCodeLine{04053     \}}
\DoxyCodeLine{04054 }
\DoxyCodeLine{04062     \textcolor{keyword}{public} \textcolor{keyword}{class }ConnectionCallbacksContainer : List<IConnectionCallbacks>, IConnectionCallbacks}
\DoxyCodeLine{04063     \{}
\DoxyCodeLine{04064         \textcolor{keyword}{private} readonly LoadBalancingClient client;}
\DoxyCodeLine{04065 }
\DoxyCodeLine{04066         \textcolor{keyword}{public} ConnectionCallbacksContainer(LoadBalancingClient client)}
\DoxyCodeLine{04067         \{}
\DoxyCodeLine{04068             this.client = client;}
\DoxyCodeLine{04069         \}}
\DoxyCodeLine{04070 }
\DoxyCodeLine{04071         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnConnected()}
\DoxyCodeLine{04072         \{}
\DoxyCodeLine{04073             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04074 }
\DoxyCodeLine{04075             \textcolor{keywordflow}{foreach} (IConnectionCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04076             \{}
\DoxyCodeLine{04077                 target.OnConnected();}
\DoxyCodeLine{04078             \}}
\DoxyCodeLine{04079         \}}
\DoxyCodeLine{04080 }
\DoxyCodeLine{04081         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnConnectedToMaster()}
\DoxyCodeLine{04082         \{}
\DoxyCodeLine{04083             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04084 }
\DoxyCodeLine{04085             \textcolor{keywordflow}{foreach} (IConnectionCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04086             \{}
\DoxyCodeLine{04087                 target.OnConnectedToMaster();}
\DoxyCodeLine{04088             \}}
\DoxyCodeLine{04089         \}}
\DoxyCodeLine{04090 }
\DoxyCodeLine{04091         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnRegionListReceived(RegionHandler regionHandler)}
\DoxyCodeLine{04092         \{}
\DoxyCodeLine{04093             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04094 }
\DoxyCodeLine{04095             \textcolor{keywordflow}{foreach} (IConnectionCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04096             \{}
\DoxyCodeLine{04097                 target.OnRegionListReceived(regionHandler);}
\DoxyCodeLine{04098             \}}
\DoxyCodeLine{04099         \}}
\DoxyCodeLine{04100 }
\DoxyCodeLine{04101         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnDisconnected(DisconnectCause cause)}
\DoxyCodeLine{04102         \{}
\DoxyCodeLine{04103             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04104 }
\DoxyCodeLine{04105             \textcolor{keywordflow}{foreach} (IConnectionCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04106             \{}
\DoxyCodeLine{04107                 target.OnDisconnected(cause);}
\DoxyCodeLine{04108             \}}
\DoxyCodeLine{04109         \}}
\DoxyCodeLine{04110 }
\DoxyCodeLine{04111         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnCustomAuthenticationResponse(Dictionary<string, object> data)}
\DoxyCodeLine{04112         \{}
\DoxyCodeLine{04113             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04114 }
\DoxyCodeLine{04115             \textcolor{keywordflow}{foreach} (IConnectionCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04116             \{}
\DoxyCodeLine{04117                 target.OnCustomAuthenticationResponse(data);}
\DoxyCodeLine{04118             \}}
\DoxyCodeLine{04119         \}}
\DoxyCodeLine{04120 }
\DoxyCodeLine{04121         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnCustomAuthenticationFailed(\textcolor{keywordtype}{string} debugMessage)}
\DoxyCodeLine{04122         \{}
\DoxyCodeLine{04123             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04124 }
\DoxyCodeLine{04125             \textcolor{keywordflow}{foreach} (IConnectionCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04126             \{}
\DoxyCodeLine{04127                 target.OnCustomAuthenticationFailed(debugMessage);}
\DoxyCodeLine{04128             \}}
\DoxyCodeLine{04129         \}}
\DoxyCodeLine{04130     \}}
\DoxyCodeLine{04131 }
\DoxyCodeLine{04139     \textcolor{keyword}{public} \textcolor{keyword}{class }MatchMakingCallbacksContainer : List<IMatchmakingCallbacks>, IMatchmakingCallbacks}
\DoxyCodeLine{04140     \{}
\DoxyCodeLine{04141         \textcolor{keyword}{private} readonly LoadBalancingClient client;}
\DoxyCodeLine{04142 }
\DoxyCodeLine{04143         \textcolor{keyword}{public} MatchMakingCallbacksContainer(LoadBalancingClient client)}
\DoxyCodeLine{04144         \{}
\DoxyCodeLine{04145             this.client = client;}
\DoxyCodeLine{04146         \}}
\DoxyCodeLine{04147 }
\DoxyCodeLine{04148         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnCreatedRoom()}
\DoxyCodeLine{04149         \{}
\DoxyCodeLine{04150             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04151 }
\DoxyCodeLine{04152             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04153             \{}
\DoxyCodeLine{04154                 target.OnCreatedRoom();}
\DoxyCodeLine{04155             \}}
\DoxyCodeLine{04156         \}}
\DoxyCodeLine{04157 }
\DoxyCodeLine{04158         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnJoinedRoom()}
\DoxyCodeLine{04159         \{}
\DoxyCodeLine{04160             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04161 }
\DoxyCodeLine{04162             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04163             \{}
\DoxyCodeLine{04164                 target.OnJoinedRoom();}
\DoxyCodeLine{04165             \}}
\DoxyCodeLine{04166         \}}
\DoxyCodeLine{04167 }
\DoxyCodeLine{04168         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnCreateRoomFailed(\textcolor{keywordtype}{short} returnCode, \textcolor{keywordtype}{string} message)}
\DoxyCodeLine{04169         \{}
\DoxyCodeLine{04170             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04171 }
\DoxyCodeLine{04172             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04173             \{}
\DoxyCodeLine{04174                 target.OnCreateRoomFailed(returnCode, message);}
\DoxyCodeLine{04175             \}}
\DoxyCodeLine{04176         \}}
\DoxyCodeLine{04177 }
\DoxyCodeLine{04178         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnJoinRandomFailed(\textcolor{keywordtype}{short} returnCode, \textcolor{keywordtype}{string} message)}
\DoxyCodeLine{04179         \{}
\DoxyCodeLine{04180             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04181 }
\DoxyCodeLine{04182             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04183             \{}
\DoxyCodeLine{04184                 target.OnJoinRandomFailed(returnCode, message);}
\DoxyCodeLine{04185             \}}
\DoxyCodeLine{04186         \}}
\DoxyCodeLine{04187 }
\DoxyCodeLine{04188         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnJoinRoomFailed(\textcolor{keywordtype}{short} returnCode, \textcolor{keywordtype}{string} message)}
\DoxyCodeLine{04189         \{}
\DoxyCodeLine{04190             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04191 }
\DoxyCodeLine{04192             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04193             \{}
\DoxyCodeLine{04194                 target.OnJoinRoomFailed(returnCode, message);}
\DoxyCodeLine{04195             \}}
\DoxyCodeLine{04196         \}}
\DoxyCodeLine{04197 }
\DoxyCodeLine{04198         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnLeftRoom()}
\DoxyCodeLine{04199         \{}
\DoxyCodeLine{04200             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04201 }
\DoxyCodeLine{04202             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04203             \{}
\DoxyCodeLine{04204                 target.OnLeftRoom();}
\DoxyCodeLine{04205             \}}
\DoxyCodeLine{04206         \}}
\DoxyCodeLine{04207 }
\DoxyCodeLine{04208         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnFriendListUpdate(List<FriendInfo> friendList)}
\DoxyCodeLine{04209         \{}
\DoxyCodeLine{04210             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04211 }
\DoxyCodeLine{04212             \textcolor{keywordflow}{foreach} (IMatchmakingCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04213             \{}
\DoxyCodeLine{04214                 target.OnFriendListUpdate(friendList);}
\DoxyCodeLine{04215             \}}
\DoxyCodeLine{04216         \}}
\DoxyCodeLine{04217     \}}
\DoxyCodeLine{04218 }
\DoxyCodeLine{04219 }
\DoxyCodeLine{04227     \textcolor{keyword}{internal} \textcolor{keyword}{class }InRoomCallbacksContainer : List<IInRoomCallbacks>, IInRoomCallbacks}
\DoxyCodeLine{04228     \{}
\DoxyCodeLine{04229         \textcolor{keyword}{private} readonly LoadBalancingClient client;}
\DoxyCodeLine{04230 }
\DoxyCodeLine{04231         \textcolor{keyword}{public} InRoomCallbacksContainer(LoadBalancingClient client)}
\DoxyCodeLine{04232         \{}
\DoxyCodeLine{04233             this.client = client;}
\DoxyCodeLine{04234         \}}
\DoxyCodeLine{04235 }
\DoxyCodeLine{04236         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnPlayerEnteredRoom(Player newPlayer)}
\DoxyCodeLine{04237         \{}
\DoxyCodeLine{04238             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04239 }
\DoxyCodeLine{04240             \textcolor{keywordflow}{foreach} (IInRoomCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04241             \{}
\DoxyCodeLine{04242                 target.OnPlayerEnteredRoom(newPlayer);}
\DoxyCodeLine{04243             \}}
\DoxyCodeLine{04244         \}}
\DoxyCodeLine{04245 }
\DoxyCodeLine{04246         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnPlayerLeftRoom(Player otherPlayer)}
\DoxyCodeLine{04247         \{}
\DoxyCodeLine{04248             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04249 }
\DoxyCodeLine{04250             \textcolor{keywordflow}{foreach} (IInRoomCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04251             \{}
\DoxyCodeLine{04252                 target.OnPlayerLeftRoom(otherPlayer);}
\DoxyCodeLine{04253             \}}
\DoxyCodeLine{04254         \}}
\DoxyCodeLine{04255 }
\DoxyCodeLine{04256         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnRoomPropertiesUpdate(Hashtable propertiesThatChanged)}
\DoxyCodeLine{04257         \{}
\DoxyCodeLine{04258             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04259 }
\DoxyCodeLine{04260             \textcolor{keywordflow}{foreach} (IInRoomCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04261             \{}
\DoxyCodeLine{04262                 target.OnRoomPropertiesUpdate(propertiesThatChanged);}
\DoxyCodeLine{04263             \}}
\DoxyCodeLine{04264         \}}
\DoxyCodeLine{04265 }
\DoxyCodeLine{04266         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnPlayerPropertiesUpdate(Player targetPlayer, Hashtable changedProp)}
\DoxyCodeLine{04267         \{}
\DoxyCodeLine{04268             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04269 }
\DoxyCodeLine{04270             \textcolor{keywordflow}{foreach} (IInRoomCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04271             \{}
\DoxyCodeLine{04272                 target.OnPlayerPropertiesUpdate(targetPlayer, changedProp);}
\DoxyCodeLine{04273             \}}
\DoxyCodeLine{04274         \}}
\DoxyCodeLine{04275 }
\DoxyCodeLine{04276         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnMasterClientSwitched(Player newMasterClient)}
\DoxyCodeLine{04277         \{}
\DoxyCodeLine{04278             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04279 }
\DoxyCodeLine{04280             \textcolor{keywordflow}{foreach} (IInRoomCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04281             \{}
\DoxyCodeLine{04282                 target.OnMasterClientSwitched(newMasterClient);}
\DoxyCodeLine{04283             \}}
\DoxyCodeLine{04284         \}}
\DoxyCodeLine{04285     \}}
\DoxyCodeLine{04286 }
\DoxyCodeLine{04294     \textcolor{keyword}{internal} \textcolor{keyword}{class }LobbyCallbacksContainer : List<ILobbyCallbacks>, ILobbyCallbacks}
\DoxyCodeLine{04295     \{}
\DoxyCodeLine{04296         \textcolor{keyword}{private} readonly LoadBalancingClient client;}
\DoxyCodeLine{04297 }
\DoxyCodeLine{04298         \textcolor{keyword}{public} LobbyCallbacksContainer(LoadBalancingClient client)}
\DoxyCodeLine{04299         \{}
\DoxyCodeLine{04300             this.client = client;}
\DoxyCodeLine{04301         \}}
\DoxyCodeLine{04302 }
\DoxyCodeLine{04303         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnJoinedLobby()}
\DoxyCodeLine{04304         \{}
\DoxyCodeLine{04305             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04306 }
\DoxyCodeLine{04307             \textcolor{keywordflow}{foreach} (ILobbyCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04308             \{}
\DoxyCodeLine{04309                 target.OnJoinedLobby();}
\DoxyCodeLine{04310             \}}
\DoxyCodeLine{04311         \}}
\DoxyCodeLine{04312 }
\DoxyCodeLine{04313         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnLeftLobby()}
\DoxyCodeLine{04314         \{}
\DoxyCodeLine{04315             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04316 }
\DoxyCodeLine{04317             \textcolor{keywordflow}{foreach} (ILobbyCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04318             \{}
\DoxyCodeLine{04319                 target.OnLeftLobby();}
\DoxyCodeLine{04320             \}}
\DoxyCodeLine{04321         \}}
\DoxyCodeLine{04322 }
\DoxyCodeLine{04323         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnRoomListUpdate(List<RoomInfo> roomList)}
\DoxyCodeLine{04324         \{}
\DoxyCodeLine{04325             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04326 }
\DoxyCodeLine{04327             \textcolor{keywordflow}{foreach} (ILobbyCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04328             \{}
\DoxyCodeLine{04329                 target.OnRoomListUpdate(roomList);}
\DoxyCodeLine{04330             \}}
\DoxyCodeLine{04331         \}}
\DoxyCodeLine{04332 }
\DoxyCodeLine{04333         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnLobbyStatisticsUpdate(List<TypedLobbyInfo> lobbyStatistics)}
\DoxyCodeLine{04334         \{}
\DoxyCodeLine{04335             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04336 }
\DoxyCodeLine{04337             \textcolor{keywordflow}{foreach} (ILobbyCallbacks target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04338             \{}
\DoxyCodeLine{04339                 target.OnLobbyStatisticsUpdate(lobbyStatistics);}
\DoxyCodeLine{04340             \}}
\DoxyCodeLine{04341         \}}
\DoxyCodeLine{04342     \}}
\DoxyCodeLine{04343 }
\DoxyCodeLine{04351     \textcolor{keyword}{internal} \textcolor{keyword}{class }WebRpcCallbacksContainer : List<IWebRpcCallback>, IWebRpcCallback}
\DoxyCodeLine{04352     \{}
\DoxyCodeLine{04353         \textcolor{keyword}{private} LoadBalancingClient client;}
\DoxyCodeLine{04354 }
\DoxyCodeLine{04355         \textcolor{keyword}{public} WebRpcCallbacksContainer(LoadBalancingClient client)}
\DoxyCodeLine{04356         \{}
\DoxyCodeLine{04357             this.client = client;}
\DoxyCodeLine{04358         \}}
\DoxyCodeLine{04359 }
\DoxyCodeLine{04360         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnWebRpcResponse(OperationResponse response)}
\DoxyCodeLine{04361         \{}
\DoxyCodeLine{04362             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04363 }
\DoxyCodeLine{04364             \textcolor{keywordflow}{foreach} (IWebRpcCallback target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04365             \{}
\DoxyCodeLine{04366                 target.OnWebRpcResponse(response);}
\DoxyCodeLine{04367             \}}
\DoxyCodeLine{04368         \}}
\DoxyCodeLine{04369     \}}
\DoxyCodeLine{04370 }
\DoxyCodeLine{04371 }
\DoxyCodeLine{04379     \textcolor{keyword}{internal} \textcolor{keyword}{class }ErrorInfoCallbacksContainer : List<IErrorInfoCallback>, IErrorInfoCallback}
\DoxyCodeLine{04380     \{}
\DoxyCodeLine{04381         \textcolor{keyword}{private} LoadBalancingClient client;}
\DoxyCodeLine{04382 }
\DoxyCodeLine{04383         \textcolor{keyword}{public} ErrorInfoCallbacksContainer(LoadBalancingClient client)}
\DoxyCodeLine{04384         \{}
\DoxyCodeLine{04385             this.client = client;}
\DoxyCodeLine{04386         \}}
\DoxyCodeLine{04387 }
\DoxyCodeLine{04388         \textcolor{keyword}{public} \textcolor{keywordtype}{void} OnErrorInfo(ErrorInfo errorInfo)}
\DoxyCodeLine{04389         \{}
\DoxyCodeLine{04390             this.client.UpdateCallbackTargets();}
\DoxyCodeLine{04391             \textcolor{keywordflow}{foreach} (IErrorInfoCallback target \textcolor{keywordflow}{in} \textcolor{keyword}{this})}
\DoxyCodeLine{04392             \{}
\DoxyCodeLine{04393                 target.OnErrorInfo(errorInfo);}
\DoxyCodeLine{04394             \}}
\DoxyCodeLine{04395         \}}
\DoxyCodeLine{04396     \}}
\DoxyCodeLine{04397 }
\DoxyCodeLine{04414     \textcolor{keyword}{public} \textcolor{keyword}{class }ErrorInfo}
\DoxyCodeLine{04415     \{}
\DoxyCodeLine{04419         \textcolor{keyword}{public} readonly \textcolor{keywordtype}{string} Info;}
\DoxyCodeLine{04420 }
\DoxyCodeLine{04421         \textcolor{keyword}{public} ErrorInfo(EventData eventData)}
\DoxyCodeLine{04422         \{}
\DoxyCodeLine{04423             this.Info = eventData[ParameterCode.Info] as string;}
\DoxyCodeLine{04424         \}}
\DoxyCodeLine{04425 }
\DoxyCodeLine{04426         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{string} ToString()}
\DoxyCodeLine{04427         \{}
\DoxyCodeLine{04428             \textcolor{keywordflow}{return} \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}ErrorInfo: \{0\}"{}}, this.Info);}
\DoxyCodeLine{04429         \}}
\DoxyCodeLine{04430     \}}
\DoxyCodeLine{04431 \}}

\end{DoxyCode}
