\doxysection{Pun\+Startup.\+cs}
\label{_pun_startup_8cs_source}\index{C:/\_SSDSPEEDUP/2021/GPS/gps2\_purrpatrator/GPS2\_Purrpatrator/Assets/Photon/PhotonUnityNetworking/Demos/DemoHub/Editor/PunStartup.cs@{C:/\_SSDSPEEDUP/2021/GPS/gps2\_purrpatrator/GPS2\_Purrpatrator/Assets/Photon/PhotonUnityNetworking/Demos/DemoHub/Editor/PunStartup.cs}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002 \textcolor{comment}{// <copyright file="{}PunStartup.cs"{} company="{}Exit Games GmbH"{}>}}
\DoxyCodeLine{00003 \textcolor{comment}{//   Part of: Photon Unity Demos}}
\DoxyCodeLine{00004 \textcolor{comment}{// </copyright>}}
\DoxyCodeLine{00005 \textcolor{comment}{// <summary>}}
\DoxyCodeLine{00006 \textcolor{comment}{//   Used to setup the demo build settings and load the first demo scene (if imported into a new empty project).}}
\DoxyCodeLine{00007 \textcolor{comment}{// </summary>}}
\DoxyCodeLine{00008 \textcolor{comment}{// <author>developer@exitgames.com</author>}}
\DoxyCodeLine{00009 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00010 }
\DoxyCodeLine{00011 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00012 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00013 \textcolor{keyword}{using} System.IO;}
\DoxyCodeLine{00014 \textcolor{keyword}{using} UnityEditor.SceneManagement;}
\DoxyCodeLine{00015 \textcolor{keyword}{using} UnityEngine;}
\DoxyCodeLine{00016 \textcolor{keyword}{using} UnityEditor;}
\DoxyCodeLine{00017 }
\DoxyCodeLine{00018 \textcolor{keyword}{using} Photon.Pun;}
\DoxyCodeLine{00019 \textcolor{keyword}{using} Photon.Realtime;}
\DoxyCodeLine{00020 \textcolor{keyword}{using} ExitGames.Client.Photon;}
\DoxyCodeLine{00021 \textcolor{keyword}{using} UnityEngine.SceneManagement;}
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023 \textcolor{keyword}{namespace }Photon.Pun.Demo.Hub}
\DoxyCodeLine{00024 \{}
\DoxyCodeLine{00025     [InitializeOnLoad]}
\DoxyCodeLine{00026     \textcolor{keyword}{public} \textcolor{keyword}{class }PunStartup : MonoBehaviour}
\DoxyCodeLine{00027     \{}
\DoxyCodeLine{00028 }
\DoxyCodeLine{00029         \textcolor{keyword}{static} PunStartup()}
\DoxyCodeLine{00030         \{}
\DoxyCodeLine{00031             \textcolor{keywordtype}{bool} doneBefore = EditorPrefs.GetBool(\textcolor{stringliteral}{"{}PunDemosOpenedBefore"{}});}
\DoxyCodeLine{00032             \textcolor{keywordflow}{if} (!doneBefore)}
\DoxyCodeLine{00033             \{}
\DoxyCodeLine{00034                 EditorApplication.update += OnUpdate;}
\DoxyCodeLine{00035             \}}
\DoxyCodeLine{00036         \}}
\DoxyCodeLine{00037 }
\DoxyCodeLine{00038         \textcolor{keyword}{static} \textcolor{keywordtype}{void} OnUpdate()}
\DoxyCodeLine{00039         \{}
\DoxyCodeLine{00040             \textcolor{keywordflow}{if} (EditorApplication.isUpdating || Application.isPlaying)}
\DoxyCodeLine{00041             \{}
\DoxyCodeLine{00042                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00043             \}}
\DoxyCodeLine{00044 }
\DoxyCodeLine{00045             \textcolor{keywordtype}{bool} doneBefore = EditorPrefs.GetBool(\textcolor{stringliteral}{"{}PunDemosOpenedBefore"{}});}
\DoxyCodeLine{00046             EditorPrefs.SetBool(\textcolor{stringliteral}{"{}PunDemosOpenedBefore"{}}, \textcolor{keyword}{true});}
\DoxyCodeLine{00047             EditorApplication.update -\/= OnUpdate;}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049             \textcolor{keywordflow}{if} (doneBefore)}
\DoxyCodeLine{00050             \{}
\DoxyCodeLine{00051                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00052             \}}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(SceneManagerHelper.EditorActiveSceneName) \&\& EditorBuildSettings.scenes.Length == 0)}
\DoxyCodeLine{00055             \{}
\DoxyCodeLine{00056                 LoadPunDemoHub();}
\DoxyCodeLine{00057                 SetPunDemoBuildSettings();}
\DoxyCodeLine{00058                 Debug.Log(\textcolor{stringliteral}{"{}No scene was open. Loaded PUN Demo Hub Scene and added demos to build settings. Ready to go! This auto-\/setup is now disabled in this Editor."{}});}
\DoxyCodeLine{00059             \}}
\DoxyCodeLine{00060         \}}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062         [MenuItem(\textcolor{stringliteral}{"{}Window/Photon Unity Networking/Configure Demos (build setup)"{}}, \textcolor{keyword}{false}, 5)]}
\DoxyCodeLine{00063         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} SetupDemo()}
\DoxyCodeLine{00064         \{}
\DoxyCodeLine{00065             SetPunDemoBuildSettings();}
\DoxyCodeLine{00066         \}}
\DoxyCodeLine{00067 }
\DoxyCodeLine{00068         \textcolor{comment}{//[MenuItem("{}Window/Photon Unity Networking/PUN Demo Loader Reset"{})]}}
\DoxyCodeLine{00069         \textcolor{comment}{//protected static void ResetDemoLoader()}}
\DoxyCodeLine{00070         \textcolor{comment}{//\{}}
\DoxyCodeLine{00071         \textcolor{comment}{//    EditorPrefs.DeleteKey("{}PunDemosOpenedBefore"{});}}
\DoxyCodeLine{00072         \textcolor{comment}{//\}}}
\DoxyCodeLine{00073 }
\DoxyCodeLine{00074         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} LoadPunDemoHub()}
\DoxyCodeLine{00075         \{}
\DoxyCodeLine{00076             \textcolor{keywordtype}{string} scenePath = FindAssetPath(\textcolor{stringliteral}{"{}DemoHub-\/Scene t:scene"{}});}
\DoxyCodeLine{00077             \textcolor{keywordflow}{if} (!\textcolor{keywordtype}{string}.IsNullOrEmpty(scenePath))}
\DoxyCodeLine{00078             \{}
\DoxyCodeLine{00079                     EditorSceneManager.OpenScene (scenePath);}
\DoxyCodeLine{00080                     Selection.activeObject = AssetDatabase.LoadMainAssetAtPath (scenePath);}
\DoxyCodeLine{00081             \}}
\DoxyCodeLine{00082         \}}
\DoxyCodeLine{00083 }
\DoxyCodeLine{00087         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} FindAssetPath(\textcolor{keywordtype}{string} asset)}
\DoxyCodeLine{00088         \{}
\DoxyCodeLine{00089             \textcolor{keywordtype}{string}[] guids = AssetDatabase.FindAssets(asset, \textcolor{keyword}{null});}
\DoxyCodeLine{00090             \textcolor{keywordflow}{if} (guids.Length < 1)}
\DoxyCodeLine{00091             \{}
\DoxyCodeLine{00092                 Debug.LogError(\textcolor{stringliteral}{"{}We have a problem finding the asset: "{}} + asset);}
\DoxyCodeLine{00093                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{string}.Empty;}
\DoxyCodeLine{00094             \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{00095             \{}
\DoxyCodeLine{00096                 \textcolor{keywordflow}{return} AssetDatabase.GUIDToAssetPath(guids[0]);}
\DoxyCodeLine{00097             \}}
\DoxyCodeLine{00098         \}}
\DoxyCodeLine{00099 }
\DoxyCodeLine{00103         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} SetPunDemoBuildSettings()}
\DoxyCodeLine{00104         \{}
\DoxyCodeLine{00105             \textcolor{keywordtype}{string} \_PunPath = \textcolor{keywordtype}{string}.Empty;}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107             \textcolor{keywordtype}{string} \_thisPath = PhotonNetwork.FindAssetPath (\textcolor{stringliteral}{"{}PunStartUp"{}});}
\DoxyCodeLine{00108 }
\DoxyCodeLine{00109             \_thisPath = Application.dataPath + \_thisPath.Substring (6); \textcolor{comment}{// remove "{}Assets/"{}}}
\DoxyCodeLine{00110 }
\DoxyCodeLine{00111             \textcolor{comment}{//\_PunPath = PhotonEditorUtils.GetParent(\_thisPath,"{}Photon"{});}}
\DoxyCodeLine{00112 }
\DoxyCodeLine{00113             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{string}.IsNullOrEmpty(\_PunPath))}
\DoxyCodeLine{00114             \{}
\DoxyCodeLine{00115                 \_PunPath = Application.dataPath+\textcolor{stringliteral}{"{}/Photon"{}};}
\DoxyCodeLine{00116             \}}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118             \textcolor{comment}{// find path of pun guide}}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120             \textcolor{keywordtype}{string}[] tempPaths = Directory.GetDirectories(\_PunPath, \textcolor{stringliteral}{"{}Demos*"{}}, SearchOption.AllDirectories);}
\DoxyCodeLine{00121             \textcolor{keywordflow}{if} (tempPaths == \textcolor{keyword}{null})}
\DoxyCodeLine{00122             \{}
\DoxyCodeLine{00123                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00124             \}}
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126             List<EditorBuildSettingsScene> sceneAr = \textcolor{keyword}{new} List<EditorBuildSettingsScene> ();}
\DoxyCodeLine{00127 }
\DoxyCodeLine{00128             \textcolor{comment}{// find scenes of guide}}
\DoxyCodeLine{00129             \textcolor{keywordflow}{foreach} (\textcolor{keywordtype}{string} guidePath \textcolor{keywordflow}{in} tempPaths)}
\DoxyCodeLine{00130             \{}
\DoxyCodeLine{00131                 tempPaths = Directory.GetFiles (guidePath, \textcolor{stringliteral}{"{}*.unity"{}}, SearchOption.AllDirectories);}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133                 \textcolor{keywordflow}{if} (tempPaths == \textcolor{keyword}{null} || tempPaths.Length == 0)}
\DoxyCodeLine{00134                 \{}
\DoxyCodeLine{00135                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00136                 \}}
\DoxyCodeLine{00137 }
\DoxyCodeLine{00138                 \textcolor{comment}{// add found guide scenes to build settings}}
\DoxyCodeLine{00139                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < tempPaths.Length; i++)}
\DoxyCodeLine{00140                 \{}
\DoxyCodeLine{00141                     \textcolor{comment}{//Debug.Log(tempPaths[i]);}}
\DoxyCodeLine{00142                     \textcolor{keywordtype}{string} path = tempPaths [i].Substring (Application.dataPath.Length -\/ \textcolor{stringliteral}{"{}Assets"{}}.Length);}
\DoxyCodeLine{00143                     path = path.Replace (\textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}, \textcolor{charliteral}{'/'});}
\DoxyCodeLine{00144                     \textcolor{comment}{//Debug.Log(path);}}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00146                     \textcolor{keywordflow}{if} (path.Contains (\textcolor{stringliteral}{"{}PUNGuide\_M2H"{}}) || path.Contains(\textcolor{stringliteral}{"{}DemoLoadBalancing"{}}))}
\DoxyCodeLine{00147                     \{}
\DoxyCodeLine{00148                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00149                     \}}
\DoxyCodeLine{00150 }
\DoxyCodeLine{00151                     \textcolor{comment}{// edited to avoid old scene to be included.}}
\DoxyCodeLine{00152                     \textcolor{keywordflow}{if} (path.Contains (\textcolor{stringliteral}{"{}DemoHub-\/Scene"{}}))}
\DoxyCodeLine{00153                     \{}
\DoxyCodeLine{00154                         sceneAr.Insert (0, \textcolor{keyword}{new} EditorBuildSettingsScene (path, \textcolor{keyword}{true}));}
\DoxyCodeLine{00155                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00156                     \}}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158                     sceneAr.Add (\textcolor{keyword}{new} EditorBuildSettingsScene (path, \textcolor{keyword}{true}));}
\DoxyCodeLine{00159                 \}}
\DoxyCodeLine{00160             \}}
\DoxyCodeLine{00161 }
\DoxyCodeLine{00162             EditorBuildSettings.scenes = sceneAr.ToArray();}
\DoxyCodeLine{00163             EditorSceneManager.OpenScene(sceneAr[0].path);}
\DoxyCodeLine{00164         \}}
\DoxyCodeLine{00165     \}}
\DoxyCodeLine{00166 \}}

\end{DoxyCode}
